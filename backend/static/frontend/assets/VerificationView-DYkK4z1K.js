import{p as K,u as N,r as b,q as P,i as D,j as U,c as d,o as f,a as i,d as j,t as v,s as H,F as Z,g as z,b as G,A as J,k as O,v as Q,x as W}from"../index.js";import{u as X}from"./authStore-BFns-WxD.js";import{u as Y}from"./useAlert-P81MXwWp.js";import{L as x}from"./LanguageSelector-vuDdTwQ1.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";const te={class:"verification-view"},oe={class:"verification-container"},se={class:"verification-card"},ie={class:"welcome-section"},re={class:"welcome-title"},ae={class:"welcome-subtitle"},ne={class:"code-input-container"},ce=["onUpdate:modelValue","placeholder","onInput","onKeydown"],le=["disabled"],ue={key:0},de={key:1,class:"loading-spinner"},fe={class:"resend-section"},ve={class:"resend-text"},pe=["disabled"],me={key:0},he={key:1},_e={key:2},ye={__name:"VerificationView",setup(ge){const E=O(),y=J(),{t:a}=K(),I=N(),C=X(),{showError:p,showSuccess:R}=Y(),l=b([]),r=P(["","","",""]),g=b(!1),w=b(!1),m=b(0);let k=null;const V=D(()=>r.every(e=>e.length===1)),$=D(()=>r.join("")),B=(e,t)=>{var o;const n=t.target.value;if(!/^\d*$/.test(n)){r[e]="";return}r[e]=n,n&&e<3&&((o=l.value[e+1])==null||o.focus())},S=(e,t)=>{var n,o,s;t.key==="Backspace"&&!r[e]&&e>0&&((n=l.value[e-1])==null||n.focus()),t.key==="ArrowLeft"&&e>0&&((o=l.value[e-1])==null||o.focus()),t.key==="ArrowRight"&&e<3&&((s=l.value[e+1])==null||s.focus())},A=e=>{var _;e.preventDefault(),e.clipboardData.getData("text").replace(/\D/g,"").slice(0,4).split("").forEach((u,c)=>{c<4&&(r[c]=u)});const o=r.findIndex(u=>!u),s=o!==-1?o:3;(_=l.value[s])==null||_.focus()},q=()=>V.value?$.value.length!==4?(p(a("verification.validation.codeLength")),!1):!0:(p(a("verification.validation.codeRequired")),!1),F=async()=>{var e,t,n,o,s,_;g.value=!0;try{if(!q())return;const u=y.query.email||y.params.email,c=await C.verifyEmail({email:u,verification_code:$.value});if(c.success)E.push({path:`/${I.locale}/confirmation`,query:{title:a("verification.success.title"),message:a("verification.success.message"),primaryActionText:a("verification.success.actionButton"),primaryActionRoute:`/${I.locale}/profile`,autoRedirect:"true",redirectDelay:"3",redirectTo:`/${I.locale}/profile`}});else{let h=a("verification.errors.verificationFailed");(e=c.error)!=null&&e.includes("invalid")||(t=c.error)!=null&&t.includes("Invalid")?h=a("verification.errors.invalidCode"):(n=c.error)!=null&&n.includes("expired")||(o=c.error)!=null&&o.includes("Expired")?h=a("verification.errors.codeExpired"):h+=c.error,p(h),r.forEach((we,T)=>{r[T]=""}),(s=l.value[0])==null||s.focus()}}catch(u){console.error("Verification error:",u),p(a("verification.errors.verificationFailed")+(u.message||"Error desconocido")),r.forEach((c,h)=>{r[h]=""}),(_=l.value[0])==null||_.focus()}finally{g.value=!1}},L=async()=>{w.value=!0;try{const e=y.query.email||y.params.email,t=await C.resendVerificationCode(e);t.success?(R(a("verification.resendSuccess")),M()):p(a("verification.errors.resendFailed")+t.error)}catch(e){console.error("Resend error:",e),p(a("verification.errors.resendFailed")+(e.message||"Error desconocido"))}finally{w.value=!1}},M=()=>{m.value=60,k=setInterval(()=>{m.value--,m.value<=0&&clearInterval(k)},1e3)};return U(()=>{var e;(e=l.value[0])==null||e.focus()}),onUnmounted(()=>{k&&clearInterval(k)}),(e,t)=>(f(),d("div",te,[t[2]||(t[2]=i("div",{class:"background-container"},[i("div",{class:"background-overlay"})],-1)),j(x,{position:"absolute",theme:"light"}),i("div",oe,[i("div",se,[i("div",ie,[i("h2",re,v(e.$t("verification.title")),1),i("p",ae,v(e.$t("verification.subtitle")),1)]),i("form",{onSubmit:H(F,["prevent"]),class:"verification-form"},[i("div",ne,[(f(!0),d(Z,null,z(r,(n,o)=>Q((f(),d("input",{key:o,ref_for:!0,ref:s=>l.value[o]=s,"onUpdate:modelValue":s=>r[o]=s,type:"text",maxlength:"1",placeholder:e.$t("verification.codePlaceholder"),class:"code-input",onInput:s=>B(o,s),onKeydown:s=>S(o,s),onPaste:t[0]||(t[0]=s=>A(s)),required:""},null,40,ce)),[[W,r[o]]])),128))]),i("button",{type:"submit",class:"submit-btn",disabled:g.value||!V.value},[g.value?(f(),d("span",de,[t[1]||(t[1]=i("svg",{class:"animate-spin",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4","stroke-opacity":"0.25"}),i("path",{d:"M4 12C4 16.4183 7.58172 20 12 20V12H4Z",fill:"currentColor"})],-1)),G(" "+v(e.$t("verification.verifyingButton")),1)])):(f(),d("span",ue,v(e.$t("verification.verifyButton")),1))],8,le)],32),i("div",fe,[i("span",ve,v(e.$t("verification.didntReceive")),1),i("button",{onClick:L,class:"resend-link",disabled:w.value||m.value>0},[m.value>0?(f(),d("span",me,v(m.value)+"s",1)):w.value?(f(),d("span",_e,v(e.$t("verification.resendingButton")),1)):(f(),d("span",he,v(e.$t("verification.resend")),1))],8,pe)])])])]))}},De=ee(ye,[["__scopeId","data-v-43e202ba"]]);export{De as default};
