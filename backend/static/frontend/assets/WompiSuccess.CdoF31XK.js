import{N as $,u as R,r as t,o as U,a as B,c as u,b as c,d as o,t as r,e as d,j as W,p as j,z as q,m as A}from"./index.T4J3j10_.js";import{u as H}from"./cartStore.DdzdLVyM.js";import{u as z}from"./paymentStore.GI-RI2mV.js";import{_ as F}from"./_plugin-vue_export-helper.DlAUqK2U.js";const J={class:"wompi-success-view"},L={class:"success-container"},G={key:0,class:"loading-state"},K={class:"polling-info"},Q={key:1,class:"success-state"},X={class:"order-details"},Y={class:"order-number"},Z={class:"order-total"},ee={class:"order-email"},oe={class:"redirect-message"},ae={key:2,class:"error-state"},te={class:"error-message"},se={key:0,class:"manual-instructions"},re={class:"manual-input-group"},le={class:"error-actions"},ne={__name:"WompiSuccess",setup(ie){const I=A(),x=H(),_=z(),M=$(),y=R(),l=t(!0),n=t(!1),S=t(""),w=t(0),P=t(""),i=t(""),v=t(3),k=t(!1),m=t(""),p=t(0),g=t(60),a=t(null),T=s=>M.formatPrice(s);function b(){I.push({name:`Home-${y.locale}`})}function N(){I.push({name:`Checkout-${y.locale}`})}async function C(){l.value=!0,n.value=!1,i.value="",await confirmPayment()}async function V(){if(!m.value.trim()){i.value="Por favor ingresa un ID de transacci√≥n v√°lido";return}const s=`${window.location.pathname}?id=${m.value.trim()}`;window.history.pushState({},"",s),await C()}async function h(){try{const s=localStorage.getItem("wompi_reference");if(!s)throw new Error("No se encontr√≥ la referencia de pago. Por favor vuelve al checkout.");console.log(`üîç [WOMPI] Verificando estado del pago (intento ${p.value+1}/${g.value})`);const e=await _.checkWompiPaymentStatus(s);if(e.status==="success"){console.log("‚úÖ [WOMPI] Pago confirmado por webhook:",e),a.value&&(clearInterval(a.value),a.value=null),n.value=!0,S.value=e.order_id;const f=localStorage.getItem("wompi_order_data");if(f){const E=JSON.parse(f);w.value=parseFloat(E.total||0),P.value=E.customer_email||""}localStorage.removeItem("wompi_reference"),localStorage.removeItem("wompi_order_data"),localStorage.removeItem("wompi_widget_data"),sessionStorage.removeItem("checkout_order_data"),x.clearCart(),_.clearPaymentState(),l.value=!1;const D=setInterval(()=>{v.value--,v.value<=0&&(clearInterval(D),b())},1e3)}else e.status==="error"?(console.error("‚ùå [WOMPI] Error en el pago:",e.error),a.value&&(clearInterval(a.value),a.value=null),l.value=!1,n.value=!1,i.value=e.error||"Error al procesar el pago"):(p.value++,p.value>=g.value&&(console.warn("‚è±Ô∏è [WOMPI] Timeout esperando confirmaci√≥n del pago"),a.value&&(clearInterval(a.value),a.value=null),l.value=!1,n.value=!1,i.value="El pago est√° tomando m√°s tiempo de lo esperado. Por favor verifica tu email o contacta a soporte."))}catch(s){console.error("‚ùå [WOMPI] Error al verificar estado:",s),a.value&&(clearInterval(a.value),a.value=null),l.value=!1,n.value=!1,i.value=s.message||"Error al verificar el pago. Por favor contacta a soporte."}}function O(){h(),a.value=setInterval(()=>{h()},1e3)}return U(()=>{console.log("üöÄ [WOMPI SUCCESS] Iniciando polling de estado de pago"),O()}),B(()=>{a.value&&(clearInterval(a.value),a.value=null)}),(s,e)=>(c(),u("div",J,[o("div",L,[l.value?(c(),u("div",G,[e[1]||(e[1]=o("div",{class:"spinner"},null,-1)),e[2]||(e[2]=o("h2",null,"Procesando tu pago...",-1)),e[3]||(e[3]=o("p",null,"Wompi est√° confirmando tu transacci√≥n. Esto puede tomar unos segundos.",-1)),o("p",K,"‚è≥ Verificando estado... ("+r(p.value)+"/"+r(g.value)+")",1)])):n.value?(c(),u("div",Q,[e[7]||(e[7]=o("div",{class:"success-icon"},"‚úÖ",-1)),e[8]||(e[8]=o("h2",null,"¬°Pago Exitoso!",-1)),o("div",X,[o("p",Y,[e[4]||(e[4]=d("N√∫mero de orden: ",-1)),o("strong",null,r(S.value),1)]),o("p",Z,[e[5]||(e[5]=d("Total: ",-1)),o("strong",null,r(T(w.value)),1)]),o("p",ee,[e[6]||(e[6]=d("Recibir√°s un email de confirmaci√≥n en: ",-1)),o("strong",null,r(P.value),1)])]),o("p",oe,"Redirigiendo al inicio en "+r(v.value)+" segundo"+r(v.value!==1?"s":"")+"...",1),o("button",{onClick:b,class:"btn-primary"},"Ir al inicio ahora")])):(c(),u("div",ae,[e[11]||(e[11]=o("div",{class:"error-icon"},"‚ùå",-1)),e[12]||(e[12]=o("h2",null,"Error en el Pago",-1)),o("p",te,r(i.value),1),k.value?W("",!0):(c(),u("div",se,[e[9]||(e[9]=o("p",{class:"instruction-title"},"üí° ¬øCompletaste el pago en Wompi?",-1)),e[10]||(e[10]=o("p",{class:"instruction-text"},[d(" Si completaste el pago exitosamente pero llegaste aqu√≠ directamente, copia el "),o("strong",null,"ID de transacci√≥n"),d(" de la URL de Wompi y p√©galo aqu√≠: ")],-1)),o("div",re,[j(o("input",{"onUpdate:modelValue":e[0]||(e[0]=f=>m.value=f),type:"text",placeholder:"Ej: test_abc123",class:"manual-input"},null,512),[[q,m.value]]),o("button",{onClick:V,class:"btn-primary"},"Verificar")])])),o("div",le,[o("button",{onClick:N,class:"btn-secondary"},"Volver al checkout"),k.value?(c(),u("button",{key:0,onClick:C,class:"btn-primary"},"Reintentar verificaci√≥n")):W("",!0)])]))])]))}},me=F(ne,[["__scopeId","data-v-cff56bdd"]]);export{me as default};
