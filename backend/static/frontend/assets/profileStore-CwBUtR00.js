import{G as ke,r as v,i as l,R as n,K as I,S as p,J as E,H as j}from"../index.js";const je=ke("profile",()=>{const t=v(null),u=v(!1),a=v(null),z=l(()=>!!t.value),A=l(()=>t.value?{id:t.value.id,email:t.value.email,username:t.value.username,first_name:t.value.first_name,last_name:t.value.last_name,full_name:t.value.full_name,phone:t.value.phone,about:t.value.about,current_status:t.value.current_status,note:t.value.note,date_joined:t.value.date_joined,is_active:t.value.is_active,is_guest_converted:t.value.is_guest_converted,profile_picture:t.value.profile_picture}:null),g=l(()=>{var e;return((e=t.value)==null?void 0:e.addresses)||[]}),B=l(()=>g.value.find(e=>e.is_default)||g.value[0]||null),G=l(()=>g.value.length>0),w=l(()=>{var e;return((e=t.value)==null?void 0:e.gallery_photos)||[]}),L=l(()=>w.value.find(e=>e.is_profile_picture)||null),R=l(()=>{var e;return((e=t.value)==null?void 0:e.profile_picture_url)||null}),S=l(()=>{var e;return((e=t.value)==null?void 0:e.cover_image_url)||null}),M=l(()=>w.value.length>0),C=l(()=>{var e;return((e=t.value)==null?void 0:e.is_crush)||!1}),y=l(()=>{var e;return((e=t.value)==null?void 0:e.crush_verification_status)||"none"}),V=l(()=>{var e;return((e=t.value)==null?void 0:e.crush_requested_at)||null}),x=l(()=>{var e;return((e=t.value)==null?void 0:e.crush_verified_at)||null}),N=l(()=>{var e;return((e=t.value)==null?void 0:e.crush_rejection_reason)||null}),T=l(()=>C.value&&y.value==="approved"),J=l(()=>y.value==="none"||y.value==="rejected"),W=l(()=>y.value==="pending"),P=l(()=>{var e;return((e=t.value)==null?void 0:e.links)||[]}),H=l(()=>[...P.value].sort((e,s)=>e.order-s.order)),K=l(()=>P.value.length>0),O=l(()=>{var e;return((e=t.value)==null?void 0:e.guest_profile)||null}),D=l(()=>{var e;return((e=t.value)==null?void 0:e.is_guest_converted)||!1});async function Q(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await I("auth/profile/");return t.value=r.data,{success:!0,data:r.data}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al obtener el perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function X(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await p("auth/update_profile/",e);return t.value=r.data,{success:!0,data:r.data,message:"Perfil actualizado correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al actualizar el perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function Y(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r={...e.basicInfo,addresses:e.addresses||void 0,links:e.links||void 0,gallery_photos:e.gallery_photos||void 0},o=await p("auth/update_profile/",r);return t.value=o.data,{success:!0,data:o.data,message:"Perfil actualizado correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al actualizar el perfil completo",{success:!1,error:a.value}}finally{u.value=!1}}async function Z(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;e.basicInfo&&Object.keys(e.basicInfo).forEach(c=>{e.basicInfo[c]!==null&&e.basicInfo[c]!==void 0&&r.append(c,e.basicInfo[c])}),e.images.forEach((c,m)=>{const h=m+1;if(r.append(`gallery_image_${h}`,c),e.imageMeta&&e.imageMeta[m]){const _=e.imageMeta[m];_.caption&&r.append(`gallery_caption_${h}`,_.caption),_.is_profile_picture!==void 0&&r.append(`gallery_is_profile_${h}`,_.is_profile_picture?"true":"false")}});const o=await p("auth/update_profile/",r);return t.value=o.data,{success:!0,data:o.data,message:"Imágenes subidas correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir imágenes",{success:!1,error:a.value}}finally{u.value=!1}}async function ee(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};if(!(e instanceof File))return a.value="El archivo no es válido",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;r.append("profile_picture",e);const o=await p("auth/update_profile/",r);return t.value=o.data,{success:!0,data:o.data,message:"Foto de perfil actualizada correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir la foto de perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function ae(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};if(!(e instanceof File))return a.value="El archivo no es válido",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;r.append("cover_image",e);const o=await p("auth/update_profile/",r);return t.value=o.data,{success:!0,data:o.data,message:"Foto de portada actualizada correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir la foto de portada",{success:!1,error:a.value}}finally{u.value=!1}}async function re(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};if(!e.profilePicture&&!e.coverImage)return a.value="No se proporcionó ninguna imagen",{success:!1,error:a.value};if(e.profilePicture&&!(e.profilePicture instanceof File))return a.value="El archivo de foto de perfil no es válido",{success:!1,error:a.value};if(e.coverImage&&!(e.coverImage instanceof File))return a.value="El archivo de portada no es válido",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;e.profilePicture&&r.append("profile_picture",e.profilePicture),e.coverImage&&r.append("cover_image",e.coverImage);const o=await p("auth/update_profile/",r);return t.value=o.data,{success:!0,data:o.data,message:"Imágenes actualizadas correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir las imágenes",{success:!1,error:a.value}}finally{u.value=!1}}async function se(){var e;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const s=await p("auth/profile/update/",{profile_picture:null});return t.value=s.data,{success:!0,data:s.data,message:"Foto de perfil eliminada correctamente"}}catch(s){return a.value=((e=s.response)==null?void 0:e.data)||"Error al eliminar la foto de perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function te(){var e;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const s=await p("auth/profile/update/",{cover_image:null});return t.value=s.data,{success:!0,data:s.data,message:"Foto de portada eliminada correctamente"}}catch(s){return a.value=((e=s.response)==null?void 0:e.data)||"Error al eliminar la foto de portada",{success:!1,error:a.value}}finally{u.value=!1}}function ue(e,s=5*1024*1024){const r=[];return e?(["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)||r.push("Formato de imagen no válido. Usa JPG, PNG, GIF o WEBP"),e.size>s&&r.push(`El archivo excede el tamaño máximo de ${s/1024/1024}MB`),{valid:r.length===0,errors:r}):(r.push("No se ha seleccionado ningún archivo"),{valid:!1,errors:r})}function le(e){if(!e)return null;const s=e.includes("?")?"&":"?";return`${e}${s}t=${Date.now()}`}async function oe(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await E("auth/crush/request-verification/",{});return t.value&&(t.value.crush_verification_status=r.data.crush_verification_status,t.value.crush_requested_at=r.data.crush_requested_at),{success:!0,data:r.data,message:r.data.message||"Solicitud de verificación enviada correctamente"}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al solicitar verificación de Crush",{success:!1,error:a.value}}finally{u.value=!1}}async function ne(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await E("auth/crush/cancel-request/",{});return t.value&&(t.value.crush_verification_status=r.data.crush_verification_status,t.value.crush_requested_at=null),{success:!0,data:r.data,message:r.data.message||"Solicitud de verificación cancelada correctamente"}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al cancelar solicitud de verificación",{success:!1,error:a.value}}finally{u.value=!1}}function ce(e){return g.value.find(s=>s.id===e)||null}function ie(e){return w.value.find(s=>s.id===e)||null}function de(e){return P.value.find(s=>s.id===e)||null}function ve(e){return P.value.filter(s=>s.platform===e)}function fe(){t.value=null,a.value=null}function pe(){a.value=null}const d=v([]),f=v([]),U=v(!1);async function _e(e=!1){var s,r;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};U.value=!0,a.value=null;try{const c=await I(e?"favorites/products/?refresh=true":"favorites/products/");return d.value=c.data.data||[],{success:!0,data:d.value,meta:c.data.meta}}catch(o){return a.value=((r=(s=o.response)==null?void 0:s.data)==null?void 0:r.error)||"Error al obtener productos favoritos",{success:!1,error:a.value}}finally{U.value=!1}}async function me(){var e,s;if(!n())return{success:!1,error:"Usuario no autenticado"};try{const r=await I("favorites/products/ids/");return f.value=r.data.product_ids||[],{success:!0,data:f.value,count:r.data.count}}catch(r){return{success:!1,error:(s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error}}}async function he(e){var s,r,o,c,m,h,_,k,$;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const i=await E("favorites/products/add/",{woocommerce_product_id:e});if(i.data.data){const Ce={id:i.data.data.id,woocommerce_product_id:i.data.data.woocommerce_product_id,product_name:(s=i.data.data.product_data)==null?void 0:s.name,product_price:(r=i.data.data.product_data)==null?void 0:r.price,product_image:(m=(c=(o=i.data.data.product_data)==null?void 0:o.images)==null?void 0:c[0])==null?void 0:m.src,product_slug:(h=i.data.data.product_data)==null?void 0:h.slug,is_in_stock:((_=i.data.data.product_data)==null?void 0:_.stock_status)==="instock",created_at:i.data.data.created_at};d.value.unshift(Ce),f.value.push(e)}return{success:!0,message:i.data.message,data:i.data.data}}catch(i){return a.value=(($=(k=i.response)==null?void 0:k.data)==null?void 0:$.error)||"Error al agregar producto a favoritos",{success:!1,error:a.value}}finally{u.value=!1}}async function ge(e){var s,r;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const o=await j(`favorites/products/${e}/`);return d.value=d.value.filter(c=>c.woocommerce_product_id!==e),f.value=f.value.filter(c=>c!==e),{success:!0,message:o.data.message}}catch(o){return a.value=((r=(s=o.response)==null?void 0:s.data)==null?void 0:r.error)||"Error al eliminar producto de favoritos",{success:!1,error:a.value}}finally{u.value=!1}}async function ye(e){if(!n())return{success:!1,is_favorited:!1};try{return{success:!0,is_favorited:(await I(`favorites/products/${e}/status/`)).data.is_favorited}}catch{return{success:!1,is_favorited:!1}}}function Pe(e){return f.value.includes(e)}async function Fe(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await E("favorites/products/refresh/",{});return{success:!0,message:r.data.message,stats:r.data.stats,errors:r.data.errors}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al actualizar productos favoritos",{success:!1,error:a.value}}finally{u.value=!1}}async function Ie(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await j("favorites/products/clear/");return d.value=[],f.value=[],{success:!0,message:r.data.message}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al limpiar favoritos",{success:!1,error:a.value}}finally{u.value=!1}}const we=l(()=>d.value.length>0),Ee=l(()=>d.value.length),F=v([]),b=v(!1),q=v({count:0,next:null,previous:null});async function Ue(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};b.value=!0,a.value=null;try{const r=await I("feeds/my-feeds/");return F.value=r.data.results||[],q.value={count:r.data.count,next:r.data.next,previous:r.data.previous},{success:!0,data:F.value,pagination:q.value}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al obtener el feed",{success:!1,error:a.value}}finally{b.value=!1}}const be=l(()=>F.value.length>0),qe=l(()=>F.value.length);return{profile:t,isLoading:u,error:a,favoriteProducts:d,favoriteProductIds:f,isLoadingFavorites:U,hasProfile:z,userInfo:A,addresses:g,defaultAddress:B,hasAddresses:G,galleryPhotos:w,profilePicture:L,profilePictureUrl:R,coverImageUrl:S,hasGalleryPhotos:M,links:P,sortedLinks:H,hasLinks:K,guestProfile:O,isGuestConverted:D,isCrush:C,crushVerificationStatus:y,crushRequestedAt:V,crushVerifiedAt:x,crushRejectionReason:N,isCrushVerified:T,canRequestCrushVerification:J,hasPendingCrushRequest:W,hasFavorites:we,totalFavorites:Ee,fetchProfile:Q,updateProfile:X,updateProfileComplete:Y,uploadGalleryImages:Z,uploadProfilePicture:ee,uploadCoverImage:ae,uploadProfileImages:re,removeProfilePicture:se,removeCoverImage:te,validateImageFile:ue,getImageUrlWithCacheBusting:le,requestCrushVerification:oe,cancelCrushRequest:ne,getAddressById:ce,getPhotoById:ie,getLinkById:de,getLinksByPlatform:ve,clearProfile:fe,clearError:pe,fetchFavoriteProducts:_e,fetchFavoriteProductIds:me,addProductToFavorites:he,removeProductFromFavorites:ge,checkProductFavoriteStatus:ye,isProductInFavorites:Pe,refreshAllFavoriteProducts:Fe,clearAllFavorites:Ie,feedItems:F,isLoadingFeed:b,feedPagination:q,hasFeedItems:be,totalFeedItems:qe,fetchMyFeed:Ue}});export{je as u};
