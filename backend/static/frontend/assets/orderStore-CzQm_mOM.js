import{G as X,r as d,i as o,K as g,J as F}from"../index.js";import{O as c,a as Y}from"./constants-DjCFsGER.js";const re=X("order",()=>{const s=d([]),i=d(null),h=d([]),O=d(null),v=d(!1),y=d(!1),E=d(!1),n=d(null),_=o(()=>s.value.length),L=o(()=>{const e={};return Object.values(c).forEach(r=>{e[r]=s.value.filter(a=>a.status===r)}),e}),m=o(()=>s.value.filter(e=>e.status===c.PENDING)),I=o(()=>s.value.filter(e=>e.status===c.PROCESSING)),k=o(()=>s.value.filter(e=>e.status===c.SHIPPED)),S=o(()=>s.value.filter(e=>e.status===c.DELIVERED)),w=o(()=>s.value.filter(e=>e.status===c.CANCELLED)),P=o(()=>s.value.length>0),R=o(()=>S.value.reduce((e,r)=>e+parseFloat(r.total),0));async function N(){var e,r;v.value=!0,n.value=null;try{const a=await g("orders/history/");return s.value=a.data.purchases||a.data.orders||[],{success:!0,data:s.value}}catch(a){return n.value=((r=(e=a.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to fetch orders",{success:!1,error:n.value}}finally{v.value=!1}}async function b(e){var r,a;y.value=!0,n.value=null;try{const t=await g(`orders/${e}/`);i.value=t.data.order;const l=s.value.findIndex(u=>u.id===e);return l!==-1&&(s.value[l]=t.data.order),{success:!0,data:t.data.order}}catch(t){return n.value=((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.error)||"Failed to fetch order",i.value=null,{success:!1,error:n.value}}finally{y.value=!1}}async function T(e){var r,a,t,l;E.value=!0,n.value=null;try{const u=await F("orders/create/",e),f=u.data.order;return i.value=f,s.value.unshift(f),{success:!0,message:u.data.message,data:f}}catch(u){return n.value=((a=(r=u.response)==null?void 0:r.data)==null?void 0:a.details)||((l=(t=u.response)==null?void 0:t.data)==null?void 0:l.error)||"Failed to create order",{success:!1,error:n.value}}finally{E.value=!1}}async function G(e,r=""){var a,t,l,u,f;v.value=!0,n.value=null;try{const p=await F(`orders/${e}/cancel/`,{reason:r}),D=p.data.order,C=s.value.findIndex(W=>W.id===e);return C!==-1&&(s.value[C]=D),((a=i.value)==null?void 0:a.id)===e&&(i.value=D),{success:!0,message:p.data.message,data:D}}catch(p){return n.value=((l=(t=p.response)==null?void 0:t.data)==null?void 0:l.details)||((f=(u=p.response)==null?void 0:u.data)==null?void 0:f.error)||"Failed to cancel order",{success:!1,error:n.value}}finally{v.value=!1}}async function x(e){var r,a;v.value=!0,n.value=null;try{const t=await g(`orders/track/${e}/`);return O.value=t.data.tracking,{success:!0,data:t.data.tracking}}catch(t){return n.value=((a=(r=t.response)==null?void 0:r.data)==null?void 0:a.error)||"Failed to track order",O.value=null,{success:!1,error:n.value}}finally{v.value=!1}}async function B(){var e,r;try{const a=await g("orders/recent/");return h.value=a.data.recent_orders||[],{success:!0,data:h.value}}catch(a){return n.value=((r=(e=a.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to fetch recent orders",{success:!1,error:n.value}}}function A(e){return s.value.find(r=>r.id===e)||null}function $(e){return Y[e]||e}function q(e){return e&&[c.PENDING,c.PROCESSING].includes(e.status)}function H(e){return e&&e.status===c.DELIVERED}function U(e){return e&&[c.PROCESSING,c.SHIPPED].includes(e.status)}function V(e){return s.value.filter(r=>r.status===e)}function j(e,r){return s.value.filter(a=>{const t=new Date(a.created_at);return t>=e&&t<=r})}function J(e="created_at",r="desc"){const a=[...s.value].sort((t,l)=>{let u=0;switch(e){case"created_at":u=new Date(t.created_at)-new Date(l.created_at);break;case"total":u=parseFloat(t.total)-parseFloat(l.total);break;case"status":u=t.status.localeCompare(l.status);break;case"order_number":u=t.order_number.localeCompare(l.order_number);break;default:u=0}return r==="desc"?-u:u});return s.value=a,a}function K(){i.value=null}function z(){O.value=null}function M(){n.value=null}function Q(){return{total:_.value,by_status:{pending:m.value.length,processing:I.value.length,shipped:k.value.length,delivered:S.value.length,cancelled:w.value.length},total_spent:R.value}}return{orders:s,currentOrder:i,recentOrders:h,orderTracking:O,isLoading:v,isLoadingOrder:y,isCreatingOrder:E,error:n,totalOrders:_,ordersByStatus:L,pendingOrders:m,processingOrders:I,shippedOrders:k,deliveredOrders:S,cancelledOrders:w,hasOrders:P,totalSpent:R,fetchOrders:N,fetchOrder:b,createOrder:T,cancelOrder:G,trackOrder:x,fetchRecentOrders:B,getOrderById:A,getStatusLabel:$,canCancelOrder:q,isOrderDelivered:H,isOrderInTransit:U,filterOrdersByStatus:V,filterOrdersByDateRange:j,sortOrders:J,clearCurrentOrder:K,clearOrderTracking:z,clearError:M,getOrderStatistics:Q}});export{re as u};
