import{I as Y,r as y,l as w,M as h,L as _}from"../index.js";const k=Y("payment",()=>{const g=y(null),P=y(null),v=y(null),f=y(null),p=y(!1),d=y(!1),r=y(null),O=w(()=>g.value!==null),E=w(()=>f.value==="COMPLETED"),M=w(()=>{var t;return((t=g.value)==null?void 0:t.client_id)||null});async function T(){var t,n;p.value=!0,r.value=null;try{const e=await h("orders/paypal/config/");return g.value={client_id:e.data.client_id,currency:e.data.currency,mode:e.data.mode},{success:!0,data:g.value}}catch(e){return r.value=((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.error)||"Failed to fetch PayPal configuration",{success:!1,error:r.value}}finally{p.value=!1}}async function C(t){var n,e,s,o;d.value=!0,r.value=null;try{const a=await _("orders/paypal/create/",t),l={paypal_order_id:a.data.paypal_order_id,total:a.data.total,items_count:a.data.items_count};return v.value=l,{success:!0,data:l,paypal_order_id:l.paypal_order_id}}catch(a){return r.value=((e=(n=a.response)==null?void 0:n.data)==null?void 0:e.error)||"Failed to create PayPal order",{success:!1,error:r.value,details:(o=(s=a.response)==null?void 0:s.data)==null?void 0:o.details}}finally{d.value=!1}}async function W(t,n){var e,s,o,a,l,c;d.value=!0,r.value=null;try{const u=await _("orders/paypal/capture/",n),i={order:u.data.order,payment:u.data.payment,woocommerce_integration:u.data.woocommerce_integration};return v.value=i.order,f.value=i.payment.status,{success:!0,data:i,order:i.order,payment:i.payment}}catch(u){return r.value=((s=(e=u.response)==null?void 0:e.data)==null?void 0:s.error)||"Failed to capture PayPal payment",{success:!1,error:r.value,details:(a=(o=u.response)==null?void 0:o.data)==null?void 0:a.details,paypal_status:(c=(l=u.response)==null?void 0:l.data)==null?void 0:c.paypal_status}}finally{d.value=!1}}async function F(t){var n,e,s,o,a,l;d.value=!0,r.value=null;try{console.log("üéÅ [GIFT] Enviando regalo:",t);const c=await _("orders/gifts/send/",t);return console.log("‚úÖ [GIFT] Regalo enviado exitosamente:",c.data),{success:!0,data:c.data,paypal_order_id:c.data.paypal_order_id,receiver_info:c.data.receiver_info}}catch(c){return console.error("‚ùå [GIFT] Error enviando regalo:",c),{success:!1,error:((e=(n=c.response)==null?void 0:n.data)==null?void 0:e.error)||"Failed to send gift",details:(o=(s=c.response)==null?void 0:s.data)==null?void 0:o.missing_fields,user_info:(l=(a=c.response)==null?void 0:a.data)==null?void 0:l.user_info}}finally{d.value=!1}}async function I(){var t,n;p.value=!0,r.value=null;try{const e=await h("orders/wompi/config/");return P.value={public_key:e.data.public_key,currency:e.data.currency,environment:e.data.environment},{success:!0,data:P.value}}catch(e){return r.value=((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.error)||"Failed to fetch Wompi configuration",{success:!1,error:r.value}}finally{p.value=!1}}async function S(t){var n,e,s,o;d.value=!0,r.value=null;try{console.log("üí≥ [WOMPI] Creando transacci√≥n...",t);const a=await _("orders/wompi/create/",t),l={transaction_id:a.data.transaction_id||a.data.id,payment_url:a.data.payment_url||a.data.url,reference:a.data.reference,total:a.data.total,amount_in_cents:a.data.amount_in_cents,items_count:a.data.items_count};return v.value=l,console.log("‚úÖ [WOMPI] Transacci√≥n creada:",l),{success:!0,data:l}}catch(a){return console.error("‚ùå [WOMPI] Error creando transacci√≥n:",a),r.value=((e=(n=a.response)==null?void 0:n.data)==null?void 0:e.error)||"Failed to create Wompi transaction",{success:!1,error:r.value,details:(o=(s=a.response)==null?void 0:s.data)==null?void 0:o.details}}finally{d.value=!1}}async function R(t,n){var e,s,o,a,l,c;d.value=!0,r.value=null;try{console.log("‚úÖ [WOMPI] Confirmando pago...",{transactionId:t,confirmData:n});const u={transaction_id:t,...n},i=await _("orders/wompi/confirm/",u),m={order:i.data.order,payment:i.data.payment,woocommerce_integration:i.data.woocommerce_integration};return v.value=m.order,f.value=m.payment.status,console.log("‚úÖ [WOMPI] Pago confirmado:",m),{success:!0,data:m,order:m.order,payment:m.payment}}catch(u){return console.error("‚ùå [WOMPI] Error confirmando pago:",u),r.value=((s=(e=u.response)==null?void 0:e.data)==null?void 0:s.error)||"Failed to confirm Wompi payment",{success:!1,error:r.value,details:(a=(o=u.response)==null?void 0:o.data)==null?void 0:a.details,status:(c=(l=u.response)==null?void 0:l.data)==null?void 0:c.status}}finally{d.value=!1}}function G(){v.value=null,f.value=null,r.value=null}function L(){r.value=null}async function A(t){var n,e,s;p.value=!0,r.value=null;try{console.log("üéüÔ∏è [PAYMENT STORE] Validando c√≥digo de descuento:",t);const o=await _("discounts/validate/",{code:t});return console.log("üéüÔ∏è [PAYMENT STORE] Respuesta de validaci√≥n:",o.data),{success:!0,data:o.data}}catch(o){return console.error("‚ùå [PAYMENT STORE] Error validando c√≥digo:",o),r.value=((e=(n=o.response)==null?void 0:n.data)==null?void 0:e.error)||"Failed to validate discount code",{success:!1,error:r.value,data:(s=o.response)==null?void 0:s.data}}finally{p.value=!1}}function N(){return{hasConfig:O.value,isLoading:p.value,isProcessing:d.value,currentOrder:v.value,paymentStatus:f.value,error:r.value}}return{paypalConfig:g,wompiConfig:P,currentOrder:v,paymentStatus:f,isLoading:p,isProcessing:d,error:r,hasPayPalConfig:O,isPaymentComplete:E,paypalClientId:M,fetchPayPalConfig:T,createPayPalOrder:C,capturePayPalOrder:W,sendGift:F,fetchWompiConfig:I,createWompiTransaction:S,confirmWompiPayment:R,validateDiscountCode:A,clearPaymentState:G,clearError:L,getPaymentState:N}});export{k as u};
