import{p as A,u as L,q as F,r as f,B as P,j as q,C as w,c,o as i,a as s,d as C,t as n,s as z,F as T,g as j,b as g,w as H,e as K,f as N,k as U,v as E,x}from"../index.js";import{u as G}from"./authStore-BFns-WxD.js";import{u as J}from"./useAlert-P81MXwWp.js";import{L as O}from"./LanguageSelector-vuDdTwQ1.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";const W={class:"reset-code-view"},X={class:"reset-code-container"},Y={class:"reset-code-card"},Z={class:"welcome-section"},ee={class:"welcome-title"},te={class:"welcome-subtitle"},se={class:"code-inputs"},oe=["onUpdate:modelValue","placeholder","onInput","onKeydown","onPaste"],re=["disabled"],ae={key:0},ne={key:1,class:"loading-spinner"},le={class:"resend-link"},ce={class:"resend-text"},ie=["disabled"],de={key:0,class:"loading-spinner"},ue={key:1},pe={key:2},ve={class:"back-link"},he={__name:"ResetCodeView",setup(fe){const b=U(),I=P(),{t:v}=A(),_=L(),$=G(),{showError:m,showSuccess:B}=J(),d=F(["","","",""]),k=f(!1),h=f(!1),u=f(0),a=f([]),y=f(I.query.email||"");q(async()=>{await w(),a.value&&a.value[0]&&a.value[0].focus()});const S=(e,t)=>{const r=e.target.value.replace(/[^0-9]/g,"");r.length<=1&&(d[t]=r,r&&t<3&&w(()=>{var l;(l=a.value[t+1])==null||l.focus()}))},V=(e,t)=>{var r,l;e.key==="Backspace"&&!d[t]&&t>0&&w(()=>{var o;(o=a.value[t-1])==null||o.focus()}),e.key==="ArrowLeft"&&t>0&&((r=a.value[t-1])==null||r.focus()),e.key==="ArrowRight"&&t<3&&((l=a.value[t+1])==null||l.focus())},M=(e,t)=>{e.preventDefault();const r=e.clipboardData.getData("text").replace(/[^0-9]/g,"");for(let o=0;o<Math.min(r.length,4-t);o++)d[t+o]=r[o];const l=Math.min(t+r.length,3);w(()=>{var o;(o=a.value[l])==null||o.focus()})},R=async()=>{const e=d.join("");if(e.length!==4){m(v("resetCode.validation.codeLength"));return}if(!/^\d{4}$/.test(e)){m(v("resetCode.validation.codeRequired"));return}b.push({path:`/${_.locale}/reset-password`,query:{email:y.value,reset_code:e}})},D=async()=>{if(!(u.value>0||h.value)){h.value=!0;try{const e=await $.forgotPassword(y.value);if(e.success){B(v("resetCode.resendSuccess")),u.value=60;const t=setInterval(()=>{u.value--,u.value<=0&&clearInterval(t)},1e3)}else m(v("resetCode.errors.resendFailed")+e.error)}catch(e){console.error("Resend code failed:",e),m(v("resetCode.errors.resendFailed")+(e.message||"Unknown error"))}finally{h.value=!1}}};return(e,t)=>{const r=N("router-link");return i(),c("div",W,[t[3]||(t[3]=s("div",{class:"background-container"},[s("div",{class:"background-overlay"})],-1)),C(O,{position:"absolute",theme:"light"}),s("div",X,[s("div",Y,[s("div",Z,[s("h2",ee,n(e.$t("resetCode.title")),1),s("p",te,n(e.$t("resetCode.subtitle")),1)]),s("form",{onSubmit:z(R,["prevent"]),class:"reset-code-form"},[s("div",se,[(i(!0),c(T,null,j(d,(l,o)=>E((i(),c("input",{key:o,ref_for:!0,ref_key:"codeInputs",ref:a,"onUpdate:modelValue":p=>d[o]=p,type:"text",maxlength:"1",inputmode:"numeric",pattern:"[0-9]",placeholder:e.$t("resetCode.codePlaceholder"),class:"code-input",onInput:p=>S(p,o),onKeydown:p=>V(p,o),onPaste:p=>M(p,o)},null,40,oe)),[[x,d[o]]])),128))]),s("button",{type:"submit",class:"submit-btn",disabled:k.value},[k.value?(i(),c("span",ne,[t[0]||(t[0]=s("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),g(" "+n(e.$t("resetCode.verifyingButton")),1)])):(i(),c("span",ae,n(e.$t("resetCode.verifyButton")),1))],8,re)],32),s("div",le,[s("span",ce,n(e.$t("resetCode.didntReceive")),1),s("button",{onClick:D,disabled:h.value||u.value>0,class:"resend-btn"},[h.value?(i(),c("span",de,[t[1]||(t[1]=s("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),g(" "+n(e.$t("resetCode.resendingButton")),1)])):u.value>0?(i(),c("span",ue,n(u.value)+"s ",1)):(i(),c("span",pe,n(e.$t("resetCode.resend")),1))],8,ie)]),s("div",ve,[C(r,{to:`/${K(_).locale}/forgot-password`,class:"back-link-text"},{default:H(()=>[t[2]||(t[2]=s("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),g(" "+n(e.$t("resetCode.backToForgot")),1)]),_:1},8,["to"])])])])])}}},Ce=Q(he,[["__scopeId","data-v-91f8f4d5"]]);export{Ce as default};
