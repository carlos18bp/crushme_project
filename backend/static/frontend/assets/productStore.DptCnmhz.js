import{I as ra,r as u,l as i,M as l}from"./index.BlaEpoyn.js";import{P as X}from"./constants.DjCFsGER.js";const ca=ra("product",()=>{const f=u([]),$=u(null),W=u([]),U=u([]),m=u([]),L=u([]),y=u([]),P=u([]),v=u([]),z=u([]),R=u(null),E=u([]),_=u(null),O=u(null),T=u(""),C=u(""),Y=u(null),D=u([]),p=u(!1),I=u(!1),G=u(!1),g=u(!1),w=u(!1),M=u(!1),S=u(!1),N=u(!1),V=u(!1),d=u(null),c=u(null),k=u(""),F=u(""),A=u(""),b=i(()=>f.value.filter(e=>e.is_active)),Z=i(()=>b.value.filter(e=>e.is_in_stock)),q=i(()=>F.value?b.value.filter(e=>e.category===F.value):b.value),x=i(()=>X.map(e=>({...e,count:f.value.filter(t=>t.category===e.value&&t.is_active).length}))),ee=i(()=>f.value.length>0),ae=i(()=>m.value.length>0),h=i(()=>y.value.filter(e=>e.status==="publish")),te=i(()=>h.value.filter(e=>e.stock_status==="instock")),re=i(()=>A.value?h.value.filter(e=>e.categories.some(t=>t.id===A.value)):h.value),se=i(()=>P.value.map(e=>({...e,count:y.value.filter(t=>t.categories.some(a=>a.id===e.id)&&t.status==="publish").length}))),oe=i(()=>y.value.length>0),ce=i(()=>P.value.length>0),ue=i(()=>v.value.length>0),ne=i(()=>E.value.length>0),le=i(()=>D.value.length>0),de=i(()=>O.value==="OK"),K=i(()=>{if(!T.value)return h.value;const e=v.value.find(a=>a.theme===T.value);if(!e)return[];const t=new Set;return e.categories.forEach(a=>{t.add(a.id),a.has_subcategories&&a.subcategories&&a.subcategories.forEach(r=>t.add(r.id))}),h.value.filter(a=>a.categories.some(r=>t.has(r.id)))}),ie=i(()=>C.value?h.value.filter(e=>e.categories.some(t=>t.id===C.value)):K.value),fe=e=>{const t=v.value.find(a=>a.theme===e);return t?t.categories:[]},ve=e=>{for(const t of v.value){const a=t.categories.find(r=>r.id===e);if(a&&a.has_subcategories)return a.subcategories||[]}return[]};async function ge(){var e,t;p.value=!0,d.value=null;try{const a=await l("products/");return f.value=a.data.products||[],{success:!0,data:f.value}}catch(a){return d.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch products",{success:!1,error:d.value}}finally{p.value=!1}}async function pe(e){var t,a;I.value=!0,d.value=null;try{const r=await l(`products/${e}/`);return $.value=r.data.product,{success:!0,data:r.data.product}}catch(r){return d.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch product",$.value=null,{success:!1,error:d.value}}finally{I.value=!1}}async function he(e){var t,a;p.value=!0,d.value=null,F.value=e;try{const s=(await l(`products/category/?category=${e}`)).data.products||[];return f.value=f.value.filter(o=>o.category!==e),f.value.push(...s),{success:!0,data:s}}catch(r){return d.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch category products",{success:!1,error:d.value}}finally{p.value=!1}}async function me(e){var t,a;if(!e||e.length<2)return m.value=[],k.value="",{success:!0,data:[]};G.value=!0,d.value=null,k.value=e;try{const r=await l(`products/search/?q=${encodeURIComponent(e)}`);return m.value=r.data.products||[],{success:!0,data:m.value}}catch(r){return d.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Search failed",m.value=[],{success:!1,error:d.value}}finally{G.value=!1}}async function ye(){try{const e=await l("products/categories/");return W.value=e.data.categories||[],{success:!0,data:W.value}}catch{return W.value=X,{success:!0,data:W.value}}}async function Ce(){var e,t;try{const a=await l("products/featured/");return U.value=a.data.featured_products||[],{success:!0,data:U.value}}catch(a){return d.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch featured products",{success:!1,error:d.value}}}async function we(e){var t,a;try{const r=await l(`products/${e}/recommendations/`);return L.value=r.data.recommendations||[],{success:!0,data:L.value}}catch(r){return L.value=[],{success:!1,error:((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch recommendations"}}}function Ee(e){return f.value.find(t=>t.id===e)||null}function _e(){m.value=[],k.value=""}function We(){F.value=""}function Pe(){$.value=null}function Re(){d.value=null}function Te(e){p.value=e}function Se(e,t){let a=b.value;return e!=null&&(a=a.filter(r=>r.price>=e)),t!=null&&(a=a.filter(r=>r.price<=t)),a}function Fe(e,t="name",a="asc"){return[...e].sort((s,o)=>{let n=0;switch(t){case"name":n=s.name.localeCompare(o.name);break;case"price":n=s.price-o.price;break;case"date":n=new Date(s.created_at)-new Date(o.created_at);break;default:n=0}return a==="desc"?-n:n})}async function Ae(){var e,t;g.value=!0,c.value=null;try{const a=await l("products/woocommerce/test/");return O.value=a.data.connection_status,{success:!0,data:a.data}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to test WooCommerce connection",O.value="ERROR",{success:!1,error:c.value}}finally{g.value=!1}}async function B({categoryId:e=null,perPage:t=10,page:a=1}={}){var r,s;g.value=!0,c.value=null;try{let o=`products/woocommerce/products/?per_page=${t}&page=${a}`;e&&(o+=`&category_id=${e}`);const n=await l(o),J=n.data.data||[];return y.value=J,{success:!0,data:J,pagination:n.data.pagination_info}}catch(o){return c.value=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.error)||"Failed to fetch WooCommerce products",{success:!1,error:c.value}}finally{g.value=!1}}async function be(e,t=10,a=1){return A.value=e,await B({categoryId:e,perPage:t,page:a})}async function Be({perPage:e=100,page:t=1}={}){var a,r;M.value=!0,c.value=null;try{const s=await l(`products/woocommerce/categories/?per_page=${e}&page=${t}`);return t===1?P.value=s.data.data||[]:P.value.push(...s.data.data||[]),{success:!0,data:s.data.data||[],pagination:s.data.pagination_info}}catch(s){return c.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch WooCommerce categories",{success:!1,error:c.value}}finally{M.value=!1}}async function Q(){var e,t,a,r;S.value=!0,c.value=null;try{const s=await l("products/woocommerce/categories/organized/");return console.log("üöÄ RESPUESTA COMPLETA DEL BACKEND:",{status:s.status,data:s.data,headers:s.headers,fullResponse:s}),console.log("üìä DATOS DE TEMAS RECIBIDOS:",s.data.data),console.log("üî¢ TOTAL DE CATEGOR√çAS:",s.data.total_categories),v.value=s.data.data||[],{success:!0,data:s.data.data||[],total_categories:s.data.total_categories||0}}catch(s){return console.error("‚ùå ERROR EN LLAMADA AL BACKEND:",{message:s.message,response:s.response,status:(e=s.response)==null?void 0:e.status,data:(t=s.response)==null?void 0:t.data,fullError:s}),c.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch organized WooCommerce categories",{success:!1,error:c.value}}finally{S.value=!1}}async function $e(){var e,t;N.value=!0,c.value=null;try{const a=await l("products/woocommerce/categories/tree/");return z.value=a.data.data||[],{success:!0,data:a.data.data||[],total:a.data.total||0}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch WooCommerce category tree",{success:!1,error:c.value}}finally{N.value=!1}}async function Le(e){var t;w.value=!0,c.value=null;try{const a=await l(`products/woocommerce/products/${e}/`);if(a.data.success){const r=a.data.data;return R.value=r,{success:!0,data:r}}else return c.value=a.data.error||"Error desconocido del backend",R.value=null,{success:!1,error:c.value}}catch(a){let r="Failed to fetch WooCommerce product";return(t=a.response)!=null&&t.data&&(a.response.data.error?r=a.response.data.error:a.response.data.message&&(r=a.response.data.message)),c.value=r,R.value=null,{success:!1,error:c.value}}finally{w.value=!1}}async function Oe(e,t=100,a=1){var r;w.value=!0,c.value=null;try{const s=await l(`products/woocommerce/products/${e}/variations/?per_page=${t}&page=${a}`);if(s.data.success){const o=s.data.data||[];return E.value=o,{success:!0,data:o}}else return c.value=s.data.error||"Error desconocido del backend",E.value=[],{success:!1,error:c.value}}catch(s){let o="Failed to fetch product variations";return(r=s.response)!=null&&r.data&&(s.response.data.error?o=s.response.data.error:s.response.data.message&&(o=s.response.data.message)),c.value=o,E.value=[],{success:!1,error:c.value}}finally{w.value=!1}}async function De(e,t){var a;w.value=!0,c.value=null;try{const r=await l(`products/woocommerce/products/${e}/variations/${t}/`);if(r.data.success){const s=r.data.data;return _.value=s,{success:!0,data:s}}else return c.value=r.data.error||"Error desconocido del backend",_.value=null,{success:!1,error:c.value}}catch(r){let s="Failed to fetch product variation";return(a=r.response)!=null&&a.data&&(r.response.data.error?s=r.response.data.error:r.response.data.message&&(s=r.response.data.message)),c.value=s,_.value=null,{success:!1,error:c.value}}finally{w.value=!1}}function ke(){E.value=[],_.value=null}function Ue(e){_.value=e}function Ie(e){return y.value.find(t=>t.id===e)||null}function Ge(e,t){let a=h.value;return e!=null&&(a=a.filter(r=>parseFloat(r.price)>=e)),t!=null&&(a=a.filter(r=>parseFloat(r.price)<=t)),a}function Me(e,t="name",a="asc"){return[...e].sort((s,o)=>{let n=0;switch(t){case"name":n=s.name.localeCompare(o.name);break;case"price":n=parseFloat(s.price)-parseFloat(o.price);break;case"date":n=new Date(s.date_created)-new Date(o.date_created);break;case"popularity":n=s.total_sales-o.total_sales;break;case"rating":n=parseFloat(s.average_rating)-parseFloat(o.average_rating);break;default:n=0}return a==="desc"?-n:n})}function Ne(){A.value=""}function Ve(){R.value=null}function ze(){c.value=null}function Ye(){v.value=[]}function Ke(e){g.value=e}function Qe(e){T.value=e,C.value=""}function je(e){C.value=e}function He(){T.value="",C.value=""}function Je(){C.value=""}function j(e){return v.value.find(t=>t.theme===e)||null}function Xe(e){for(const t of v.value){const a=t.categories.find(r=>r.id===e);if(a)return a;for(const r of t.categories)if(r.has_subcategories&&r.subcategories){const s=r.subcategories.find(o=>o.id===e);if(s)return s}}return null}async function Ze(e,t=20,a=1){const r=j(e);if(!r)return{success:!1,error:"Tema no encontrado"};const s=r.categories.find(o=>o.is_main);return s?await B({categoryId:s.id,perPage:t,page:a}):r.categories.length>0?await B({categoryId:r.categories[0].id,perPage:t,page:a}):{success:!1,error:"No hay categor√≠as en este tema"}}async function H(){var e,t;g.value=!0,c.value=null;try{const a=await l("products/woocommerce/stats/");return Y.value=a.data.data||null,{success:!0,data:a.data.data||null}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch WooCommerce stats",{success:!1,error:c.value}}finally{g.value=!1}}async function qe(){var e,t;V.value=!0,c.value=null;try{const a=await l("products/woocommerce/products/trending/"),r=a.data.data||[];return D.value=r,{success:!0,data:r,total_products:a.data.total_products||0,message:a.data.message}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch trending products",D.value=[],{success:!1,error:c.value}}finally{V.value=!1}}async function xe(){var e,t,a,r;S.value=!0,c.value=null;try{const s=await l("products/woocommerce/categories/featured-random/");console.log("üöÄ RESPUESTA FEATURED CATEGORIES:",{status:s.status,data:s.data,headers:s.headers,fullResponse:s});const o=s.data.data||[];return v.value=o.map(n=>({theme:n.slug,name:n.name,icon:n.icon,first_product_image:n.first_product_image,category_id:n.category_id})),{success:!0,data:o,total_selected:s.data.total_selected||0,message:s.data.message}}catch(s){return console.error("‚ùå ERROR EN FEATURED CATEGORIES:",{message:s.message,response:s.response,status:(e=s.response)==null?void 0:e.status,data:(t=s.response)==null?void 0:t.data,fullError:s}),c.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch featured categories",{success:!1,error:c.value}}finally{S.value=!1}}async function ea(e,t=20,a=1){var r,s;p.value=!0,d.value=null;try{const o=await l(`products/category/?category=${encodeURIComponent(e)}&per_page=${t}&page=${a}`);return console.log("üöÄ RESPUESTA PRODUCTS BY CATEGORY SLUG:",{status:o.status,data:o.data,categorySlug:e,perPage:t,page:a}),{success:!0,data:o.data.products||[],pagination:o.data.pagination_info,total_products:o.data.total_products||0}}catch(o){return console.error("‚ùå ERROR EN PRODUCTS BY CATEGORY SLUG:",{message:o.message,response:o.response,categorySlug:e,fullError:o}),d.value=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.error)||"Failed to fetch category products",{success:!1,error:d.value}}finally{p.value=!1}}async function aa(e,t=1){var a,r,s;if(!e||e.trim().length<2)return{success:!0,data:[],message:"Query too short"};g.value=!0,c.value=null;try{const o=await l(`products/woocommerce/products/search/?q=${encodeURIComponent(e.trim())}&page=${t}`),n=o.data.data||[];return y.value=n,{success:!0,data:n,pagination:o.data.pagination||null,search:o.data.search||null,total:((a=o.data.pagination)==null?void 0:a.total_results)||n.length,message:o.data.message}}catch(o){return c.value=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.error)||"Failed to search products",{success:!1,error:c.value}}finally{g.value=!1}}async function ta(){try{const e=await Q();if(!e.success)return{success:!1,error:"Error cargando categor√≠as - No se pueden cargar productos sin categor√≠as"};const t=await B({perPage:9,page:1});return H(),{success:!0,themes:e.data,products:t.data||[],total_categories:e.total_categories,stats:null}}catch(e){return c.value=e.message||"Error inicializando WooCommerce",{success:!1,error:c.value}}}return{products:f,currentProduct:$,categories:W,featuredProducts:U,searchResults:m,recommendations:L,isLoading:p,isLoadingProduct:I,isLoadingSearch:G,error:d,searchQuery:k,selectedCategory:F,wooProducts:y,wooCategories:P,wooThemes:v,wooCategoryTree:z,wooCurrentProduct:R,wooProductVariations:E,wooCurrentVariation:_,wooConnectionStatus:O,wooStats:Y,trendingProducts:D,isLoadingWoo:g,isLoadingWooProduct:w,isLoadingWooCategories:M,isLoadingWooThemes:S,isLoadingWooCategoryTree:N,isLoadingTrending:V,wooError:c,selectedWooCategory:A,selectedTheme:T,selectedSubcategory:C,activeProducts:b,inStockProducts:Z,productsByCategory:q,categoriesWithCount:x,hasProducts:ee,hasSearchResults:ae,activeWooProducts:h,inStockWooProducts:te,wooProductsByCategory:re,wooCategoriesWithCount:se,hasWooProducts:oe,hasWooCategories:ce,hasWooThemes:ue,hasWooVariations:ne,hasTrendingProducts:le,isWooConnected:de,wooProductsByTheme:K,wooProductsBySubcategory:ie,getCategoriesByTheme:fe,getSubcategoriesByCategory:ve,fetchProducts:ge,fetchProduct:pe,fetchProductsByCategory:he,searchProducts:me,fetchCategories:ye,fetchFeaturedProducts:Ce,fetchRecommendations:we,getProductById:Ee,clearSearch:_e,clearCategory:We,clearCurrentProduct:Pe,clearError:Re,setLoading:Te,filterByPriceRange:Se,sortProducts:Fe,testWooConnection:Ae,fetchWooProducts:B,fetchWooProductsByCategory:be,fetchWooCategories:Be,fetchWooOrganizedCategories:Q,fetchWooCategoryTree:$e,fetchWooStats:H,fetchWooTrendingProducts:qe,fetchFeaturedCategories:xe,fetchProductsByCategorySlug:ea,searchWooProducts:aa,fetchWooProduct:Le,fetchWooProductVariations:Oe,fetchWooProductVariation:De,getWooProductById:Ie,filterWooByPriceRange:Ge,sortWooProducts:Me,clearWooCategory:Ne,clearWooCurrentProduct:Ve,clearWooVariations:ke,setWooCurrentVariation:Ue,clearWooError:ze,clearFeaturedCategories:Ye,setWooLoading:Ke,selectTheme:Qe,selectSubcategory:je,clearTheme:He,clearSubcategory:Je,getThemeBySlug:j,getCategoryById:Xe,fetchProductsByTheme:Ze,initializeWooCommerce:ta}});export{ca as u};
