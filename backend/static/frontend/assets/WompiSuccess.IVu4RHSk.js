import{N as R,u as W,r,o as x,c,b as i,d as o,e as m,t,m as D}from"./index.OMjhQo4e.js";import{u as M}from"./cartStore.5gDApDey.js";import{u as O}from"./paymentStore.C8M1MbWF.js";import{_ as T}from"./_plugin-vue_export-helper.DlAUqK2U.js";const V={class:"wompi-success-view"},B={class:"success-container"},L={key:0,class:"loading-state"},U={key:1,class:"success-state"},H={class:"order-details"},$={class:"order-number"},F={class:"order-total"},J={class:"order-email"},j={class:"redirect-message"},q={key:2,class:"error-state"},z={class:"error-message"},A={__name:"WompiSuccess",setup(G){const v=D(),h=M(),p=O(),k=R(),f=W(),u=r(!0),n=r(!1),g=r(""),_=r(0),y=r(""),d=r(""),l=r(3),b=s=>k.formatPrice(s);function w(){v.push({name:`Home-${f.locale}`})}function C(){v.push({name:`Checkout-${f.locale}`})}async function E(){u.value=!0,n.value=!1,d.value="",await P()}async function P(){try{const e=new URLSearchParams(window.location.search).get("id");if(!e)throw new Error("No se encontr√≥ el ID de transacci√≥n en la URL");console.log("‚úÖ [WOMPI] Transaction ID desde URL:",e);const S=localStorage.getItem("wompi_order_data");if(!S)throw new Error("No se encontraron los datos de la orden. Por favor vuelve al checkout.");const I=JSON.parse(S);console.log("üì¶ [WOMPI] Datos de orden recuperados:",I);const a=await p.confirmWompiPayment(e,I);if(a.success){console.log("‚úÖ [WOMPI] Pago confirmado exitosamente:",a.order),n.value=!0,g.value=a.order.order_number,_.value=parseFloat(a.order.total),y.value=a.order.email,localStorage.removeItem("wompi_transaction_id"),localStorage.removeItem("wompi_order_data"),sessionStorage.removeItem("checkout_order_data"),h.clearCart(),p.clearPaymentState();const N=setInterval(()=>{l.value--,l.value<=0&&(clearInterval(N),w())},1e3)}else throw new Error(a.error||"Error al confirmar el pago")}catch(s){console.error("‚ùå [WOMPI] Error al confirmar pago:",s),n.value=!1,d.value=s.message||"Error al verificar el pago. Por favor contacta a soporte."}finally{u.value=!1}}return x(async()=>{await P()}),(s,e)=>(i(),c("div",V,[o("div",B,[u.value?(i(),c("div",L,[...e[0]||(e[0]=[o("div",{class:"spinner"},null,-1),o("h2",null,"Verificando tu pago...",-1),o("p",null,"Por favor espera mientras confirmamos tu transacci√≥n",-1)])])):n.value?(i(),c("div",U,[e[4]||(e[4]=o("div",{class:"success-icon"},"‚úÖ",-1)),e[5]||(e[5]=o("h2",null,"¬°Pago Exitoso!",-1)),o("div",H,[o("p",$,[e[1]||(e[1]=m("N√∫mero de orden: ",-1)),o("strong",null,t(g.value),1)]),o("p",F,[e[2]||(e[2]=m("Total: ",-1)),o("strong",null,t(b(_.value)),1)]),o("p",J,[e[3]||(e[3]=m("Recibir√°s un email de confirmaci√≥n en: ",-1)),o("strong",null,t(y.value),1)])]),o("p",j,"Redirigiendo al inicio en "+t(l.value)+" segundo"+t(l.value!==1?"s":"")+"...",1),o("button",{onClick:w,class:"btn-primary"},"Ir al inicio ahora")])):(i(),c("div",q,[e[6]||(e[6]=o("div",{class:"error-icon"},"‚ùå",-1)),e[7]||(e[7]=o("h2",null,"Error en el Pago",-1)),o("p",z,t(d.value),1),o("div",{class:"error-actions"},[o("button",{onClick:C,class:"btn-secondary"},"Volver al checkout"),o("button",{onClick:E,class:"btn-primary"},"Reintentar verificaci√≥n")])]))])]))}},Z=T(A,[["__scopeId","data-v-a1ad1497"]]);export{Z as default};
