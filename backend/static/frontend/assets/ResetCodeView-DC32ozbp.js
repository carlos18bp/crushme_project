import{p as S,u as D,q as L,r as f,B as A,j as F,C as m,c,o as i,a as s,d as y,t as n,s as P,F as q,g as z,b as w,w as T,e as j,f as H,k as K,v as N,x as U}from"../index.js";import{u as x}from"./authStore-tY-7-Xic.js";import{L as E}from"./LanguageSelector-vuDdTwQ1.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";const J={class:"reset-code-view"},O={class:"reset-code-container"},Q={class:"reset-code-card"},W={class:"welcome-section"},X={class:"welcome-title"},Y={class:"welcome-subtitle"},Z={class:"code-inputs"},ee=["onUpdate:modelValue","placeholder","onInput","onKeydown","onPaste"],te=["disabled"],se={key:0},oe={key:1,class:"loading-spinner"},ae={class:"resend-link"},re={class:"resend-text"},ne=["disabled"],le={key:0,class:"loading-spinner"},ce={key:1},ie={key:2},de={class:"back-link"},ue={__name:"ResetCodeView",setup(pe){const C=K(),b=A(),{t:v}=S(),g=D(),I=x(),d=L(["","","",""]),_=f(!1),h=f(!1),u=f(0),r=f([]),k=f(b.query.email||"");F(async()=>{await m(),r.value&&r.value[0]&&r.value[0].focus()});const $=(e,t)=>{const a=e.target.value.replace(/[^0-9]/g,"");a.length<=1&&(d[t]=a,a&&t<3&&m(()=>{var l;(l=r.value[t+1])==null||l.focus()}))},B=(e,t)=>{var a,l;e.key==="Backspace"&&!d[t]&&t>0&&m(()=>{var o;(o=r.value[t-1])==null||o.focus()}),e.key==="ArrowLeft"&&t>0&&((a=r.value[t-1])==null||a.focus()),e.key==="ArrowRight"&&t<3&&((l=r.value[t+1])==null||l.focus())},V=(e,t)=>{e.preventDefault();const a=e.clipboardData.getData("text").replace(/[^0-9]/g,"");for(let o=0;o<Math.min(a.length,4-t);o++)d[t+o]=a[o];const l=Math.min(t+a.length,3);m(()=>{var o;(o=r.value[l])==null||o.focus()})},M=async()=>{const e=d.join("");if(e.length!==4){alert(v("resetCode.validation.codeLength"));return}if(!/^\d{4}$/.test(e)){alert(v("resetCode.validation.codeRequired"));return}C.push({path:`/${g.locale}/reset-password`,query:{email:k.value,reset_code:e}})},R=async()=>{if(!(u.value>0||h.value)){h.value=!0;try{const e=await I.forgotPassword(k.value);if(e.success){alert(v("resetCode.resendSuccess")),u.value=60;const t=setInterval(()=>{u.value--,u.value<=0&&clearInterval(t)},1e3)}else alert(v("resetCode.errors.resendFailed")+e.error)}catch(e){console.error("Resend code failed:",e),alert(v("resetCode.errors.resendFailed")+(e.message||"Unknown error"))}finally{h.value=!1}}};return(e,t)=>{const a=H("router-link");return i(),c("div",J,[t[3]||(t[3]=s("div",{class:"background-container"},[s("div",{class:"background-overlay"})],-1)),y(E,{position:"absolute",theme:"light"}),s("div",O,[s("div",Q,[s("div",W,[s("h2",X,n(e.$t("resetCode.title")),1),s("p",Y,n(e.$t("resetCode.subtitle")),1)]),s("form",{onSubmit:P(M,["prevent"]),class:"reset-code-form"},[s("div",Z,[(i(!0),c(q,null,z(d,(l,o)=>N((i(),c("input",{key:o,ref_for:!0,ref_key:"codeInputs",ref:r,"onUpdate:modelValue":p=>d[o]=p,type:"text",maxlength:"1",inputmode:"numeric",pattern:"[0-9]",placeholder:e.$t("resetCode.codePlaceholder"),class:"code-input",onInput:p=>$(p,o),onKeydown:p=>B(p,o),onPaste:p=>V(p,o)},null,40,ee)),[[U,d[o]]])),128))]),s("button",{type:"submit",class:"submit-btn",disabled:_.value},[_.value?(i(),c("span",oe,[t[0]||(t[0]=s("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),w(" "+n(e.$t("resetCode.verifyingButton")),1)])):(i(),c("span",se,n(e.$t("resetCode.verifyButton")),1))],8,te)],32),s("div",ae,[s("span",re,n(e.$t("resetCode.didntReceive")),1),s("button",{onClick:R,disabled:h.value||u.value>0,class:"resend-btn"},[h.value?(i(),c("span",le,[t[1]||(t[1]=s("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),w(" "+n(e.$t("resetCode.resendingButton")),1)])):u.value>0?(i(),c("span",ce,n(u.value)+"s ",1)):(i(),c("span",ie,n(e.$t("resetCode.resend")),1))],8,ne)]),s("div",de,[y(a,{to:`/${j(g).locale}/forgot-password`,class:"back-link-text"},{default:T(()=>[t[2]||(t[2]=s("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),w(" "+n(e.$t("resetCode.backToForgot")),1)]),_:1},8,["to"])])])])])}}},ge=G(ue,[["__scopeId","data-v-7d19d25f"]]);export{ge as default};
