import{G as Ee,r as h,i as o,Q as n,K as w,R as f,J as E,H as C}from"../index.js";const Ue=Ee("profile",()=>{const t=h(null),u=h(!1),a=h(null),k=o(()=>!!t.value),$=o(()=>t.value?{id:t.value.id,email:t.value.email,username:t.value.username,first_name:t.value.first_name,last_name:t.value.last_name,full_name:t.value.full_name,phone:t.value.phone,about:t.value.about,current_status:t.value.current_status,note:t.value.note,date_joined:t.value.date_joined,is_active:t.value.is_active,is_guest_converted:t.value.is_guest_converted,profile_picture:t.value.profile_picture}:null),g=o(()=>{var e;return((e=t.value)==null?void 0:e.addresses)||[]}),j=o(()=>g.value.find(e=>e.is_default)||g.value[0]||null),z=o(()=>g.value.length>0),F=o(()=>{var e;return((e=t.value)==null?void 0:e.gallery_photos)||[]}),A=o(()=>F.value.find(e=>e.is_profile_picture)||null),B=o(()=>{var e;return((e=t.value)==null?void 0:e.profile_picture_url)||null}),G=o(()=>{var e;return((e=t.value)==null?void 0:e.cover_image_url)||null}),R=o(()=>F.value.length>0),U=o(()=>{var e;return((e=t.value)==null?void 0:e.is_crush)||!1}),y=o(()=>{var e;return((e=t.value)==null?void 0:e.crush_verification_status)||"none"}),L=o(()=>{var e;return((e=t.value)==null?void 0:e.crush_requested_at)||null}),S=o(()=>{var e;return((e=t.value)==null?void 0:e.crush_verified_at)||null}),V=o(()=>{var e;return((e=t.value)==null?void 0:e.crush_rejection_reason)||null}),M=o(()=>U.value&&y.value==="approved"),N=o(()=>y.value==="none"||y.value==="rejected"),T=o(()=>y.value==="pending"),P=o(()=>{var e;return((e=t.value)==null?void 0:e.links)||[]}),J=o(()=>[...P.value].sort((e,s)=>e.order-s.order)),W=o(()=>P.value.length>0),H=o(()=>{var e;return((e=t.value)==null?void 0:e.guest_profile)||null}),K=o(()=>{var e;return((e=t.value)==null?void 0:e.is_guest_converted)||!1});async function O(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await w("auth/profile/");return t.value=r.data,{success:!0,data:r.data}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al obtener el perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function Q(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await f("auth/update_profile/",e);return t.value=r.data,{success:!0,data:r.data,message:"Perfil actualizado correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al actualizar el perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function x(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r={...e.basicInfo,addresses:e.addresses||void 0,links:e.links||void 0,gallery_photos:e.gallery_photos||void 0},l=await f("auth/update_profile/",r);return t.value=l.data,{success:!0,data:l.data,message:"Perfil actualizado correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al actualizar el perfil completo",{success:!1,error:a.value}}finally{u.value=!1}}async function D(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;e.basicInfo&&Object.keys(e.basicInfo).forEach(c=>{e.basicInfo[c]!==null&&e.basicInfo[c]!==void 0&&r.append(c,e.basicInfo[c])}),e.images.forEach((c,_)=>{const m=_+1;if(r.append(`gallery_image_${m}`,c),e.imageMeta&&e.imageMeta[_]){const p=e.imageMeta[_];p.caption&&r.append(`gallery_caption_${m}`,p.caption),p.is_profile_picture!==void 0&&r.append(`gallery_is_profile_${m}`,p.is_profile_picture?"true":"false")}});const l=await f("auth/update_profile/",r);return t.value=l.data,{success:!0,data:l.data,message:"Imágenes subidas correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir imágenes",{success:!1,error:a.value}}finally{u.value=!1}}async function X(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};if(!(e instanceof File))return a.value="El archivo no es válido",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;r.append("profile_picture",e);const l=await f("auth/update_profile/",r);return t.value=l.data,{success:!0,data:l.data,message:"Foto de perfil actualizada correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir la foto de perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function Y(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};if(!(e instanceof File))return a.value="El archivo no es válido",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;r.append("cover_image",e);const l=await f("auth/update_profile/",r);return t.value=l.data,{success:!0,data:l.data,message:"Foto de portada actualizada correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir la foto de portada",{success:!1,error:a.value}}finally{u.value=!1}}async function Z(e){var s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};if(!e.profilePicture&&!e.coverImage)return a.value="No se proporcionó ninguna imagen",{success:!1,error:a.value};if(e.profilePicture&&!(e.profilePicture instanceof File))return a.value="El archivo de foto de perfil no es válido",{success:!1,error:a.value};if(e.coverImage&&!(e.coverImage instanceof File))return a.value="El archivo de portada no es válido",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=new FormData;e.profilePicture&&r.append("profile_picture",e.profilePicture),e.coverImage&&r.append("cover_image",e.coverImage);const l=await f("auth/update_profile/",r);return t.value=l.data,{success:!0,data:l.data,message:"Imágenes actualizadas correctamente"}}catch(r){return a.value=((s=r.response)==null?void 0:s.data)||"Error al subir las imágenes",{success:!1,error:a.value}}finally{u.value=!1}}async function ee(){var e;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const s=await f("auth/profile/update/",{profile_picture:null});return t.value=s.data,{success:!0,data:s.data,message:"Foto de perfil eliminada correctamente"}}catch(s){return a.value=((e=s.response)==null?void 0:e.data)||"Error al eliminar la foto de perfil",{success:!1,error:a.value}}finally{u.value=!1}}async function ae(){var e;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const s=await f("auth/profile/update/",{cover_image:null});return t.value=s.data,{success:!0,data:s.data,message:"Foto de portada eliminada correctamente"}}catch(s){return a.value=((e=s.response)==null?void 0:e.data)||"Error al eliminar la foto de portada",{success:!1,error:a.value}}finally{u.value=!1}}function re(e,s=5*1024*1024){const r=[];return e?(["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(e.type)||r.push("Formato de imagen no válido. Usa JPG, PNG, GIF o WEBP"),e.size>s&&r.push(`El archivo excede el tamaño máximo de ${s/1024/1024}MB`),{valid:r.length===0,errors:r}):(r.push("No se ha seleccionado ningún archivo"),{valid:!1,errors:r})}function se(e){if(!e)return null;const s=e.includes("?")?"&":"?";return`${e}${s}t=${Date.now()}`}async function te(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await E("auth/crush/request-verification/",{});return t.value&&(t.value.crush_verification_status=r.data.crush_verification_status,t.value.crush_requested_at=r.data.crush_requested_at),{success:!0,data:r.data,message:r.data.message||"Solicitud de verificación enviada correctamente"}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al solicitar verificación de Crush",{success:!1,error:a.value}}finally{u.value=!1}}async function ue(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await E("auth/crush/cancel-request/",{});return t.value&&(t.value.crush_verification_status=r.data.crush_verification_status,t.value.crush_requested_at=null),{success:!0,data:r.data,message:r.data.message||"Solicitud de verificación cancelada correctamente"}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al cancelar solicitud de verificación",{success:!1,error:a.value}}finally{u.value=!1}}function le(e){return g.value.find(s=>s.id===e)||null}function oe(e){return F.value.find(s=>s.id===e)||null}function ne(e){return P.value.find(s=>s.id===e)||null}function ce(e){return P.value.filter(s=>s.platform===e)}function ie(){t.value=null,a.value=null}function de(){a.value=null}const d=h([]),v=h([]),I=h(!1);async function ve(e=!1){var s,r;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};I.value=!0,a.value=null;try{const c=await w(e?"favorites/products/?refresh=true":"favorites/products/");return d.value=c.data.data||[],{success:!0,data:d.value,meta:c.data.meta}}catch(l){return a.value=((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.error)||"Error al obtener productos favoritos",{success:!1,error:a.value}}finally{I.value=!1}}async function fe(){var e,s;if(!n())return{success:!1,error:"Usuario no autenticado"};try{const r=await w("favorites/products/ids/");return v.value=r.data.product_ids||[],{success:!0,data:v.value,count:r.data.count}}catch(r){return{success:!1,error:(s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error}}}async function pe(e){var s,r,l,c,_,m,p,b,q;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const i=await E("favorites/products/add/",{woocommerce_product_id:e});if(i.data.data){const we={id:i.data.data.id,woocommerce_product_id:i.data.data.woocommerce_product_id,product_name:(s=i.data.data.product_data)==null?void 0:s.name,product_price:(r=i.data.data.product_data)==null?void 0:r.price,product_image:(_=(c=(l=i.data.data.product_data)==null?void 0:l.images)==null?void 0:c[0])==null?void 0:_.src,product_slug:(m=i.data.data.product_data)==null?void 0:m.slug,is_in_stock:((p=i.data.data.product_data)==null?void 0:p.stock_status)==="instock",created_at:i.data.data.created_at};d.value.unshift(we),v.value.push(e)}return{success:!0,message:i.data.message,data:i.data.data}}catch(i){return a.value=((q=(b=i.response)==null?void 0:b.data)==null?void 0:q.error)||"Error al agregar producto a favoritos",{success:!1,error:a.value}}finally{u.value=!1}}async function _e(e){var s,r;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const l=await C(`favorites/products/${e}/`);return d.value=d.value.filter(c=>c.woocommerce_product_id!==e),v.value=v.value.filter(c=>c!==e),{success:!0,message:l.data.message}}catch(l){return a.value=((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.error)||"Error al eliminar producto de favoritos",{success:!1,error:a.value}}finally{u.value=!1}}async function me(e){if(!n())return{success:!1,is_favorited:!1};try{return{success:!0,is_favorited:(await w(`favorites/products/${e}/status/`)).data.is_favorited}}catch{return{success:!1,is_favorited:!1}}}function he(e){return v.value.includes(e)}async function ge(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await E("favorites/products/refresh/",{});return{success:!0,message:r.data.message,stats:r.data.stats,errors:r.data.errors}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al actualizar productos favoritos",{success:!1,error:a.value}}finally{u.value=!1}}async function ye(){var e,s;if(!n())return a.value="Usuario no autenticado",{success:!1,error:a.value};u.value=!0,a.value=null;try{const r=await C("favorites/products/clear/");return d.value=[],v.value=[],{success:!0,message:r.data.message}}catch(r){return a.value=((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.error)||"Error al limpiar favoritos",{success:!1,error:a.value}}finally{u.value=!1}}const Pe=o(()=>d.value.length>0),Fe=o(()=>d.value.length);return{profile:t,isLoading:u,error:a,favoriteProducts:d,favoriteProductIds:v,isLoadingFavorites:I,hasProfile:k,userInfo:$,addresses:g,defaultAddress:j,hasAddresses:z,galleryPhotos:F,profilePicture:A,profilePictureUrl:B,coverImageUrl:G,hasGalleryPhotos:R,links:P,sortedLinks:J,hasLinks:W,guestProfile:H,isGuestConverted:K,isCrush:U,crushVerificationStatus:y,crushRequestedAt:L,crushVerifiedAt:S,crushRejectionReason:V,isCrushVerified:M,canRequestCrushVerification:N,hasPendingCrushRequest:T,hasFavorites:Pe,totalFavorites:Fe,fetchProfile:O,updateProfile:Q,updateProfileComplete:x,uploadGalleryImages:D,uploadProfilePicture:X,uploadCoverImage:Y,uploadProfileImages:Z,removeProfilePicture:ee,removeCoverImage:ae,validateImageFile:re,getImageUrlWithCacheBusting:se,requestCrushVerification:te,cancelCrushRequest:ue,getAddressById:le,getPhotoById:oe,getLinkById:ne,getLinksByPlatform:ce,clearProfile:ie,clearError:de,fetchFavoriteProducts:ve,fetchFavoriteProductIds:fe,addProductToFavorites:pe,removeProductFromFavorites:_e,checkProductFavoriteStatus:me,isProductInFavorites:he,refreshAllFavoriteProducts:ge,clearAllFavorites:ye}});export{Ue as u};
