import{I as x,r as p,l as v,S as h,V as m,L as n,W as g,M as z,U as K}from"../index.js";import{S as i}from"./constants-DjCFsGER.js";const Y=x("auth",()=>{const u=p(null),t=p(!1),s=p(null),w=v(()=>!!u.value&&h()),S=v(()=>{var a;return((a=u.value)==null?void 0:a.full_name)||""}),E=v(()=>{var a;return((a=u.value)==null?void 0:a.email)||""}),_=v(()=>{var a;return((a=u.value)==null?void 0:a.id)||null}),I=v(()=>{var a;return((a=u.value)==null?void 0:a.username)||""});function y(){const a=localStorage.getItem(i.USER);if(a&&h())try{u.value=JSON.parse(a)}catch{m(),localStorage.removeItem(i.USER)}}async function k(a){var r,e,o,f,d;t.value=!0,s.value=null;try{const l=await n("auth/login/",a);if(l.data.access&&l.data.user)return g(l.data.access,l.data.refresh),u.value=l.data.user,localStorage.setItem(i.USER,JSON.stringify(l.data.user)),{success:!0,data:l.data};throw new Error("Invalid response format")}catch(l){return s.value=((o=(e=(r=l.response)==null?void 0:r.data)==null?void 0:e.non_field_errors)==null?void 0:o[0])||((d=(f=l.response)==null?void 0:f.data)==null?void 0:d.error)||"Login failed",{success:!1,error:s.value}}finally{t.value=!1}}async function U(a){var r;t.value=!0,s.value=null;try{const e=await n("auth/signup/",a);return{success:!0,data:e.data,requiresVerification:e.data.requires_verification}}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Registration failed",{success:!1,error:s.value}}finally{t.value=!1}}async function R(){try{await n("auth/logout/",{})}catch{}finally{u.value=null,m(),localStorage.removeItem(i.USER)}}async function N(a){var r,e,o,f,d,l;t.value=!0,s.value=null;try{const c=await n("auth/verify-email/",a);if(c.data.access&&c.data.user)return g(c.data.access,c.data.refresh),u.value=c.data.user,localStorage.setItem(i.USER,JSON.stringify(c.data.user)),{success:!0,data:c.data};throw new Error("Invalid response format")}catch(c){return s.value=((o=(e=(r=c.response)==null?void 0:r.data)==null?void 0:e.verification_code)==null?void 0:o[0])||((l=(d=(f=c.response)==null?void 0:f.data)==null?void 0:d.non_field_errors)==null?void 0:l[0])||"Email verification failed",{success:!1,error:s.value}}finally{t.value=!1}}async function P(a){var r,e;t.value=!0,s.value=null;try{return{success:!0,message:(await n("auth/resend-verification/",{email:a})).data.message}}catch(o){return s.value=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.error)||"Failed to resend verification code",{success:!1,error:s.value}}finally{t.value=!1}}async function O(){var a,r;if(!h())return{success:!1,error:"Not authenticated"};t.value=!0,s.value=null;try{const e=await z("auth/profile/");return u.value=e.data,localStorage.setItem(i.USER,JSON.stringify(e.data)),{success:!0,data:e.data}}catch(e){return s.value=((r=(a=e.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch profile",{success:!1,error:s.value}}finally{t.value=!1}}async function J(a){var r;t.value=!0,s.value=null;try{const e=await K("auth/update_profile/",a);if(e.data.user)return u.value=e.data.user,localStorage.setItem(i.USER,JSON.stringify(e.data.user)),{success:!0,data:e.data.user,message:e.data.message};throw new Error("Invalid response format")}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Profile update failed",{success:!1,error:s.value}}finally{t.value=!1}}async function q(a){var r;t.value=!0,s.value=null;try{return{success:!0,message:(await n("auth/update_password/",a)).data.message}}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Password change failed",{success:!1,error:s.value}}finally{t.value=!1}}async function G(a){var r,e;t.value=!0,s.value=null;try{return{success:!0,message:(await n("auth/forgot-password/",{email:a})).data.message}}catch(o){return s.value=((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.error)||"Failed to send reset code",{success:!1,error:s.value}}finally{t.value=!1}}async function L(a){var r;t.value=!0,s.value=null;try{return{success:!0,message:(await n("auth/reset-password/",a)).data.message}}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Password reset failed",{success:!1,error:s.value}}finally{t.value=!1}}async function A(a){var r;t.value=!0,s.value=null;try{return{success:!0,data:(await n("auth/guest_checkout/",a)).data}}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Guest checkout failed",{success:!1,error:s.value}}finally{t.value=!1}}async function F(a){var r;t.value=!0,s.value=null;try{return{success:!0,data:(await n("auth/check_username/",{username:a})).data}}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Username check failed",{success:!1,error:s.value}}finally{t.value=!1}}async function T(a){var r;t.value=!0,s.value=null;try{return{success:!0,data:(await n("auth/check_guest/",{email:a})).data}}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Guest check failed",{success:!1,error:s.value}}finally{t.value=!1}}async function V(a){var r;t.value=!0,s.value=null;try{const e=await n("auth/google_login/",{google_token:a});if(e.data.access&&e.data.user)return g(e.data.access,e.data.refresh),u.value=e.data.user,localStorage.setItem(i.USER,JSON.stringify(e.data.user)),{success:!0,data:e.data};throw new Error("Invalid response format")}catch(e){return s.value=((r=e.response)==null?void 0:r.data)||"Google login failed",{success:!1,error:s.value}}finally{t.value=!1}}function C(){s.value=null}return y(),{user:u,isLoading:t,error:s,isLoggedIn:w,userFullName:S,userEmail:E,userId:_,username:I,login:k,register:U,verifyEmail:N,resendVerificationCode:P,logout:R,fetchProfile:O,updateProfile:J,changePassword:q,forgotPassword:G,resetPassword:L,guestCheckout:A,checkUsername:F,checkGuest:T,googleLogin:V,clearError:C,initializeAuth:y}});export{Y as u};
