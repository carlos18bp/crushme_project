import{G as qe,H as Ve,I as Ae,J as Ie,K as B,j as ve,D as j,c as i,o as l,a,h as b,b as de,t as n,e as A,F as D,g as T,n as I,p as Ue,u as We,r as C,i as f,B as Ne,L as Be,d as N,v as Oe,x as ze,k as je}from"../index.js";import{u as He}from"./productStore-zfTZaC62.js";import{u as xe}from"./cartStore-VCuiRpOe.js";import{u as Qe}from"./authStore-tY-7-Xic.js";import{N as Ke,F as Ge}from"./Footer-CR-tWdeA.js";import{T as Je,F as Xe}from"./FAQ-DYyvX2Bs.js";import{_ as Ye}from"./ProductCard-CQu7feZr.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";import"./transition-iPTSRwE7.js";import"./profileStore-DZizYbaJ.js";import"./wishlistStore-2Sa37WF2.js";const ge=qe("review",{state:()=>({productReviews:[],currentProductId:null,totalReviews:0,reviewStats:{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},currentReview:null,myReviews:[],totalMyReviews:0,hasReviewedProduct:!1,userProductReview:null,isLoadingReviews:!1,isLoadingStats:!1,isLoadingReviewDetail:!1,isLoadingMyReviews:!1,isCreatingReview:!1,isUpdatingReview:!1,isDeletingReview:!1,isCheckingReview:!1,reviewsError:null,statsError:null,reviewDetailError:null,myReviewsError:null,createError:null,updateError:null,deleteError:null,checkError:null}),getters:{getProductReviews:t=>t.productReviews,getTotalReviews:t=>t.totalReviews,getReviewStats:t=>t.reviewStats,getAverageRating:t=>t.reviewStats.average_rating,getRatingDistribution:t=>t.reviewStats.rating_distribution,getCurrentReview:t=>t.currentReview,getMyReviews:t=>t.myReviews,hasUserReviewed:t=>t.hasReviewedProduct,getUserProductReview:t=>t.userProductReview,isLoading:t=>t.isLoadingReviews||t.isLoadingStats||t.isLoadingReviewDetail||t.isLoadingMyReviews||t.isCreatingReview||t.isUpdatingReview||t.isDeletingReview||t.isCheckingReview,hasError:t=>t.reviewsError||t.statsError||t.reviewDetailError||t.myReviewsError||t.createError||t.updateError||t.deleteError||t.checkError},actions:{async fetchProductReviews(t,g=!0){var d,c;this.isLoadingReviews=!0,this.reviewsError=null,this.currentProductId=t;try{console.log(`ðŸ” Fetching reviews for product ${t}...`);const u=`reviews/product/${t}/?active_only=${g}`,y=await B(u);if(y.data.success)return this.productReviews=y.data.reviews||[],this.totalReviews=y.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalReviews} reviews for product ${t}`),{success:!0,data:y.data};throw new Error("Failed to fetch reviews")}catch(u){return console.error("âŒ Error fetching product reviews:",u),this.reviewsError=((c=(d=u.response)==null?void 0:d.data)==null?void 0:c.error)||u.message||"Error al cargar reseÃ±as",this.productReviews=[],this.totalReviews=0,{success:!1,error:this.reviewsError}}finally{this.isLoadingReviews=!1}},async fetchReviewStats(t){var g,d;this.isLoadingStats=!0,this.statsError=null;try{console.log(`ðŸ“Š Fetching review stats for product ${t}...`);const c=`reviews/product/${t}/stats/`,u=await B(c);if(u.data.success)return this.reviewStats=u.data.stats||{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},console.log(`âœ… Loaded stats: ${this.reviewStats.average_rating} avg rating, ${this.reviewStats.total_reviews} reviews`),{success:!0,data:u.data};throw new Error("Failed to fetch review stats")}catch(c){return console.error("âŒ Error fetching review stats:",c),this.statsError=((d=(g=c.response)==null?void 0:g.data)==null?void 0:d.error)||c.message||"Error al cargar estadÃ­sticas",{success:!1,error:this.statsError}}finally{this.isLoadingStats=!1}},async fetchReviewDetail(t){var g,d;this.isLoadingReviewDetail=!0,this.reviewDetailError=null;try{console.log(`ðŸ” Fetching review detail ${t}...`);const c=`reviews/${t}/`,u=await B(c);if(u.data.success)return this.currentReview=u.data.review,console.log(`âœ… Loaded review detail for review ${t}`),{success:!0,data:u.data};throw new Error("Failed to fetch review detail")}catch(c){return console.error("âŒ Error fetching review detail:",c),this.reviewDetailError=((d=(g=c.response)==null?void 0:g.data)==null?void 0:d.error)||c.message||"Error al cargar detalle de reseÃ±a",this.currentReview=null,{success:!1,error:this.reviewDetailError}}finally{this.isLoadingReviewDetail=!1}},async checkUserReview(t){var g,d;this.isCheckingReview=!0,this.checkError=null;try{console.log(`ðŸ” Checking if user has reviewed product ${t}...`);const c=`reviews/product/${t}/check/`,u=await B(c);if(u.data.success)return this.hasReviewedProduct=u.data.has_reviewed,this.userProductReview=u.data.review,console.log(`âœ… User ${this.hasReviewedProduct?"has":"has not"} reviewed product ${t}`),{success:!0,has_reviewed:this.hasReviewedProduct,review:this.userProductReview};throw new Error("Failed to check user review")}catch(c){return console.error("âŒ Error checking user review:",c),this.checkError=((d=(g=c.response)==null?void 0:g.data)==null?void 0:d.error)||c.message||"Error al verificar reseÃ±a",this.hasReviewedProduct=!1,this.userProductReview=null,{success:!1,error:this.checkError}}finally{this.isCheckingReview=!1}},async fetchMyReviews(){var t,g;this.isLoadingMyReviews=!0,this.myReviewsError=null;try{console.log("ðŸ” Fetching user reviews...");const c=await B("reviews/user/my-reviews/");if(c.data.success)return this.myReviews=c.data.reviews||[],this.totalMyReviews=c.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalMyReviews} user reviews`),{success:!0,data:c.data};throw new Error("Failed to fetch user reviews")}catch(d){return console.error("âŒ Error fetching user reviews:",d),this.myReviewsError=((g=(t=d.response)==null?void 0:t.data)==null?void 0:g.error)||d.message||"Error al cargar tus reseÃ±as",this.myReviews=[],this.totalMyReviews=0,{success:!1,error:this.myReviewsError}}finally{this.isLoadingMyReviews=!1}},async createReview(t){var g,d,c,u,y,w;this.isCreatingReview=!0,this.createError=null;try{console.log("ðŸ“ Creating new review...",t);const p=await Ie("reviews/",t);if(p.data.success){const R=p.data.review;return R.woocommerce_product_id===this.currentProductId&&(this.productReviews.unshift(R),this.totalReviews++),R.is_user_review&&(this.myReviews.unshift(R),this.totalMyReviews++,this.hasReviewedProduct=!0,this.userProductReview=R),console.log("âœ… Review created successfully:",R.id),{success:!0,data:p.data,review:R}}else throw new Error(p.data.message||"Failed to create review")}catch(m){return console.error("âŒ Error creating review:",m),this.createError=((d=(g=m.response)==null?void 0:g.data)==null?void 0:d.errors)||((u=(c=m.response)==null?void 0:c.data)==null?void 0:u.error)||m.message||"Error al crear reseÃ±a",{success:!1,error:this.createError,errors:(w=(y=m.response)==null?void 0:y.data)==null?void 0:w.errors}}finally{this.isCreatingReview=!1}},async updateReview(t,g){var d,c,u,y,w,m,p,R;this.isUpdatingReview=!0,this.updateError=null;try{console.log(`ðŸ“ Updating review ${t}...`,g);const _=`reviews/${t}/update/`,k=await Ae(_,g);if(k.data.success){const E=k.data.review,M=this.productReviews.findIndex(S=>S.id===t);M!==-1&&(this.productReviews[M]=E);const q=this.myReviews.findIndex(S=>S.id===t);return q!==-1&&(this.myReviews[q]=E),((d=this.userProductReview)==null?void 0:d.id)===t&&(this.userProductReview=E),((c=this.currentReview)==null?void 0:c.id)===t&&(this.currentReview=E),console.log("âœ… Review updated successfully:",t),{success:!0,data:k.data,review:E}}else throw new Error(k.data.message||"Failed to update review")}catch(_){return console.error("âŒ Error updating review:",_),this.updateError=((y=(u=_.response)==null?void 0:u.data)==null?void 0:y.errors)||((m=(w=_.response)==null?void 0:w.data)==null?void 0:m.error)||_.message||"Error al actualizar reseÃ±a",{success:!1,error:this.updateError,errors:(R=(p=_.response)==null?void 0:p.data)==null?void 0:R.errors}}finally{this.isUpdatingReview=!1}},async deleteReview(t){var g,d,c,u;this.isDeletingReview=!0,this.deleteError=null;try{console.log(`ðŸ—‘ï¸ Deleting review ${t}...`);const y=`reviews/${t}/delete/`,w=await Ve(y);if(w.data.success){const m=w.data.woocommerce_product_id;return this.productReviews=this.productReviews.filter(p=>p.id!==t),this.totalReviews=Math.max(0,this.totalReviews-1),this.myReviews=this.myReviews.filter(p=>p.id!==t),this.totalMyReviews=Math.max(0,this.totalMyReviews-1),((g=this.userProductReview)==null?void 0:g.id)===t&&(this.userProductReview=null,this.hasReviewedProduct=!1),((d=this.currentReview)==null?void 0:d.id)===t&&(this.currentReview=null),console.log("âœ… Review deleted successfully:",t),{success:!0,data:w.data,productId:m}}else throw new Error(w.data.message||"Failed to delete review")}catch(y){return console.error("âŒ Error deleting review:",y),this.deleteError=((u=(c=y.response)==null?void 0:c.data)==null?void 0:u.error)||y.message||"Error al eliminar reseÃ±a",{success:!1,error:this.deleteError}}finally{this.isDeletingReview=!1}},clearErrors(){this.reviewsError=null,this.statsError=null,this.reviewDetailError=null,this.myReviewsError=null,this.createError=null,this.updateError=null,this.deleteError=null,this.checkError=null},clearProductReviews(){this.productReviews=[],this.totalReviews=0,this.currentProductId=null,this.reviewStats={total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},this.hasReviewedProduct=!1,this.userProductReview=null},clearCurrentReview(){this.currentReview=null},clearMyReviews(){this.myReviews=[],this.totalMyReviews=0},resetStore(){this.clearProductReviews(),this.clearCurrentReview(),this.clearMyReviews(),this.clearErrors()}}}),Ze={class:"product-reviews-section"},et={class:"reviews-container"},tt={class:"reviews-header"},st={class:"reviews-title"},rt={class:"reviews-count"},at={class:"reviews-actions"},ot={class:"latest-button"},it={class:"write-review-button"},lt={key:0,class:"loading-state"},nt={class:"loading-text"},ct={key:1,class:"error-state"},ut={class:"error-text"},dt={key:2,class:"empty-state"},vt={class:"empty-text"},ht={key:3,class:"reviews-grid"},gt={class:"review-header"},pt={class:"review-stars"},wt=["onClick"],_t={class:"review-author"},mt={class:"author-name"},ft={key:0,class:"verified-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},yt={key:0,class:"review-title"},Rt={class:"review-text"},kt={class:"review-date"},bt={key:4,class:"load-more-container"},$t={class:"load-more-button"},Et={__name:"ProductReviews",props:{productId:{type:[Number,String],required:!0}},setup(t){const g=t,d=ge(),c=async()=>{g.productId&&(console.log(`ðŸ”„ Loading reviews for product ${g.productId}...`),await Promise.all([d.fetchProductReviews(g.productId,!0),d.fetchReviewStats(g.productId)]))},u=w=>{if(!w)return"";const m=new Date(w),p={year:"numeric",month:"long",day:"numeric"};return m.toLocaleDateString("es-ES",p)},y=w=>{console.log("Review menu clicked:",w)};return ve(()=>{c()}),j(()=>g.productId,w=>{w&&c()}),(w,m)=>(l(),i("section",Ze,[a("div",et,[a("div",tt,[a("h2",st,[de(n(w.$t("productReviews.title"))+" ",1),a("span",rt,"("+n(A(d).getTotalReviews)+")",1)]),a("div",at,[a("button",ot,[de(n(w.$t("productReviews.latest"))+" ",1),m[0]||(m[0]=a("svg",{class:"dropdown-icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),a("button",it,n(w.$t("productReviews.writeReview")),1)])]),A(d).isLoadingReviews?(l(),i("div",lt,[m[1]||(m[1]=a("div",{class:"loading-spinner"},null,-1)),a("p",nt,n(w.$t("productReviews.loading")),1)])):A(d).reviewsError?(l(),i("div",ct,[a("p",ut,n(A(d).reviewsError),1),a("button",{onClick:c,class:"retry-button"},n(w.$t("productReviews.retry")),1)])):A(d).getTotalReviews===0?(l(),i("div",dt,[a("p",vt,n(w.$t("productReviews.noReviews")),1)])):(l(),i("div",ht,[(l(!0),i(D,null,T(A(d).getProductReviews,p=>(l(),i("div",{key:p.id,class:I(["review-card",{highlighted:p.is_user_review}])},[a("div",gt,[a("div",pt,[(l(),i(D,null,T(5,R=>a("span",{key:R,class:I(["star",{filled:R<=p.rating}])}," â˜… ",2)),64))]),p.is_user_review?(l(),i("button",{key:0,class:"review-menu-button",onClick:R=>y(p.id)},[...m[2]||(m[2]=[a("span",null,"â‹¯",-1)])],8,wt)):b("",!0)]),a("div",_t,[a("span",mt,n(p.reviewer_name),1),p.is_verified_purchase?(l(),i("svg",ft,[...m[3]||(m[3]=[a("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z","clip-rule":"evenodd"},null,-1)])])):b("",!0)]),p.title?(l(),i("h4",yt,n(p.title),1)):b("",!0),a("p",Rt,n(p.comment),1),a("p",kt,n(w.$t("productReviews.postedOn"))+" "+n(u(p.created_at)),1)],2))),128))])),A(d).getTotalReviews>0?(l(),i("div",bt,[a("button",$t,n(w.$t("productReviews.loadMore")),1)])):b("",!0)])]))}},Pt=he(Et,[["__scopeId","data-v-6c17376b"]]),Ct={class:"product-detail-container"},St={class:"main-content"},Dt={class:"product-detail-view"},Lt={key:0,class:"loading-container"},Ft={key:1,class:"error-container"},Tt={key:2,class:"product-content"},Mt={class:"product-layout"},qt={class:"product-gallery"},Vt={class:"thumbnail-selector"},At=["disabled"],It=["onClick"],Ut=["src","alt"],Wt=["disabled"],Nt={class:"main-image-container"},Bt=["src","alt"],Ot={class:"product-info"},zt={class:"product-title"},jt={key:0,class:"product-short-description"},Ht=["innerHTML"],xt={class:"product-reviews"},Qt={class:"stars"},Kt={key:0,class:"rating-text"},Gt={key:1,class:"rating-count"},Jt={key:2,class:"rating-count"},Xt={class:"product-price"},Yt={key:0,class:"sale-badge"},Zt={class:"current-price"},es={key:1,class:"regular-price"},ts={key:0,class:"sale-badge"},ss={class:"current-price"},rs={key:1,class:"regular-price"},as={key:1,class:"product-description"},os=["innerHTML"],is={key:2,class:"product-options-container"},ls={class:"attribute-selector"},ns=["onClick"],cs={class:"attribute-selector"},us=["onClick"],ds={class:"product-actions"},vs={class:"quantity-selector"},hs=["disabled"],gs=["disabled"],ps=["disabled"],ws=["disabled"],_s={key:0,class:"loading-text"},ms={key:1},fs={key:2},ys=["disabled"],Rs={key:4,class:"cart-error-message"},ks={class:"attribute-info"},bs={class:"info-value"},$s={key:3,class:"not-found-container"},Es={__name:"ProductDetailView",props:{id:{type:String,required:!0}},setup(t){const g=Ne(),d=je(),{t:c}=Ue(),u=He(),y=xe(),w=Qe(),m=We(),p=ge(),R=C(0),_=C({}),k=C(1),E=C(!1),M=C(!1),q=C(null),S=C(0),O=C(5),H=C(null),z=C(!1),P=C(null),x=C(!1),U=C(null),F=f(()=>g.params.id),r=f(()=>u.wooCurrentProduct),pe=f(()=>u.isLoadingWooProduct),Y=f(()=>u.wooError),Q=f(()=>{var e;return p.getAverageRating>0?parseFloat(p.getAverageRating):(e=r.value)!=null&&e.average_rating?parseFloat(r.value.average_rating):0}),K=f(()=>{var e;return p.getTotalReviews>0?p.getTotalReviews:(e=r.value)!=null&&e.rating_count?r.value.rating_count:0}),we=f(()=>!r.value||!r.value.images||r.value.images.length===0?[{src:"https://images.unsplash.com/photo-1583394838336-acd977736f90?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1519947486511-46149fa0a254?w=500&h=500&fit=crop&crop=center"}]:r.value.images),V=f(()=>ye.value),_e=f(()=>{var e,s;return((e=V.value[R.value])==null?void 0:e.src)||((s=V.value[0])==null?void 0:s.src)}),Z=f(()=>{var e;if(!((e=r.value)!=null&&e.short_description))return"";if(fe.value){let s=r.value.short_description;return s=s.replace(/<h[3-5][^>]*>.*?(?:Precio sugerido|precio sugerido).*?<\/h[3-5]>/gi,""),s=s.replace(/<(?:span|div)[^>]*>\s*\$[\d,.]+\s*<\/(?:span|div)>/gi,""),s.trim()}return r.value.short_description}),me=f(()=>{var o;if(!((o=r.value)!=null&&o.description))return!1;if(!r.value.short_description)return!0;const e=r.value.short_description.replace(/<[^>]*>/g,"").trim(),s=r.value.description.replace(/<[^>]*>/g,"").trim();return e!==s&&s.length>e.length}),fe=f(()=>r.value&&r.value.type==="simple"),$=f(()=>r.value&&r.value.type==="variable"),h=f(()=>u.wooCurrentVariation),ee=f(()=>{var e;return(e=r.value)!=null&&e.attributes?r.value.attributes.map(s=>({id:s.slug||s.name,name:s.name,slug:s.slug,options:s.options||[],variation:!0})).reverse():[]}),W=f(()=>{var e;return((e=r.value)==null?void 0:e.available_variations)||[]}),ye=f(()=>{var e;if($.value&&h.value){if(h.value.images&&h.value.images.length>0)return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes mÃºltiples de variaciÃ³n:",h.value.images.length),h.value.images;if(h.value.image){console.log("ðŸ–¼ï¸ [ProductDetail] Usando imagen Ãºnica de variaciÃ³n:",h.value.image);const s=typeof h.value.image=="string"?h.value.image:h.value.image.src;if(s)return[{src:s,thumbnail:s,alt:((e=r.value)==null?void 0:e.name)||"Product variation"}]}}return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes del producto base"),we.value}),te=f(()=>{if(!r.value)return"$0";let e=0,s=!1;return $.value&&h.value?(e=parseFloat(h.value.converted_price||h.value.price)||0,s=h.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] VariaciÃ³n - Precio: $${e}, En oferta: ${s}`)):(e=parseFloat(r.value.converted_price||r.value.price)||0,s=r.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] Producto - Precio: $${e}, En oferta: ${s}`)),`$${e.toLocaleString("es-CO")}`}),Re=f(()=>{var e;return r.value?$.value&&((e=h.value)!=null&&e.price)?parseFloat(h.value.converted_price||h.value.price)||0:parseFloat(r.value.converted_price||r.value.price)||0:0}),se=f(()=>{if($.value){if(h.value)return h.value.stock_status==="instock"&&(h.value.stock_quantity===null||h.value.stock_quantity>0);if(W.value.length>0){const e=ce();if(e)return e.in_stock&&e.stock_quantity>0}return!1}return P.value&&!$.value?P.value.available&&P.value.status==="instock":r.value?r.value.stock_status==="instock"&&r.value.in_stock:!1}),re=f(()=>{var e;return(e=r.value)!=null&&e.attributes?r.value.attributes.filter(s=>{const o=s.name.toLowerCase();return!o.includes("color")&&!o.includes("colour")&&!o.includes("cor")&&!o.includes("size")&&!o.includes("talla")&&!o.includes("tamaÃ±o")}):[]}),ae=f(()=>re.value.filter(e=>e.variation===!0)),ke=f(()=>re.value.filter(e=>e.variation===!1)),oe=async e=>{if(r.value){console.log(`ðŸ”„ Cargando detalle completo de variaciÃ³n ${e}`);try{const s=await u.fetchWooProductVariation(r.value.id,e);s.success&&s.data&&(console.log(`âœ… VariaciÃ³n ${e} cargada con detalle completo:`,{id:s.data.id,price:s.data.price,stock_quantity:s.data.stock_quantity,stock_status:s.data.stock_status,image:s.data.image,attributes:s.data.attributes}),R.value=0)}catch(s){console.error(`âŒ Error cargando variaciÃ³n ${e}:`,s)}}},ie=async()=>{if(!(!F.value||x.value)){if($.value){console.log("ðŸ“¦ Producto variable detectado - stock se maneja por variaciÃ³n"),P.value={status:"variable",requires_variation_selection:!0,available:!0};return}x.value=!0;try{console.log(`ðŸ“¦ Consultando stock en tiempo real para producto ${F.value}...`);const e=await B(`products/woocommerce/products/${F.value}/stock/`);e.data.success&&(P.value=e.data.stock,console.log("âœ… Stock actualizado:",{status:P.value.status,quantity:P.value.quantity,available:P.value.available,source:e.data.source}),r.value&&!$.value&&(r.value.stock_status=P.value.status,r.value.stock_quantity=P.value.quantity,r.value.in_stock=P.value.in_stock))}catch(e){console.error("âŒ Error consultando stock en tiempo real:",e),r.value&&(P.value={status:r.value.stock_status,quantity:r.value.stock_quantity,manage_stock:r.value.manage_stock,in_stock:r.value.in_stock,available:r.value.stock_status==="instock"})}finally{x.value=!1}}},be=()=>{U.value&&clearInterval(U.value),U.value=setInterval(()=>{ie()},3e4),console.log("â° Polling de stock iniciado (cada 30 segundos)")},le=()=>{U.value&&(clearInterval(U.value),U.value=null,console.log("â° Polling de stock detenido"))},$e=async()=>{if(!$.value||W.value.length===0)return;console.log("ðŸŽ¯ Preseleccionando primera variaciÃ³n...");const e=W.value[0];_.value={...e.attributes},console.log("ðŸ“‹ Atributos preseleccionados:",_.value),u.setWooCurrentVariation({id:e.id,price:e.price,stock_status:e.in_stock?"instock":"outofstock",stock_quantity:e.stock_quantity,attributes:e.attributes,image:e.image||null}),console.log(`âœ… Primera variaciÃ³n preseleccionada: ID ${e.id}, Precio: $${e.price}`),await oe(e.id)},G=async()=>{var e;if(F.value){console.log(`ðŸ›ï¸ Cargando producto ID: ${F.value}`);try{const s=await u.fetchWooProduct(F.value);s.success?(console.log("âœ… Producto cargado:",s.data.name),s.data.type==="variable"&&(console.log(`ðŸ“¦ Producto variable con ${s.data.variations_count} variaciones`),console.log("âœ… available_variations ya incluidas:",((e=s.data.available_variations)==null?void 0:e.length)||0),$e()),await ie(),be()):console.error("âŒ Error cargando producto:",s.error)}catch(s){console.error("âŒ Error inesperado:",s)}}},Ee=e=>{R.value=e},Pe=()=>{S.value>0&&(S.value--,ne())},Ce=()=>{S.value<V.value.length-O.value&&(S.value++,ne())},ne=()=>{if(H.value){const e=S.value*78;H.value.scrollTop=e}},ce=()=>{if(!$.value||W.value.length===0)return console.warn("âš ï¸ No hay producto variable o no hay variaciones disponibles"),null;console.log("ðŸ” Buscando variaciÃ³n con atributos seleccionados:",_.value),console.log("ðŸ“¦ Variaciones disponibles:",W.value);const e=W.value.find(s=>{console.log(`ðŸ”Ž Comparando con variaciÃ³n ${s.id}:`,s.attributes);const o=Object.keys(_.value).every(v=>{const L=_.value[v],X=s.attributes[v];return console.log(`  - Atributo "${v}": seleccionado="${L}", variaciÃ³n="${X}", match=${X===L}`),X===L});return console.log(`  â†’ VariaciÃ³n ${s.id} ${o?"âœ… COINCIDE":"âŒ NO coincide"}`),o});return e?console.log("âœ… VariaciÃ³n encontrada:",e.id):console.error("âŒ No se encontrÃ³ variaciÃ³n que coincida con:",_.value),e},ue=async(e,s)=>{if(_.value={..._.value,[e]:s},console.log(`ðŸŽ¯ Atributo seleccionado: ${e} = ${s}`),console.log("ðŸ“‹ Atributos seleccionados:",_.value),$.value){const o=ce();o?(console.log("âœ… VariaciÃ³n encontrada en available_variations:",o.id),console.log("ðŸ’° Precio de variaciÃ³n:",o.price),console.log("ðŸ–¼ï¸ Imagen de variaciÃ³n:",o.image),u.setWooCurrentVariation({id:o.id,price:o.price,stock_status:o.in_stock?"instock":"outofstock",stock_quantity:o.stock_quantity,attributes:o.attributes,image:o.image||null}),await oe(o.id)):(console.warn("âš ï¸ No se encontrÃ³ variaciÃ³n con esos atributos"),u.setWooCurrentVariation(null))}},J=e=>{const o=`productDetail.attributes.${e.toLowerCase()}`,v=c(o);return v===o?e:v},Se=()=>{k.value<99&&k.value++},De=()=>{k.value>1&&k.value--},Le=async()=>{var e,s,o;if(!(!r.value||E.value)){M.value=!1,q.value=null,E.value=!0;try{const v={name:r.value.name,price:Re.value,image:((s=(e=r.value.images)==null?void 0:e[0])==null?void 0:s.src)||null,stock_status:r.value.stock_status};$.value&&h.value&&(v.variation_id=h.value.id,(o=h.value.image)!=null&&o.src&&(v.image=h.value.image.src),console.log(`ðŸ“¦ Producto variable - VariaciÃ³n ID: ${h.value.id}`)),Object.keys(_.value).length>0&&(v.attributes=_.value),console.log("ðŸ›’ Agregando al carrito:",{productId:r.value.id,variationId:v.variation_id||null,quantity:k.value,options:v});const L=await y.addToCart(r.value.id,k.value,v);L.success?(M.value=!0,console.log("âœ… Producto agregado al carrito exitosamente"),setTimeout(()=>{M.value=!1},3e3),k.value=1):(q.value=L.error||"Error al agregar al carrito",console.error("âŒ Error al agregar al carrito:",L.error))}catch(v){q.value="Error inesperado al agregar al carrito",console.error("âŒ Error inesperado:",v)}finally{E.value=!1}}},Fe=()=>{if(!w.isLoggedIn){d.push({name:`Login-${m.locale}`});return}z.value=!0},Te=e=>{console.log(`Product ${r.value.id} added to wishlist ${e}`)},Me=()=>{z.value=!1,d.push({name:`ProfileWishlist-${m.locale}`})};return ve(()=>{G()}),Be(()=>{le()}),j(h,e=>{if(e&&e.attributes&&e.attributes.length>0){console.log("ðŸ”„ Inicializando atributos con variaciÃ³n:",e.id);const s={};e.attributes.forEach(o=>{s[o.name]=o.option,console.log(`âœ… Atributo "${o.name}" = "${o.option}"`)}),_.value=s}}),j(F,(e,s)=>{e&&e!==s&&(console.log(`ðŸ”„ Cambio de producto detectado: ${s} â†’ ${e}`),le(),P.value=null,_.value={},u.setWooCurrentVariation(null),G())}),j(r,(e,s)=>{if(e&&(s&&e.id!==s.id&&(console.log("ðŸ”„ Cambio de producto detectado, limpiando variaciones"),u.clearWooVariations(),_.value={}),S.value=0,R.value=0,!$.value)){const o={..._.value};ae.value.forEach(v=>{v.options&&v.options.length>0&&!o[v.name]&&(o[v.name]=v.options[0])}),_.value=o}},{immediate:!0}),(e,s)=>(l(),i("div",Ct,[N(Ke),a("main",St,[a("div",Dt,[pe.value?(l(),i("div",Lt,[s[2]||(s[2]=a("div",{class:"loading-spinner"},null,-1)),a("p",null,n(e.$t("productDetail.loading")),1)])):Y.value?(l(),i("div",Ft,[a("h2",null,n(e.$t("productDetail.error.title")),1),a("p",null,n(Y.value),1),a("button",{onClick:G,class:"retry-btn"},n(e.$t("productDetail.error.retry")),1)])):r.value?(l(),i("div",Tt,[a("div",Mt,[a("div",qt,[a("div",Vt,[V.value.length>O.value?(l(),i("button",{key:0,onClick:Pe,disabled:S.value===0,class:"thumbnail-nav-btn thumbnail-nav-up"}," â–² ",8,At)):b("",!0),a("div",{class:"thumbnail-list",ref_key:"thumbnailList",ref:H},[(l(!0),i(D,null,T(V.value,(o,v)=>(l(),i("div",{key:v,class:I(["thumbnail",{active:R.value===v}]),onClick:L=>Ee(v)},[a("img",{src:o.src,alt:`${r.value.name} - imagen ${v+1}`},null,8,Ut)],10,It))),128))],512),V.value.length>O.value?(l(),i("button",{key:1,onClick:Ce,disabled:S.value>=V.value.length-O.value,class:"thumbnail-nav-btn thumbnail-nav-down"}," â–¼ ",8,Wt)):b("",!0)]),a("div",Nt,[a("img",{src:_e.value,alt:r.value.name,class:"main-image"},null,8,Bt)])]),a("div",Ot,[a("h1",zt,n(r.value.name),1),Z.value?(l(),i("div",jt,[a("p",{innerHTML:Z.value},null,8,Ht)])):b("",!0),a("div",xt,[a("div",Qt,[(l(),i(D,null,T(5,o=>a("span",{key:o,class:I(["star",{filled:o<=Math.floor(Q.value)}])},"â˜…",2)),64)),Q.value>0?(l(),i("span",Kt,n(Q.value.toFixed(1))+"/5",1)):b("",!0),K.value>0?(l(),i("span",Gt,"("+n(K.value)+" "+n(K.value===1?e.$t("productReviews.review"):e.$t("productReviews.reviews"))+")",1)):(l(),i("span",Jt,"("+n(e.$t("productReviews.reviewCount.none"))+")",1))])]),a("div",Xt,[$.value&&h.value?(l(),i(D,{key:0},[h.value.on_sale?(l(),i("span",Yt,n(e.$t("productDetail.saleBadge")||"SALE"),1)):b("",!0),a("span",Zt,n(te.value),1),h.value.on_sale&&h.value.regular_price?(l(),i("span",es," $"+n(parseFloat(h.value.converted_regular_price||h.value.regular_price).toLocaleString("es-CO")),1)):b("",!0)],64)):(l(),i(D,{key:1},[r.value.on_sale?(l(),i("span",ts,n(e.$t("productDetail.saleBadge")||"SALE"),1)):b("",!0),a("span",ss,n(te.value),1),r.value.on_sale&&r.value.regular_price?(l(),i("span",rs," $"+n(parseFloat(r.value.converted_regular_price||r.value.regular_price).toLocaleString("es-CO")),1)):b("",!0)],64))]),me.value?(l(),i("div",as,[a("div",{innerHTML:r.value.description},null,8,os)])):b("",!0),$.value&&ee.value.length>0?(l(),i("div",is,[(l(!0),i(D,null,T(ee.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[a("h4",null,n(J(o.name)),1),a("div",ls,[(l(!0),i(D,null,T(o.options,v=>(l(),i("button",{key:v,class:I(["attribute-option",{active:_.value[o.name]===v}]),onClick:L=>ue(o.name,v)},n(v),11,ns))),128))])]))),128))])):b("",!0),$.value?b("",!0):(l(!0),i(D,{key:3},T(ae.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[a("h4",null,n(J(o.name)),1),a("div",cs,[(l(!0),i(D,null,T(o.options,v=>(l(),i("button",{key:v,class:I(["attribute-option",{active:_.value[o.name]===v}]),onClick:L=>ue(o.name,v)},n(v),11,us))),128))])]))),128)),a("div",ds,[a("div",vs,[a("button",{onClick:De,disabled:k.value<=1||E.value,class:"quantity-btn"},"-",8,hs),Oe(a("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>k.value=o),type:"number",min:"1",max:"99",class:"quantity-input",disabled:E.value},null,8,gs),[[ze,k.value,void 0,{number:!0}]]),a("button",{onClick:Se,disabled:k.value>=99||E.value,class:"quantity-btn"},"+",8,ps)]),a("button",{onClick:Le,disabled:!se.value||E.value,class:I(["add-to-cart-btn",{success:M.value}])},[E.value?(l(),i("span",_s,"â³")):M.value?(l(),i("span",ms,"âœ“ "+n(e.$t("productDetail.addedToCart")),1)):(l(),i("span",fs,n(e.$t("productDetail.addToCart")),1))],10,ws),a("button",{onClick:Fe,disabled:!se.value,class:"add-to-wishlist-btn"},n(e.$t("productDetail.addToWishlist")),9,ys)]),N(Ye,{show:z.value,"product-id":r.value.id,onClose:s[1]||(s[1]=o=>z.value=!1),onAdded:Te,onCreateWishlist:Me},null,8,["show","product-id"]),q.value?(l(),i("div",Rs,n(q.value),1)):b("",!0),(l(!0),i(D,null,T(ke.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[a("h4",null,n(J(o.name)),1),a("div",ks,[a("span",bs,n(o.options.join(", ")),1)])]))),128))])])])):(l(),i("div",$s,[a("h2",null,n(e.$t("productDetail.notFound.title")),1),a("p",null,n(e.$t("productDetail.notFound.message",{id:F.value})),1)]))]),N(Pt,{"product-id":F.value},null,8,["product-id"]),N(Je),N(Xe)]),N(Ge)]))}},Us=he(Es,[["__scopeId","data-v-0af8a81b"]]);export{Us as default};
