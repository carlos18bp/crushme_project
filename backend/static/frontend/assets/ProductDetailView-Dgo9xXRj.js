import{G as Ae,H as Ve,I as Ie,J as Ue,K as B,j as he,D as j,c as i,o as l,a as r,h as b,b as ve,t as n,e as M,F as D,g as q,n as U,p as We,u as Ne,L as xe,r as C,i as f,A as Be,M as Oe,d as x,v as ze,x as je,k as He}from"../index.js";import{u as Qe}from"./productStore-zfTZaC62.js";import{u as Ke}from"./cartStore-VCuiRpOe.js";import{u as Ge}from"./authStore-BFns-WxD.js";import{N as Je,F as Xe}from"./Footer-CC9jRpOz.js";import{T as Ye,F as Ze}from"./FAQ-B4YRPKoa.js";import{_ as et}from"./ProductCard-CFMokUJA.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";import"./transition-DPm33Fyn.js";import"./profileStore-CwBUtR00.js";import"./wishlistStore-BgqpnbBu.js";const ge=Ae("review",{state:()=>({productReviews:[],currentProductId:null,totalReviews:0,reviewStats:{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},currentReview:null,myReviews:[],totalMyReviews:0,hasReviewedProduct:!1,userProductReview:null,isLoadingReviews:!1,isLoadingStats:!1,isLoadingReviewDetail:!1,isLoadingMyReviews:!1,isCreatingReview:!1,isUpdatingReview:!1,isDeletingReview:!1,isCheckingReview:!1,reviewsError:null,statsError:null,reviewDetailError:null,myReviewsError:null,createError:null,updateError:null,deleteError:null,checkError:null}),getters:{getProductReviews:t=>t.productReviews,getTotalReviews:t=>t.totalReviews,getReviewStats:t=>t.reviewStats,getAverageRating:t=>t.reviewStats.average_rating,getRatingDistribution:t=>t.reviewStats.rating_distribution,getCurrentReview:t=>t.currentReview,getMyReviews:t=>t.myReviews,hasUserReviewed:t=>t.hasReviewedProduct,getUserProductReview:t=>t.userProductReview,isLoading:t=>t.isLoadingReviews||t.isLoadingStats||t.isLoadingReviewDetail||t.isLoadingMyReviews||t.isCreatingReview||t.isUpdatingReview||t.isDeletingReview||t.isCheckingReview,hasError:t=>t.reviewsError||t.statsError||t.reviewDetailError||t.myReviewsError||t.createError||t.updateError||t.deleteError||t.checkError},actions:{async fetchProductReviews(t,p=!0){var d,c;this.isLoadingReviews=!0,this.reviewsError=null,this.currentProductId=t;try{console.log(`ðŸ” Fetching reviews for product ${t}...`);const u=`reviews/product/${t}/?active_only=${p}`,y=await B(u);if(y.data.success)return this.productReviews=y.data.reviews||[],this.totalReviews=y.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalReviews} reviews for product ${t}`),{success:!0,data:y.data};throw new Error("Failed to fetch reviews")}catch(u){return console.error("âŒ Error fetching product reviews:",u),this.reviewsError=((c=(d=u.response)==null?void 0:d.data)==null?void 0:c.error)||u.message||"Error al cargar reseÃ±as",this.productReviews=[],this.totalReviews=0,{success:!1,error:this.reviewsError}}finally{this.isLoadingReviews=!1}},async fetchReviewStats(t){var p,d;this.isLoadingStats=!0,this.statsError=null;try{console.log(`ðŸ“Š Fetching review stats for product ${t}...`);const c=`reviews/product/${t}/stats/`,u=await B(c);if(u.data.success)return this.reviewStats=u.data.stats||{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},console.log(`âœ… Loaded stats: ${this.reviewStats.average_rating} avg rating, ${this.reviewStats.total_reviews} reviews`),{success:!0,data:u.data};throw new Error("Failed to fetch review stats")}catch(c){return console.error("âŒ Error fetching review stats:",c),this.statsError=((d=(p=c.response)==null?void 0:p.data)==null?void 0:d.error)||c.message||"Error al cargar estadÃ­sticas",{success:!1,error:this.statsError}}finally{this.isLoadingStats=!1}},async fetchReviewDetail(t){var p,d;this.isLoadingReviewDetail=!0,this.reviewDetailError=null;try{console.log(`ðŸ” Fetching review detail ${t}...`);const c=`reviews/${t}/`,u=await B(c);if(u.data.success)return this.currentReview=u.data.review,console.log(`âœ… Loaded review detail for review ${t}`),{success:!0,data:u.data};throw new Error("Failed to fetch review detail")}catch(c){return console.error("âŒ Error fetching review detail:",c),this.reviewDetailError=((d=(p=c.response)==null?void 0:p.data)==null?void 0:d.error)||c.message||"Error al cargar detalle de reseÃ±a",this.currentReview=null,{success:!1,error:this.reviewDetailError}}finally{this.isLoadingReviewDetail=!1}},async checkUserReview(t){var p,d;this.isCheckingReview=!0,this.checkError=null;try{console.log(`ðŸ” Checking if user has reviewed product ${t}...`);const c=`reviews/product/${t}/check/`,u=await B(c);if(u.data.success)return this.hasReviewedProduct=u.data.has_reviewed,this.userProductReview=u.data.review,console.log(`âœ… User ${this.hasReviewedProduct?"has":"has not"} reviewed product ${t}`),{success:!0,has_reviewed:this.hasReviewedProduct,review:this.userProductReview};throw new Error("Failed to check user review")}catch(c){return console.error("âŒ Error checking user review:",c),this.checkError=((d=(p=c.response)==null?void 0:p.data)==null?void 0:d.error)||c.message||"Error al verificar reseÃ±a",this.hasReviewedProduct=!1,this.userProductReview=null,{success:!1,error:this.checkError}}finally{this.isCheckingReview=!1}},async fetchMyReviews(){var t,p;this.isLoadingMyReviews=!0,this.myReviewsError=null;try{console.log("ðŸ” Fetching user reviews...");const c=await B("reviews/user/my-reviews/");if(c.data.success)return this.myReviews=c.data.reviews||[],this.totalMyReviews=c.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalMyReviews} user reviews`),{success:!0,data:c.data};throw new Error("Failed to fetch user reviews")}catch(d){return console.error("âŒ Error fetching user reviews:",d),this.myReviewsError=((p=(t=d.response)==null?void 0:t.data)==null?void 0:p.error)||d.message||"Error al cargar tus reseÃ±as",this.myReviews=[],this.totalMyReviews=0,{success:!1,error:this.myReviewsError}}finally{this.isLoadingMyReviews=!1}},async createReview(t){var p,d,c,u,y,w;this.isCreatingReview=!0,this.createError=null;try{console.log("ðŸ“ Creating new review...",t);const g=await Ue("reviews/",t);if(g.data.success){const R=g.data.review;return R.woocommerce_product_id===this.currentProductId&&(this.productReviews.unshift(R),this.totalReviews++),R.is_user_review&&(this.myReviews.unshift(R),this.totalMyReviews++,this.hasReviewedProduct=!0,this.userProductReview=R),console.log("âœ… Review created successfully:",R.id),{success:!0,data:g.data,review:R}}else throw new Error(g.data.message||"Failed to create review")}catch(_){return console.error("âŒ Error creating review:",_),this.createError=((d=(p=_.response)==null?void 0:p.data)==null?void 0:d.errors)||((u=(c=_.response)==null?void 0:c.data)==null?void 0:u.error)||_.message||"Error al crear reseÃ±a",{success:!1,error:this.createError,errors:(w=(y=_.response)==null?void 0:y.data)==null?void 0:w.errors}}finally{this.isCreatingReview=!1}},async updateReview(t,p){var d,c,u,y,w,_,g,R;this.isUpdatingReview=!0,this.updateError=null;try{console.log(`ðŸ“ Updating review ${t}...`,p);const E=`reviews/${t}/update/`,m=await Ie(E,p);if(m.data.success){const k=m.data.review,S=this.productReviews.findIndex(F=>F.id===t);S!==-1&&(this.productReviews[S]=k);const A=this.myReviews.findIndex(F=>F.id===t);return A!==-1&&(this.myReviews[A]=k),((d=this.userProductReview)==null?void 0:d.id)===t&&(this.userProductReview=k),((c=this.currentReview)==null?void 0:c.id)===t&&(this.currentReview=k),console.log("âœ… Review updated successfully:",t),{success:!0,data:m.data,review:k}}else throw new Error(m.data.message||"Failed to update review")}catch(E){return console.error("âŒ Error updating review:",E),this.updateError=((y=(u=E.response)==null?void 0:u.data)==null?void 0:y.errors)||((_=(w=E.response)==null?void 0:w.data)==null?void 0:_.error)||E.message||"Error al actualizar reseÃ±a",{success:!1,error:this.updateError,errors:(R=(g=E.response)==null?void 0:g.data)==null?void 0:R.errors}}finally{this.isUpdatingReview=!1}},async deleteReview(t){var p,d,c,u;this.isDeletingReview=!0,this.deleteError=null;try{console.log(`ðŸ—‘ï¸ Deleting review ${t}...`);const y=`reviews/${t}/delete/`,w=await Ve(y);if(w.data.success){const _=w.data.woocommerce_product_id;return this.productReviews=this.productReviews.filter(g=>g.id!==t),this.totalReviews=Math.max(0,this.totalReviews-1),this.myReviews=this.myReviews.filter(g=>g.id!==t),this.totalMyReviews=Math.max(0,this.totalMyReviews-1),((p=this.userProductReview)==null?void 0:p.id)===t&&(this.userProductReview=null,this.hasReviewedProduct=!1),((d=this.currentReview)==null?void 0:d.id)===t&&(this.currentReview=null),console.log("âœ… Review deleted successfully:",t),{success:!0,data:w.data,productId:_}}else throw new Error(w.data.message||"Failed to delete review")}catch(y){return console.error("âŒ Error deleting review:",y),this.deleteError=((u=(c=y.response)==null?void 0:c.data)==null?void 0:u.error)||y.message||"Error al eliminar reseÃ±a",{success:!1,error:this.deleteError}}finally{this.isDeletingReview=!1}},clearErrors(){this.reviewsError=null,this.statsError=null,this.reviewDetailError=null,this.myReviewsError=null,this.createError=null,this.updateError=null,this.deleteError=null,this.checkError=null},clearProductReviews(){this.productReviews=[],this.totalReviews=0,this.currentProductId=null,this.reviewStats={total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},this.hasReviewedProduct=!1,this.userProductReview=null},clearCurrentReview(){this.currentReview=null},clearMyReviews(){this.myReviews=[],this.totalMyReviews=0},resetStore(){this.clearProductReviews(),this.clearCurrentReview(),this.clearMyReviews(),this.clearErrors()}}}),tt={class:"product-reviews-section"},st={class:"reviews-container"},rt={class:"reviews-header"},at={class:"reviews-title"},ot={class:"reviews-count"},it={class:"reviews-actions"},lt={class:"latest-button"},nt={class:"write-review-button"},ct={key:0,class:"loading-state"},ut={class:"loading-text"},dt={key:1,class:"error-state"},vt={class:"error-text"},ht={key:2,class:"empty-state"},pt={class:"empty-text"},gt={key:3,class:"reviews-grid"},wt={class:"review-header"},_t={class:"review-stars"},mt=["onClick"],ft={class:"review-author"},yt={class:"author-name"},Rt={key:0,class:"verified-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},kt={key:0,class:"review-title"},bt={class:"review-text"},$t={class:"review-date"},Et={key:4,class:"load-more-container"},Pt={class:"load-more-button"},Ct={__name:"ProductReviews",props:{productId:{type:[Number,String],required:!0}},setup(t){const p=t,d=ge(),c=async()=>{p.productId&&(console.log(`ðŸ”„ Loading reviews for product ${p.productId}...`),await Promise.all([d.fetchProductReviews(p.productId,!0),d.fetchReviewStats(p.productId)]))},u=w=>{if(!w)return"";const _=new Date(w),g={year:"numeric",month:"long",day:"numeric"};return _.toLocaleDateString("es-ES",g)},y=w=>{console.log("Review menu clicked:",w)};return he(()=>{c()}),j(()=>p.productId,w=>{w&&c()}),(w,_)=>(l(),i("section",tt,[r("div",st,[r("div",rt,[r("h2",at,[ve(n(w.$t("productReviews.title"))+" ",1),r("span",ot,"("+n(M(d).getTotalReviews)+")",1)]),r("div",it,[r("button",lt,[ve(n(w.$t("productReviews.latest"))+" ",1),_[0]||(_[0]=r("svg",{class:"dropdown-icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),r("button",nt,n(w.$t("productReviews.writeReview")),1)])]),M(d).isLoadingReviews?(l(),i("div",ct,[_[1]||(_[1]=r("div",{class:"loading-spinner"},null,-1)),r("p",ut,n(w.$t("productReviews.loading")),1)])):M(d).reviewsError?(l(),i("div",dt,[r("p",vt,n(M(d).reviewsError),1),r("button",{onClick:c,class:"retry-button"},n(w.$t("productReviews.retry")),1)])):M(d).getTotalReviews===0?(l(),i("div",ht,[r("p",pt,n(w.$t("productReviews.noReviews")),1)])):(l(),i("div",gt,[(l(!0),i(D,null,q(M(d).getProductReviews,g=>(l(),i("div",{key:g.id,class:U(["review-card",{highlighted:g.is_user_review}])},[r("div",wt,[r("div",_t,[(l(),i(D,null,q(5,R=>r("span",{key:R,class:U(["star",{filled:R<=g.rating}])}," â˜… ",2)),64))]),g.is_user_review?(l(),i("button",{key:0,class:"review-menu-button",onClick:R=>y(g.id)},[..._[2]||(_[2]=[r("span",null,"â‹¯",-1)])],8,mt)):b("",!0)]),r("div",ft,[r("span",yt,n(g.reviewer_name),1),g.is_verified_purchase?(l(),i("svg",Rt,[..._[3]||(_[3]=[r("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z","clip-rule":"evenodd"},null,-1)])])):b("",!0)]),g.title?(l(),i("h4",kt,n(g.title),1)):b("",!0),r("p",bt,n(g.comment),1),r("p",$t,n(w.$t("productReviews.postedOn"))+" "+n(u(g.created_at)),1)],2))),128))])),M(d).getTotalReviews>0?(l(),i("div",Et,[r("button",Pt,n(w.$t("productReviews.loadMore")),1)])):b("",!0)])]))}},St=pe(Ct,[["__scopeId","data-v-6c17376b"]]),Dt={class:"product-detail-container"},Lt={class:"main-content"},Ft={class:"product-detail-view"},Tt={key:0,class:"loading-container"},Mt={key:1,class:"error-container"},qt={key:2,class:"product-content"},At={class:"product-layout"},Vt={class:"product-gallery"},It={class:"thumbnail-selector"},Ut=["disabled"],Wt=["onClick"],Nt=["src","alt"],xt=["disabled"],Bt={class:"main-image-container"},Ot=["src","alt"],zt={class:"product-info"},jt={class:"product-title"},Ht={key:0,class:"product-short-description"},Qt=["innerHTML"],Kt={class:"product-reviews"},Gt={class:"stars"},Jt={key:0,class:"rating-text"},Xt={key:1,class:"rating-count"},Yt={key:2,class:"rating-count"},Zt={class:"product-price"},es={key:0,class:"sale-badge"},ts={class:"flex items-baseline gap-2"},ss={class:"current-price"},rs={class:"text-sm text-gray-500 font-poppins"},as={key:1,class:"regular-price"},os={key:0,class:"sale-badge"},is={class:"flex items-baseline gap-2"},ls={class:"current-price"},ns={class:"text-sm text-gray-500 font-poppins"},cs={key:1,class:"regular-price"},us={key:1,class:"product-description"},ds=["innerHTML"],vs={key:2,class:"product-options-container"},hs={class:"attribute-selector"},ps=["onClick"],gs={class:"attribute-selector"},ws=["onClick"],_s={class:"product-actions"},ms={class:"quantity-selector"},fs=["disabled"],ys=["disabled"],Rs=["disabled"],ks=["disabled"],bs={key:0,class:"loading-text"},$s={key:1},Es={key:2},Ps=["disabled"],Cs={key:4,class:"cart-error-message"},Ss={class:"attribute-info"},Ds={class:"info-value"},Ls={key:3,class:"not-found-container"},Fs={__name:"ProductDetailView",props:{id:{type:String,required:!0}},setup(t){const p=Be(),d=He(),{t:c}=We(),u=Qe(),y=Ke(),w=Ge(),_=Ne(),g=ge(),R=xe(),E=C(0),m=C({}),k=C(1),S=C(!1),A=C(!1),F=C(null),V=C(0),O=C(5),H=C(null),z=C(!1),P=C(null),Q=C(!1),W=C(null),T=f(()=>p.params.id),a=f(()=>u.wooCurrentProduct),we=f(()=>u.isLoadingWooProduct),Z=f(()=>u.wooError),K=f(()=>{var e;return g.getAverageRating>0?parseFloat(g.getAverageRating):(e=a.value)!=null&&e.average_rating?parseFloat(a.value.average_rating):0}),G=f(()=>{var e;return g.getTotalReviews>0?g.getTotalReviews:(e=a.value)!=null&&e.rating_count?a.value.rating_count:0}),_e=f(()=>!a.value||!a.value.images||a.value.images.length===0?[{src:"https://images.unsplash.com/photo-1583394838336-acd977736f90?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1519947486511-46149fa0a254?w=500&h=500&fit=crop&crop=center"}]:a.value.images),I=f(()=>Re.value),me=f(()=>{var e,s;return((e=I.value[E.value])==null?void 0:e.src)||((s=I.value[0])==null?void 0:s.src)}),ee=f(()=>{var e;if(!((e=a.value)!=null&&e.short_description))return"";if(ye.value){let s=a.value.short_description;return s=s.replace(/<h[3-5][^>]*>.*?(?:Precio sugerido|precio sugerido).*?<\/h[3-5]>/gi,""),s=s.replace(/<(?:span|div)[^>]*>\s*\$[\d,.]+\s*<\/(?:span|div)>/gi,""),s.trim()}return a.value.short_description}),fe=f(()=>{var o;if(!((o=a.value)!=null&&o.description))return!1;if(!a.value.short_description)return!0;const e=a.value.short_description.replace(/<[^>]*>/g,"").trim(),s=a.value.description.replace(/<[^>]*>/g,"").trim();return e!==s&&s.length>e.length}),ye=f(()=>a.value&&a.value.type==="simple"),$=f(()=>a.value&&a.value.type==="variable"),h=f(()=>u.wooCurrentVariation),te=f(()=>{var e;return(e=a.value)!=null&&e.attributes?a.value.attributes.map(s=>({id:s.slug||s.name,name:s.name,slug:s.slug,options:s.options||[],variation:!0})).reverse():[]}),N=f(()=>{var e;return((e=a.value)==null?void 0:e.available_variations)||[]}),Re=f(()=>{var e;if($.value&&h.value){if(h.value.images&&h.value.images.length>0)return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes mÃºltiples de variaciÃ³n:",h.value.images.length),h.value.images;if(h.value.image){console.log("ðŸ–¼ï¸ [ProductDetail] Usando imagen Ãºnica de variaciÃ³n:",h.value.image);const s=typeof h.value.image=="string"?h.value.image:h.value.image.src;if(s)return[{src:s,thumbnail:s,alt:((e=a.value)==null?void 0:e.name)||"Product variation"}]}}return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes del producto base"),_e.value}),se=f(()=>{if(!a.value)return"$0";let e=0,s=!1;return $.value&&h.value?(e=parseFloat(h.value.converted_price||h.value.price)||0,s=h.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] VariaciÃ³n - Precio: $${e}, En oferta: ${s}`)):(e=parseFloat(a.value.converted_price||a.value.price)||0,s=a.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] Producto - Precio: $${e}, En oferta: ${s}`)),`$${e.toLocaleString("es-CO")}`}),ke=f(()=>{var e;return a.value?$.value&&((e=h.value)!=null&&e.price)?parseFloat(h.value.converted_price||h.value.price)||0:parseFloat(a.value.converted_price||a.value.price)||0:0}),re=f(()=>{if($.value){if(h.value)return h.value.stock_status==="instock"&&(h.value.stock_quantity===null||h.value.stock_quantity>0);if(N.value.length>0){const e=ue();if(e)return e.in_stock&&e.stock_quantity>0}return!1}return P.value&&!$.value?P.value.available&&P.value.status==="instock":a.value?a.value.stock_status==="instock"&&a.value.in_stock:!1}),ae=f(()=>{var e;return(e=a.value)!=null&&e.attributes?a.value.attributes.filter(s=>{const o=s.name.toLowerCase();return!o.includes("color")&&!o.includes("colour")&&!o.includes("cor")&&!o.includes("size")&&!o.includes("talla")&&!o.includes("tamaÃ±o")}):[]}),oe=f(()=>ae.value.filter(e=>e.variation===!0)),be=f(()=>ae.value.filter(e=>e.variation===!1)),ie=async e=>{if(a.value){console.log(`ðŸ”„ Cargando detalle completo de variaciÃ³n ${e}`);try{const s=await u.fetchWooProductVariation(a.value.id,e);s.success&&s.data&&(console.log(`âœ… VariaciÃ³n ${e} cargada con detalle completo:`,{id:s.data.id,price:s.data.price,stock_quantity:s.data.stock_quantity,stock_status:s.data.stock_status,image:s.data.image,attributes:s.data.attributes}),E.value=0)}catch(s){console.error(`âŒ Error cargando variaciÃ³n ${e}:`,s)}}},le=async()=>{if(!(!T.value||Q.value)){if($.value){console.log("ðŸ“¦ Producto variable detectado - stock se maneja por variaciÃ³n"),P.value={status:"variable",requires_variation_selection:!0,available:!0};return}Q.value=!0;try{console.log(`ðŸ“¦ Consultando stock en tiempo real para producto ${T.value}...`);const e=await B(`products/woocommerce/products/${T.value}/stock/`);e.data.success&&(P.value=e.data.stock,console.log("âœ… Stock actualizado:",{status:P.value.status,quantity:P.value.quantity,available:P.value.available,source:e.data.source}),a.value&&!$.value&&(a.value.stock_status=P.value.status,a.value.stock_quantity=P.value.quantity,a.value.in_stock=P.value.in_stock))}catch(e){console.error("âŒ Error consultando stock en tiempo real:",e),a.value&&(P.value={status:a.value.stock_status,quantity:a.value.stock_quantity,manage_stock:a.value.manage_stock,in_stock:a.value.in_stock,available:a.value.stock_status==="instock"})}finally{Q.value=!1}}},$e=()=>{W.value&&clearInterval(W.value),W.value=setInterval(()=>{le()},3e4),console.log("â° Polling de stock iniciado (cada 30 segundos)")},ne=()=>{W.value&&(clearInterval(W.value),W.value=null,console.log("â° Polling de stock detenido"))},Ee=async()=>{if(!$.value||N.value.length===0)return;console.log("ðŸŽ¯ Preseleccionando primera variaciÃ³n...");const e=N.value[0];m.value={...e.attributes},console.log("ðŸ“‹ Atributos preseleccionados:",m.value),u.setWooCurrentVariation({id:e.id,price:e.price,stock_status:e.in_stock?"instock":"outofstock",stock_quantity:e.stock_quantity,attributes:e.attributes,image:e.image||null}),console.log(`âœ… Primera variaciÃ³n preseleccionada: ID ${e.id}, Precio: $${e.price}`),await ie(e.id)},J=async()=>{var e;if(T.value){console.log(`ðŸ›ï¸ Cargando producto ID: ${T.value}`);try{const s=await u.fetchWooProduct(T.value);s.success?(console.log("âœ… Producto cargado:",s.data.name),s.data.type==="variable"&&(console.log(`ðŸ“¦ Producto variable con ${s.data.variations_count} variaciones`),console.log("âœ… available_variations ya incluidas:",((e=s.data.available_variations)==null?void 0:e.length)||0),Ee()),await le(),$e()):console.error("âŒ Error cargando producto:",s.error)}catch(s){console.error("âŒ Error inesperado:",s)}}},Pe=e=>{E.value=e},Ce=()=>{V.value>0&&(V.value--,ce())},Se=()=>{V.value<I.value.length-O.value&&(V.value++,ce())},ce=()=>{if(H.value){const e=V.value*78;H.value.scrollTop=e}},ue=()=>{if(!$.value||N.value.length===0)return console.warn("âš ï¸ No hay producto variable o no hay variaciones disponibles"),null;console.log("ðŸ” Buscando variaciÃ³n con atributos seleccionados:",m.value),console.log("ðŸ“¦ Variaciones disponibles:",N.value);const e=N.value.find(s=>{console.log(`ðŸ”Ž Comparando con variaciÃ³n ${s.id}:`,s.attributes);const o=Object.keys(m.value).every(v=>{const L=m.value[v],Y=s.attributes[v];return console.log(`  - Atributo "${v}": seleccionado="${L}", variaciÃ³n="${Y}", match=${Y===L}`),Y===L});return console.log(`  â†’ VariaciÃ³n ${s.id} ${o?"âœ… COINCIDE":"âŒ NO coincide"}`),o});return e?console.log("âœ… VariaciÃ³n encontrada:",e.id):console.error("âŒ No se encontrÃ³ variaciÃ³n que coincida con:",m.value),e},de=async(e,s)=>{if(m.value={...m.value,[e]:s},console.log(`ðŸŽ¯ Atributo seleccionado: ${e} = ${s}`),console.log("ðŸ“‹ Atributos seleccionados:",m.value),$.value){const o=ue();o?(console.log("âœ… VariaciÃ³n encontrada en available_variations:",o.id),console.log("ðŸ’° Precio de variaciÃ³n:",o.price),console.log("ðŸ–¼ï¸ Imagen de variaciÃ³n:",o.image),u.setWooCurrentVariation({id:o.id,price:o.price,stock_status:o.in_stock?"instock":"outofstock",stock_quantity:o.stock_quantity,attributes:o.attributes,image:o.image||null}),await ie(o.id)):(console.warn("âš ï¸ No se encontrÃ³ variaciÃ³n con esos atributos"),u.setWooCurrentVariation(null))}},X=e=>{const o=`productDetail.attributes.${e.toLowerCase()}`,v=c(o);return v===o?e:v},De=()=>{k.value<99&&k.value++},Le=()=>{k.value>1&&k.value--},Fe=async()=>{var e,s,o;if(!(!a.value||S.value)){A.value=!1,F.value=null,S.value=!0;try{const v={name:a.value.name,price:ke.value,image:((s=(e=a.value.images)==null?void 0:e[0])==null?void 0:s.src)||null,stock_status:a.value.stock_status};$.value&&h.value&&(v.variation_id=h.value.id,(o=h.value.image)!=null&&o.src&&(v.image=h.value.image.src),console.log(`ðŸ“¦ Producto variable - VariaciÃ³n ID: ${h.value.id}`)),Object.keys(m.value).length>0&&(v.attributes=m.value),console.log("ðŸ›’ Agregando al carrito:",{productId:a.value.id,variationId:v.variation_id||null,quantity:k.value,options:v});const L=await y.addToCart(a.value.id,k.value,v);L.success?(A.value=!0,console.log("âœ… Producto agregado al carrito exitosamente"),setTimeout(()=>{A.value=!1},3e3),k.value=1):(F.value=L.error||"Error al agregar al carrito",console.error("âŒ Error al agregar al carrito:",L.error))}catch(v){F.value="Error inesperado al agregar al carrito",console.error("âŒ Error inesperado:",v)}finally{S.value=!1}}},Te=()=>{if(!w.isLoggedIn){d.push({name:`Login-${_.locale}`});return}z.value=!0},Me=e=>{console.log(`Product ${a.value.id} added to wishlist ${e}`)},qe=()=>{z.value=!1,d.push({name:`ProfileWishlist-${_.locale}`})};return he(()=>{J()}),Oe(()=>{ne()}),j(h,e=>{if(e&&e.attributes&&e.attributes.length>0){console.log("ðŸ”„ Inicializando atributos con variaciÃ³n:",e.id);const s={};e.attributes.forEach(o=>{s[o.name]=o.option,console.log(`âœ… Atributo "${o.name}" = "${o.option}"`)}),m.value=s}}),j(T,(e,s)=>{e&&e!==s&&(console.log(`ðŸ”„ Cambio de producto detectado: ${s} â†’ ${e}`),ne(),P.value=null,m.value={},u.setWooCurrentVariation(null),J())}),j(a,(e,s)=>{if(e&&(s&&e.id!==s.id&&(console.log("ðŸ”„ Cambio de producto detectado, limpiando variaciones"),u.clearWooVariations(),m.value={}),V.value=0,E.value=0,!$.value)){const o={...m.value};oe.value.forEach(v=>{v.options&&v.options.length>0&&!o[v.name]&&(o[v.name]=v.options[0])}),m.value=o}},{immediate:!0}),(e,s)=>(l(),i("div",Dt,[x(Je),r("main",Lt,[r("div",Ft,[we.value?(l(),i("div",Tt,[s[2]||(s[2]=r("div",{class:"loading-spinner"},null,-1)),r("p",null,n(e.$t("productDetail.loading")),1)])):Z.value?(l(),i("div",Mt,[r("h2",null,n(e.$t("productDetail.error.title")),1),r("p",null,n(Z.value),1),r("button",{onClick:J,class:"retry-btn"},n(e.$t("productDetail.error.retry")),1)])):a.value?(l(),i("div",qt,[r("div",At,[r("div",Vt,[r("div",It,[I.value.length>O.value?(l(),i("button",{key:0,onClick:Ce,disabled:V.value===0,class:"thumbnail-nav-btn thumbnail-nav-up"}," â–² ",8,Ut)):b("",!0),r("div",{class:"thumbnail-list",ref_key:"thumbnailList",ref:H},[(l(!0),i(D,null,q(I.value,(o,v)=>(l(),i("div",{key:v,class:U(["thumbnail",{active:E.value===v}]),onClick:L=>Pe(v)},[r("img",{src:o.src,alt:`${a.value.name} - imagen ${v+1}`},null,8,Nt)],10,Wt))),128))],512),I.value.length>O.value?(l(),i("button",{key:1,onClick:Se,disabled:V.value>=I.value.length-O.value,class:"thumbnail-nav-btn thumbnail-nav-down"}," â–¼ ",8,xt)):b("",!0)]),r("div",Bt,[r("img",{src:me.value,alt:a.value.name,class:"main-image"},null,8,Ot)])]),r("div",zt,[r("h1",jt,n(a.value.name),1),ee.value?(l(),i("div",Ht,[r("p",{innerHTML:ee.value},null,8,Qt)])):b("",!0),r("div",Kt,[r("div",Gt,[(l(),i(D,null,q(5,o=>r("span",{key:o,class:U(["star",{filled:o<=Math.floor(K.value)}])},"â˜…",2)),64)),K.value>0?(l(),i("span",Jt,n(K.value.toFixed(1))+"/5",1)):b("",!0),G.value>0?(l(),i("span",Xt,"("+n(G.value)+" "+n(G.value===1?e.$t("productReviews.review"):e.$t("productReviews.reviews"))+")",1)):(l(),i("span",Yt,"("+n(e.$t("productReviews.reviewCount.none"))+")",1))])]),r("div",Zt,[$.value&&h.value?(l(),i(D,{key:0},[h.value.on_sale?(l(),i("span",es,n(e.$t("productDetail.saleBadge")||"SALE"),1)):b("",!0),r("div",ts,[r("span",ss,n(se.value),1),r("span",rs,n(M(R).currentCurrency),1)]),h.value.on_sale&&h.value.regular_price?(l(),i("span",as," $"+n(parseFloat(h.value.converted_regular_price||h.value.regular_price).toLocaleString("es-CO")),1)):b("",!0)],64)):(l(),i(D,{key:1},[a.value.on_sale?(l(),i("span",os,n(e.$t("productDetail.saleBadge")||"SALE"),1)):b("",!0),r("div",is,[r("span",ls,n(se.value),1),r("span",ns,n(M(R).currentCurrency),1)]),a.value.on_sale&&a.value.regular_price?(l(),i("span",cs," $"+n(parseFloat(a.value.converted_regular_price||a.value.regular_price).toLocaleString("es-CO")),1)):b("",!0)],64))]),fe.value?(l(),i("div",us,[r("div",{innerHTML:a.value.description},null,8,ds)])):b("",!0),$.value&&te.value.length>0?(l(),i("div",vs,[(l(!0),i(D,null,q(te.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(X(o.name)),1),r("div",hs,[(l(!0),i(D,null,q(o.options,v=>(l(),i("button",{key:v,class:U(["attribute-option",{active:m.value[o.name]===v}]),onClick:L=>de(o.name,v)},n(v),11,ps))),128))])]))),128))])):b("",!0),$.value?b("",!0):(l(!0),i(D,{key:3},q(oe.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(X(o.name)),1),r("div",gs,[(l(!0),i(D,null,q(o.options,v=>(l(),i("button",{key:v,class:U(["attribute-option",{active:m.value[o.name]===v}]),onClick:L=>de(o.name,v)},n(v),11,ws))),128))])]))),128)),r("div",_s,[r("div",ms,[r("button",{onClick:Le,disabled:k.value<=1||S.value,class:"quantity-btn"},"-",8,fs),ze(r("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>k.value=o),type:"number",min:"1",max:"99",class:"quantity-input",disabled:S.value},null,8,ys),[[je,k.value,void 0,{number:!0}]]),r("button",{onClick:De,disabled:k.value>=99||S.value,class:"quantity-btn"},"+",8,Rs)]),r("button",{onClick:Fe,disabled:!re.value||S.value,class:U(["add-to-cart-btn",{success:A.value}])},[S.value?(l(),i("span",bs,"â³")):A.value?(l(),i("span",$s,"âœ“ "+n(e.$t("productDetail.addedToCart")),1)):(l(),i("span",Es,n(e.$t("productDetail.addToCart")),1))],10,ks),r("button",{onClick:Te,disabled:!re.value,class:"add-to-wishlist-btn"},n(e.$t("productDetail.addToWishlist")),9,Ps)]),x(et,{show:z.value,"product-id":a.value.id,onClose:s[1]||(s[1]=o=>z.value=!1),onAdded:Me,onCreateWishlist:qe},null,8,["show","product-id"]),F.value?(l(),i("div",Cs,n(F.value),1)):b("",!0),(l(!0),i(D,null,q(be.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(X(o.name)),1),r("div",Ss,[r("span",Ds,n(o.options.join(", ")),1)])]))),128))])])])):(l(),i("div",Ls,[r("h2",null,n(e.$t("productDetail.notFound.title")),1),r("p",null,n(e.$t("productDetail.notFound.message",{id:T.value})),1)]))]),x(St,{"product-id":T.value},null,8,["product-id"]),x(Ye),x(Ze)]),x(Xe)]))}},zs=pe(Fs,[["__scopeId","data-v-ce6f857d"]]);export{zs as default};
