import{G as ye,r as f,i as D,K as _e,J as ae,M as Pe,u as we,D as oe,j as be,k as Ce,L as Ee,c as d,o as p,a,h as I,t as i,v as _,N as se,b as U,x as k,F as H,E as te,O as Ae,g as K,e as j}from"../index.js";import{u as Se}from"./cartStore-VCuiRpOe.js";import{u as Ie}from"./authStore-tY-7-Xic.js";import{u as Re}from"./crushStore-CDiYl-yT.js";import{u as Le}from"./productStore-zfTZaC62.js";import{u as Te}from"./useAlert-P81MXwWp.js";import{C as Ue,S as ke}from"./state-DRCieogr.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";const Ge=ye("payment",()=>{const V=f(null),G=f(null),O=f(null),R=f(!1),C=f(!1),u=f(null),$=D(()=>V.value!==null),P=D(()=>O.value==="COMPLETED"),Y=D(()=>{var E;return((E=V.value)==null?void 0:E.client_id)||null});async function q(){var E,v;R.value=!0,u.value=null;try{const r=await _e("orders/paypal/config/");return V.value={client_id:r.data.client_id,currency:r.data.currency,mode:r.data.mode},{success:!0,data:V.value}}catch(r){return u.value=((v=(E=r.response)==null?void 0:E.data)==null?void 0:v.error)||"Failed to fetch PayPal configuration",{success:!1,error:u.value}}finally{R.value=!1}}async function Q(E){var v,r,L,c;C.value=!0,u.value=null;try{const y=await ae("orders/paypal/create/",E),s={paypal_order_id:y.data.paypal_order_id,total:y.data.total,items_count:y.data.items_count};return G.value=s,{success:!0,data:s,paypal_order_id:s.paypal_order_id}}catch(y){return u.value=((r=(v=y.response)==null?void 0:v.data)==null?void 0:r.error)||"Failed to create PayPal order",{success:!1,error:u.value,details:(c=(L=y.response)==null?void 0:L.data)==null?void 0:c.details}}finally{C.value=!1}}async function W(E,v){var r,L,c,y,s,b;C.value=!0,u.value=null;try{const h=await ae("orders/paypal/capture/",v),A={order:h.data.order,payment:h.data.payment,woocommerce_integration:h.data.woocommerce_integration};return G.value=A.order,O.value=A.payment.status,{success:!0,data:A,order:A.order,payment:A.payment}}catch(h){return u.value=((L=(r=h.response)==null?void 0:r.data)==null?void 0:L.error)||"Failed to capture PayPal payment",{success:!1,error:u.value,details:(y=(c=h.response)==null?void 0:c.data)==null?void 0:y.details,paypal_status:(b=(s=h.response)==null?void 0:s.data)==null?void 0:b.paypal_status}}finally{C.value=!1}}async function w(E){var v,r,L,c,y,s;C.value=!0,u.value=null;try{console.log("üéÅ [GIFT] Enviando regalo:",E);const b=await ae("orders/gifts/send/",E);return console.log("‚úÖ [GIFT] Regalo enviado exitosamente:",b.data),{success:!0,data:b.data,paypal_order_id:b.data.paypal_order_id,receiver_info:b.data.receiver_info}}catch(b){return console.error("‚ùå [GIFT] Error enviando regalo:",b),{success:!1,error:((r=(v=b.response)==null?void 0:v.data)==null?void 0:r.error)||"Failed to send gift",details:(c=(L=b.response)==null?void 0:L.data)==null?void 0:c.missing_fields,user_info:(s=(y=b.response)==null?void 0:y.data)==null?void 0:s.user_info}}finally{C.value=!1}}function ee(){G.value=null,O.value=null,u.value=null}function B(){u.value=null}function J(){return{hasConfig:$.value,isLoading:R.value,isProcessing:C.value,currentOrder:G.value,paymentStatus:O.value,error:u.value}}return{paypalConfig:V,currentOrder:G,paymentStatus:O,isLoading:R,isProcessing:C,error:u,hasPayPalConfig:$,isPaymentComplete:P,paypalClientId:Y,fetchPayPalConfig:q,createPayPalOrder:Q,capturePayPalOrder:W,sendGift:w,clearPaymentState:ee,clearError:B,getPaymentState:J}}),$e={class:"checkout-view"},Oe={class:"checkout-container"},qe={class:"shipping-section"},Fe={class:"shipping-card"},Ne={class:"section-title"},xe={class:"shipping-type"},He={class:"radio-label"},Ve={class:"radio-label"},Me={class:"form-group"},Ye={for:"email"},Be=["placeholder"],ze={class:"form-group"},Ke={class:"form-group"},je={class:"form-group"},We={class:"form-group"},Je={class:"form-group"},Xe={key:0,class:"city-shipping-info"},Ze={class:"form-row"},Qe={class:"form-group"},ea=["value"],aa={class:"form-group"},oa={class:"form-group"},ta={class:"phone-input"},ra=["value"],sa={class:"form-group"},la={class:"form-group"},na={for:"username"},ia={class:"username-search-container"},ua=["placeholder"],ca={key:0,class:"username-search-results"},da=["onMousedown"],pa=["src","alt"],va={class:"search-user-info"},ma={class:"search-username"},ga={key:0,class:"search-crush-label"},fa={key:0,class:"gift-field-description"},ha={class:"highlight"},ya={class:"form-group"},_a={for:"note"},Pa=["placeholder"],wa={class:"form-group"},ba={class:"payment-title"},Ca={class:"payment-subtitle"},Ea={key:0,class:"payment-error"},Aa={class:"summary-section"},Sa={class:"summary-card"},Ia={class:"section-title"},Ra={key:0,class:"loading-state"},La={key:1,class:"products-list"},Ta={class:"product-image"},Ua=["src","alt"],ka={class:"product-details"},Da={class:"product-name"},Ga={key:0,class:"product-meta"},$a={key:1,class:"product-meta"},Oa={key:2,class:"product-meta"},qa={key:3,class:"product-meta variation-id"},Fa={class:"product-quantity"},Na={class:"product-price"},xa={class:"discount-section"},Ha={class:"discount-input"},Va={class:"totals-section"},Ma={class:"total-row"},Ya={class:"total-value"},Ba={class:"total-row"},za={class:"total-value"},Ka={key:0,class:"shipping-city-note"},ja={key:1,class:"shipping-city-note"},Wa={class:"total-row tax-row"},Ja={class:"total-value tax-included-value"},Xa={class:"final-total"},Za={class:"total-row"},Qa={class:"total-label"},eo={class:"total-amount"},ao={class:"tax-note"},le=48500,oo={__name:"CheckoutView",setup(V){const G=Ce(),O=Pe(),R=o=>O.formatPrice(o),C=o=>O.currentCurrency==="USD"?Math.round(o/4e3*100)/100:o,u=Se(),$=Ie(),P=Re(),Y=we(),q=Ge(),Q=Le(),{showSuccess:W,showError:w,showLoading:ee,closeAlert:B}=Te(),J=Ue.getAllCountries().map(o=>({...o,flag:o.flag||"üè≥Ô∏è"})),E=[{code:"CO",dial_code:"+57",flag:"üá®üá¥",name:"Colombia"}],v=f("me"),r=f({email:"",fullName:"",country:"CO",address1:"",address2:"",city:"",state:"",zipCode:"",phoneCode:"+57",phone:"",additionalDetails:"",username:"",note:""}),L=f(""),c=f(""),y=f(!1),s=f(null),b=f(!1),h=f(""),A=f(!1),T=f(null);let N=null;const M=f(null),X=f(null),ne=D(()=>ke.getStatesOfCountry("CO")),ie=D(()=>u.items),ue=D(()=>$.isLoggedIn&&$.username),ce=async o=>{if(!o||!o.trim()){P.clearSearch();return}try{await P.searchUsers(o.trim(),5)}catch(e){console.error("Error searching users:",e)}},re=o=>{console.log("üë§ [SELECT USER] Usuario seleccionado:",o),T.value=o,A.value=!1,P.clearSearch(),N&&(clearTimeout(N),N=null),r.value.username=`@${o.username}`,h.value=`@${o.username}`,console.log("üí∞ [SELECT USER] Costo de env√≠o del usuario:",o.shipping_cost)};oe(h,o=>{if(r.value.username=o,N&&clearTimeout(N),!o.trim()){P.clearSearch(),A.value=!1,T.value=null;return}if(T.value&&o===`@${T.value.username}`){console.log("‚è≠Ô∏è [WATCH] Usuario ya seleccionado, no buscar de nuevo");return}N=setTimeout(async()=>{await ce(o),A.value=P.searchResults.length>0},300)}),oe(v,o=>{o!=="gift"&&(h.value="",A.value=!1,T.value=null,P.clearSearch())}),oe(()=>r.value.username,o=>{v.value==="gift"&&o!==h.value&&(h.value=o)});const de=async()=>{b.value=!0;try{console.log(`üì¶ [DROPSHIPPING] Consultando producto ${le}...`);const o=await Q.fetchWooProduct(le);o.success&&o.data?(s.value=o.data,console.log("‚úÖ [DROPSHIPPING] Producto cargado:",{id:o.data.id,name:o.data.name,price:o.data.price})):console.error("‚ùå [DROPSHIPPING] Error al cargar producto:",o.error)}catch(o){console.error("‚ùå [DROPSHIPPING] Error inesperado:",o)}finally{b.value=!1}},x=D(()=>u.totalPrice),pe=async()=>{var g;if(console.log("üì¶ [REGULAR] Creando orden regular..."),!r.value.email||!r.value.fullName||!r.value.address1||!r.value.city||!r.value.state||!r.value.zipCode||!r.value.phone)throw c.value="Por favor completa todos los campos obligatorios antes de proceder al pago.",await w(`Por favor completa todos los campos obligatorios:

‚Ä¢ Email
‚Ä¢ Nombre completo
‚Ä¢ Direcci√≥n
‚Ä¢ Ciudad
‚Ä¢ Estado/Provincia
‚Ä¢ C√≥digo Postal
‚Ä¢ Tel√©fono`,"‚ö†Ô∏è Campos Incompletos"),new Error("Incomplete shipping information");const o=J.find(m=>m.isoCode===r.value.country),e=o?o.name:r.value.country,t=u.items.map(m=>({woocommerce_product_id:m.product_id||m.id,woocommerce_variation_id:m.variation_id||null,product_name:m.name,quantity:m.quantity,unit_price:parseFloat(m.price),attributes:m.attributes||null}));s.value&&(t.push({woocommerce_product_id:s.value.id,woocommerce_variation_id:null,product_name:s.value.name,quantity:1,unit_price:parseFloat(s.value.price),attributes:null}),console.log("üì¶ [DROPSHIPPING] Producto agregado a items:",{id:s.value.id,name:s.value.name,price:s.value.price})),console.log("üì¶ [REGULAR] Items del carrito:",t);const n={items:t,customer_email:r.value.email,customer_name:r.value.fullName,shipping_address:r.value.address1,shipping_city:r.value.city,shipping_state:r.value.state,shipping_postal_code:r.value.zipCode,shipping_country:e,phone_number:`${r.value.phoneCode} ${r.value.phone}`,notes:r.value.additionalDetails||"",shipping:F.value,total:S.value};console.log("üì§ [REGULAR] Enviando datos completos al backend:",n),console.log("üí∞ [REGULAR] Desglose:",{subtotal:x.value,shipping:F.value,dropshipping:((g=s.value)==null?void 0:g.price)||0,total:S.value});const l=await q.createPayPalOrder(n);if(!l.success)throw c.value=l.error||"Error al crear la orden.",new Error(l.error);return console.log("‚úÖ [REGULAR] Orden creada en backend:",l.paypal_order_id),console.log("‚ö†Ô∏è [REGULAR] Respuesta del backend:",l),l.data&&l.data.total&&(console.log("üí∞ [REGULAR] Total en PayPal seg√∫n backend:",l.data.total),l.data.total!==S.value&&console.error("‚ùå [REGULAR] DISCREPANCIA DE TOTAL!",{frontend:S.value,backend:l.data.total,diferencia:S.value-l.data.total})),l.paypal_order_id},ve=async()=>{var n;if(console.log("üéÅ [GIFT] Creando orden de regalo..."),!r.value.email)throw c.value="El email es obligatorio para enviar regalos.",await w("Por favor ingresa tu email para enviar el regalo.","üìß Email Requerido"),new Error("Email required for gift");if(!r.value.username)throw c.value="Selecciona un usuario destinatario para el regalo.",await w("Por favor selecciona el usuario que recibir√° el regalo.","üë§ Usuario Requerido"),new Error("Username required for gift");const o=u.items.map(l=>({woocommerce_product_id:l.product_id||l.id,woocommerce_variation_id:l.variation_id||null,product_name:l.name,quantity:l.quantity,unit_price:parseFloat(l.price),attributes:l.attributes||null}));s.value&&(o.push({woocommerce_product_id:s.value.id,woocommerce_variation_id:null,product_name:s.value.name,quantity:1,unit_price:parseFloat(s.value.price),attributes:null}),console.log("üì¶ [DROPSHIPPING] Producto agregado a items de regalo:",{id:s.value.id,name:s.value.name,price:s.value.price})),console.log("üéÅ [GIFT] Items del regalo:",o);const e={customer_email:r.value.email,sender_username:$.isLoggedIn?$.username:null,receiver_username:r.value.username.replace("@",""),items:o,gift_message:r.value.note||"",shipping:F.value,total:S.value,is_from_wishlist:M.value!==null,wishlist_id:M.value,wishlist_name:X.value};console.log("üéÅ [GIFT] Datos del regalo:",e),console.log("üí∞ [GIFT] Desglose:",{subtotal:x.value,shipping:F.value,dropshipping:((n=s.value)==null?void 0:n.price)||0,total:S.value});const t=await q.sendGift(e);if(!t.success)throw c.value=t.error||"Error al enviar el regalo.",t.error.includes("not found")?await w("El usuario destinatario no fue encontrado. Verifica el nombre de usuario.","‚ùå Usuario No Encontrado"):t.error.includes("shipping information")?await w("El usuario destinatario no tiene informaci√≥n completa de env√≠o registrada.","‚ùå Informaci√≥n de Env√≠o Incompleta"):await w(t.error||"Hubo un problema al enviar el regalo.","‚ùå Error al Enviar Regalo"),new Error(t.error);return console.log("‚úÖ [GIFT] Regalo enviado exitosamente:",t.paypal_order_id),t.paypal_order_id},me=async o=>{console.log("üéÅ [GIFT] Capturando pago de regalo...");const e=u.items.map(l=>({woocommerce_product_id:l.product_id||l.id,woocommerce_variation_id:l.variation_id||null,product_name:l.name,quantity:l.quantity,unit_price:parseFloat(l.price),attributes:l.attributes||null}));s.value&&(e.push({woocommerce_product_id:s.value.id,woocommerce_variation_id:null,product_name:s.value.name,quantity:1,unit_price:parseFloat(s.value.price),attributes:null}),console.log("üì¶ [DROPSHIPPING] Producto agregado a captura de regalo:",{id:s.value.id,name:s.value.name,price:s.value.price})),console.log("üéÅ [GIFT] Items del regalo para captura:",e);const t={paypal_order_id:o,customer_email:r.value.email,sender_username:$.isLoggedIn?$.username:null,receiver_username:r.value.username.replace("@",""),items:e,gift_message:r.value.note||"",shipping:F.value,total:S.value,is_from_wishlist:M.value!==null,wishlist_id:M.value,wishlist_name:X.value};console.log("üéÅ [GIFT] Datos de captura de regalo:",t),console.log("üí∞ [GIFT] Total a cobrar:",S.value);const n=await q.capturePayPalOrder(o,t);if(B(),!n.success)throw c.value=n.error||"Error al procesar el pago del regalo.",await w(n.error||"Hubo un problema al procesar el pago del regalo.","‚ùå Error en el Pago del Regalo"),new Error(n.error);console.log("‚úÖ [GIFT] Pago de regalo procesado exitosamente"),console.log("üì¶ [GIFT] Orden creada:",n.order),await W(`¬°Tu regalo ha sido enviado exitosamente!

üéÅ Destinatario: ${n.order.customer_name||"Usuario"}
üì¶ Productos: ${n.order.items_count} art√≠culo(s)
üí∞ Total: $${n.order.total}
üìã Orden: ${n.order.order_number}

El destinatario recibir√° una notificaci√≥n y sus productos ser√°n enviados a su direcci√≥n registrada.`,"üéâ ¬°Regalo Enviado!",{timer:8e3}),console.log("üßπ [GIFT] Limpiando carrito y estado..."),u.clearCart(),q.clearPaymentState(),console.log("üîÑ [GIFT] Redirigiendo al home..."),setTimeout(()=>{G.push({name:`Home-${Y.locale}`})},1e3)},ge=async o=>{console.log("üì¶ [REGULAR] Capturando pago regular...");const e=J.find(m=>m.isoCode===r.value.country),t=e?e.name:r.value.country,n=u.items.map(m=>({woocommerce_product_id:m.product_id||m.id,woocommerce_variation_id:m.variation_id||null,product_name:m.name,quantity:m.quantity,unit_price:parseFloat(m.price),attributes:m.attributes||null}));s.value&&(n.push({woocommerce_product_id:s.value.id,woocommerce_variation_id:null,product_name:s.value.name,quantity:1,unit_price:parseFloat(s.value.price),attributes:null}),console.log("üì¶ [DROPSHIPPING] Producto agregado a captura regular:",{id:s.value.id,name:s.value.name,price:s.value.price}));const l={paypal_order_id:o,items:n,customer_email:r.value.email,customer_name:r.value.fullName,shipping_address:r.value.address1,shipping_city:r.value.city,shipping_state:r.value.state,shipping_postal_code:r.value.zipCode,shipping_country:t,phone_number:`${r.value.phoneCode} ${r.value.phone}`,notes:r.value.additionalDetails||"",shipping:F.value,total:S.value};console.log("üì¶ [REGULAR] Datos de captura:",l),console.log("üí∞ [REGULAR] Total a cobrar:",S.value);const g=await q.capturePayPalOrder(o,l);if(B(),!g.success)throw c.value=g.error||"Error al procesar el pago.",await w(g.error||"Hubo un problema al procesar tu pago. Por favor contacta a soporte.","‚ùå Error en el Pago"),new Error(g.error);console.log("‚úÖ [REGULAR] Pago procesado exitosamente"),console.log("üì¶ [REGULAR] Orden creada:",g.order),await W(`Tu orden ha sido creada exitosamente.

üìã Orden: ${g.order.order_number}
üí∞ Total: $${g.order.total}
üì¶ Estado: ${g.order.status_display}

Recibir√°s un email de confirmaci√≥n pronto.`,"üéâ ¬°Pago Exitoso!",{timer:8e3}),console.log("üßπ [REGULAR] Limpiando carrito y estado..."),u.clearCart(),q.clearPaymentState(),console.log("üîÑ [REGULAR] Redirigiendo al home..."),setTimeout(()=>{G.push({name:`Home-${Y.locale}`})},1e3)},F=D(()=>{if(v.value==="gift"&&T.value&&T.value.shipping_cost){const e=parseFloat(T.value.shipping_cost),t=C(e);return console.log(`üì¶ [SHIPPING] Costo del usuario destinatario: ${e} COP ‚Üí ${t} ${O.currentCurrency}`),t}const o=(r.value.city||"").toLowerCase().trim();if(!o)return C(15e3);switch(o){case"medell√≠n":case"medellin":return C(10500);case"san andr√©s isla":case"san andres isla":case"san andr√©s":case"san andres":case"santa catalina":case"providencia":return C(45e3);default:return C(15e3)}}),z=D(()=>{let o=F.value;if(s.value&&s.value.price){const e=parseFloat(s.value.price);o+=e,console.log(`üì¶ [DROPSHIPPING] Shipping mostrado: ${F.value} + ${e} = ${o}`)}return o}),Z=D(()=>x.value*(.19/1.19)),S=D(()=>{const o=x.value+z.value;return console.log("üí∞ [TOTAL] C√°lculo:",{subtotal:x.value,shipping:z.value,tax_included:Z.value,total:o}),o}),fe=async()=>new Promise(async(o,e)=>{if(window.paypal){console.log("üí≥ [PAYPAL] SDK ya est√° cargado"),y.value=!0,o();return}const t=document.querySelector('script[src*="paypal.com/sdk/js"]');if(t){t.addEventListener("load",()=>{console.log("üí≥ [PAYPAL] SDK cargado desde script existente"),y.value=!0,o()});return}console.log("üí≥ [PAYPAL] Obteniendo configuraci√≥n de PayPal...");const n=await q.fetchPayPalConfig();if(!n.success){console.error("‚ùå [PAYPAL] Error al obtener configuraci√≥n"),c.value="Error al obtener configuraci√≥n de PayPal. Por favor recarga la p√°gina.",e(new Error(n.error));return}const l=n.data;console.log("üí≥ [PAYPAL] Cargando SDK con configuraci√≥n del backend...");const g=document.createElement("script");g.src=`https://www.paypal.com/sdk/js?client-id=${l.client_id}&buyer-country=US&currency=${l.currency}&components=buttons&enable-funding=venmo,paylater,card`,g.setAttribute("data-sdk-integration-source","developer-studio"),g.onload=()=>{console.log("‚úÖ [PAYPAL] SDK cargado exitosamente"),console.log("üí≥ [PAYPAL] Configuraci√≥n:",{currency:l.currency,mode:l.mode}),y.value=!0,o()},g.onerror=m=>{console.error("‚ùå [PAYPAL] Error al cargar SDK:",m),c.value="Error al cargar PayPal. Por favor recarga la p√°gina.",e(m)},document.head.appendChild(g)}),he=()=>{if(!window.paypal){console.error("‚ùå [PAYPAL] SDK no est√° disponible"),c.value="PayPal no est√° disponible. Por favor recarga la p√°gina.";return}const o=document.getElementById("paypal-button-container");if(!o){console.error("‚ùå [PAYPAL] Contenedor no encontrado");return}o.innerHTML="",console.log("üí≥ [PAYPAL] Renderizando botones...");try{window.paypal.Buttons({style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal"},createOrder:async(e,t)=>{console.log("üí≥ [PAYPAL] Creando orden..."),console.log("üì¶ [PAYPAL] Items del carrito:",u.items),console.log("üí∞ [PAYPAL] Desglose de totales:",{subtotal:x.value,baseShipping:F.value,shippingMostrado:z.value,taxIncluido:Z.value,total:S.value});try{if(!u.items||u.items.length===0)throw c.value="El carrito est√° vac√≠o. Agrega productos antes de proceder al pago.",await w("Tu carrito est√° vac√≠o. Por favor agrega productos antes de proceder al pago.","üõí Carrito Vac√≠o"),new Error("Cart is empty");return v.value==="gift"?await ve():await pe()}catch(n){throw console.error("‚ùå [PAYPAL] Error al crear orden:",n),n}},onApprove:async(e,t)=>{console.log("‚úÖ [PAYPAL] Pago aprobado por el usuario"),console.log("üìã [PAYPAL] Order ID:",e.orderID);try{ee("Procesando tu pago...","üí≥ Procesando Pago"),v.value==="gift"?await me(e.orderID):await ge(e.orderID)}catch(n){console.error("‚ùå [PAYPAL] Error al capturar pago:",n),B(),c.value||(c.value="Error al procesar el pago. Por favor contacta a soporte.",await w("Hubo un problema inesperado al procesar tu pago. Por favor intenta de nuevo o contacta a soporte.","‚ùå Error en el Pago"))}},onCancel:e=>{console.log("‚ö†Ô∏è [PAYPAL] Pago cancelado por el usuario"),c.value="Pago cancelado. Puedes intentar de nuevo cuando quieras.",w("Has cancelado el proceso de pago. Puedes intentar de nuevo cuando quieras.","‚ö†Ô∏è Pago Cancelado",{confirmButtonText:"Entendido",timer:5e3})},onError:e=>{console.error("‚ùå [PAYPAL] Error en el proceso:",e),c.value="Ocurri√≥ un error con PayPal. Por favor intenta de nuevo.",w("Hubo un problema con PayPal. Por favor verifica tu conexi√≥n e intenta de nuevo.","‚ùå Error de PayPal")}}).render("#paypal-button-container"),console.log("‚úÖ [PAYPAL] Botones renderizados exitosamente")}catch(e){console.error("‚ùå [PAYPAL] Error al renderizar botones:",e),c.value="Error al cargar los botones de PayPal."}};return be(async()=>{if(u.loadCart(),u.isEmpty){G.push({name:`Cart-${Y.locale}`});return}const o=G.currentRoute.value;if(o.query.giftMode==="true"){if(v.value="gift",o.query.username){const e=o.query.username,t=e.startsWith("@")?e:`@${e}`;r.value.username=t,h.value=t;try{const n=e.replace("@","").trim();if(console.log("üîç [CHECKOUT] Buscando usuario autom√°ticamente:",n),await P.searchUsers(n,5),P.searchResults.length>0){const l=P.searchResults.find(g=>g.username.toLowerCase()===n.toLowerCase());l?(console.log("‚úÖ [CHECKOUT] Usuario encontrado autom√°ticamente:",l),re(l)):console.warn("‚ö†Ô∏è [CHECKOUT] No se encontr√≥ coincidencia exacta para:",n)}else console.warn("‚ö†Ô∏è [CHECKOUT] No se encontraron resultados para:",n)}catch(n){console.error("‚ùå [CHECKOUT] Error al buscar usuario autom√°ticamente:",n)}}o.query.wishlistId&&(M.value=parseInt(o.query.wishlistId),X.value=o.query.wishlistName||null,console.log("üéÅ [WISHLIST] Compra desde wishlist:",{id:M.value,name:X.value}))}await de();try{await fe(),setTimeout(()=>{he()},100)}catch(e){console.error("‚ùå [PAYPAL] Error al inicializar PayPal:",e),await w("No se pudo cargar el sistema de pagos de PayPal. Por favor recarga la p√°gina e intenta de nuevo.","‚ùå Error al Cargar PayPal")}}),Ee(()=>{const o=document.getElementById("paypal-button-container");o&&(o.innerHTML=""),N&&clearTimeout(N),T.value=null,P.clearSearch()}),(o,e)=>(p(),d("div",$e,[a("div",Oe,[a("div",qe,[a("div",Fe,[a("h2",Ne,i(o.$t("cart.checkout.shippingInformation")),1),a("div",xe,[a("label",He,[_(a("input",{type:"radio",name:"shipping-type",value:"me","onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),checked:""},null,512),[[se,v.value]]),a("span",null,i(o.$t("cart.checkout.shippingType.forMe")),1)]),a("label",Ve,[_(a("input",{type:"radio",name:"shipping-type",value:"gift","onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t)},null,512),[[se,v.value]]),a("span",null,i(o.$t("cart.checkout.shippingType.forGift")),1)])]),a("div",Me,[a("label",Ye,[U(i(o.$t("cart.checkout.form.email"))+" ",1),e[18]||(e[18]=a("span",{class:"text-red-500"},"*",-1))]),_(a("input",{type:"email",id:"email","onUpdate:modelValue":e[2]||(e[2]=t=>r.value.email=t),placeholder:o.$t("cart.checkout.form.placeholders.email"),class:"form-input",required:""},null,8,Be),[[k,r.value.email]])]),v.value==="me"?(p(),d(H,{key:0},[a("div",ze,[e[19]||(e[19]=a("label",{for:"fullname"},[U("Full name "),a("span",{class:"text-red-500"},"*")],-1)),_(a("input",{type:"text",id:"fullname","onUpdate:modelValue":e[3]||(e[3]=t=>r.value.fullName=t),placeholder:"John Doe",class:"form-input",required:""},null,512),[[k,r.value.fullName]])]),a("div",Ke,[e[21]||(e[21]=a("label",{for:"country"},"Country",-1)),_(a("select",{id:"country","onUpdate:modelValue":e[4]||(e[4]=t=>r.value.country=t),class:"form-input form-select",disabled:""},[...e[20]||(e[20]=[a("option",{value:"CO"},"üá®üá¥ Colombia",-1)])],512),[[te,r.value.country]])]),a("div",je,[e[22]||(e[22]=a("label",{for:"address1"},[U("Address line 1 "),a("span",{class:"text-red-500"},"*")],-1)),_(a("input",{type:"text",id:"address1","onUpdate:modelValue":e[5]||(e[5]=t=>r.value.address1=t),placeholder:"123 Main Street",class:"form-input",required:""},null,512),[[k,r.value.address1]])]),a("div",We,[e[23]||(e[23]=a("label",{for:"address2"},"Address line 2",-1)),_(a("input",{type:"text",id:"address2","onUpdate:modelValue":e[6]||(e[6]=t=>r.value.address2=t),placeholder:"Apt, suite, unit number, etc. (optional)",class:"form-input"},null,512),[[k,r.value.address2]])]),a("div",Je,[e[24]||(e[24]=a("label",{for:"city"},[U("Ciudad "),a("span",{class:"text-red-500"},"*")],-1)),_(a("input",{type:"text",id:"city","onUpdate:modelValue":e[7]||(e[7]=t=>r.value.city=t),placeholder:"Ej: Bogot√°, Medell√≠n, Cali...",class:"form-input",required:"",list:"colombia-cities"},null,512),[[k,r.value.city]]),e[25]||(e[25]=Ae('<datalist id="colombia-cities" data-v-5de6234a><option value="Medell√≠n" data-v-5de6234a></option><option value="Bogot√°" data-v-5de6234a></option><option value="Cali" data-v-5de6234a></option><option value="Barranquilla" data-v-5de6234a></option><option value="Cartagena" data-v-5de6234a></option><option value="San Andr√©s Isla" data-v-5de6234a></option><option value="Santa Catalina" data-v-5de6234a></option><option value="Providencia" data-v-5de6234a></option><option value="Bucaramanga" data-v-5de6234a></option><option value="Pereira" data-v-5de6234a></option><option value="Manizales" data-v-5de6234a></option><option value="Ibagu√©" data-v-5de6234a></option><option value="Villavicencio" data-v-5de6234a></option><option value="Pasto" data-v-5de6234a></option><option value="Neiva" data-v-5de6234a></option></datalist>',1)),r.value.city?(p(),d("p",Xe,[a("span",null," üì¶ Costo de env√≠o: "+i(o.formatCOP(z.value)),1)])):I("",!0)]),a("div",Ze,[a("div",Qe,[e[27]||(e[27]=a("label",{for:"state"},[U("Departamento "),a("span",{class:"text-red-500"},"*")],-1)),_(a("select",{id:"state","onUpdate:modelValue":e[8]||(e[8]=t=>r.value.state=t),class:"form-input form-select",required:""},[e[26]||(e[26]=a("option",{value:""},"Selecciona un departamento",-1)),(p(!0),d(H,null,K(ne.value,t=>(p(),d("option",{key:t.isoCode,value:t.name},i(t.name),9,ea))),128))],512),[[te,r.value.state]])]),a("div",aa,[e[28]||(e[28]=a("label",{for:"zipcode"},[U("C√≥digo Postal "),a("span",{class:"text-red-500"},"*")],-1)),_(a("input",{type:"text",id:"zipcode","onUpdate:modelValue":e[9]||(e[9]=t=>r.value.zipCode=t),placeholder:"11001",class:"form-input",required:""},null,512),[[k,r.value.zipCode]])])]),a("div",oa,[e[29]||(e[29]=a("label",{for:"phone"},[U("Phone "),a("span",{class:"text-red-500"},"*")],-1)),a("div",ta,[_(a("select",{"onUpdate:modelValue":e[10]||(e[10]=t=>r.value.phoneCode=t),class:"phone-code",disabled:""},[(p(),d(H,null,K(E,t=>a("option",{key:t.code,value:t.dial_code},i(t.flag)+" "+i(t.dial_code),9,ra)),64))],512),[[te,r.value.phoneCode]]),_(a("input",{type:"tel",id:"phone","onUpdate:modelValue":e[11]||(e[11]=t=>r.value.phone=t),placeholder:"300 123 4567",class:"form-input phone-number",required:""},null,512),[[k,r.value.phone]])])]),a("div",sa,[e[30]||(e[30]=a("label",{for:"additional"},"Additional address details (optional)",-1)),_(a("textarea",{id:"additional","onUpdate:modelValue":e[12]||(e[12]=t=>r.value.additionalDetails=t),placeholder:"Special delivery instructions, gate codes, building details, etc.",class:"form-textarea",rows:"3"},null,512),[[k,r.value.additionalDetails]])])],64)):I("",!0),v.value==="gift"?(p(),d(H,{key:1},[a("div",la,[a("label",na,[U(i(o.$t("cart.checkout.form.username"))+" ",1),e[31]||(e[31]=a("span",{class:"text-red-500"},"*",-1))]),a("div",ia,[_(a("input",{type:"text",id:"username","onUpdate:modelValue":e[13]||(e[13]=t=>h.value=t),placeholder:o.$t("cart.checkout.form.placeholders.searchUser"),class:"form-input username-search-input",autocomplete:"off",onFocus:e[14]||(e[14]=t=>A.value=j(P).searchResults.length>0),onBlur:e[15]||(e[15]=()=>o.setTimeout(()=>A.value=!1,200))},null,40,ua),[[k,h.value]]),A.value&&j(P).searchResults.length>0?(p(),d("div",ca,[(p(!0),d(H,null,K(j(P).searchResults,t=>(p(),d("div",{key:t.id,class:"username-search-item",onMousedown:n=>re(t)},[a("img",{src:t.profile_picture||"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=40",alt:t.username,class:"search-avatar"},null,8,pa),a("div",va,[a("span",ma,"@"+i(t.username),1),t.is_crush?(p(),d("span",ga,"Crush")):I("",!0)])],40,da))),128))])):I("",!0)]),ue.value?(p(),d("p",fa,[a("span",ha,"@"+i(j($).username),1),U(" "+i(o.$t("cart.checkout.form.help.username")),1)])):I("",!0)]),a("div",ya,[a("label",_a,i(o.$t("cart.checkout.form.note")),1),_(a("textarea",{id:"note","onUpdate:modelValue":e[16]||(e[16]=t=>r.value.note=t),placeholder:o.$t("cart.checkout.form.placeholders.note"),class:"form-textarea",rows:"3"},null,8,Pa),[[k,r.value.note]])])],64)):I("",!0),a("div",wa,[a("h3",ba,i(o.$t("cart.checkout.form.paymentMethod")),1),a("p",Ca,i(o.$t("cart.checkout.form.selectPaymentMethod")),1),e[32]||(e[32]=a("div",{id:"paypal-button-container",class:"paypal-container"},null,-1)),c.value?(p(),d("p",Ea,i(c.value),1)):I("",!0)])])]),a("div",Aa,[a("div",Sa,[a("h2",Ia,i(o.$t("cart.checkout.form.orderSummary")),1),j(u).isUpdating?(p(),d("div",Ra,[...e[33]||(e[33]=[a("p",null,"Cargando productos...",-1)])])):(p(),d("div",La,[(p(!0),d(H,null,K(ie.value,t=>(p(),d("div",{key:t.id,class:"product-item"},[a("div",Ta,[a("img",{src:t.image||"https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=200",alt:t.name||"Product"},null,8,Ua)]),a("div",ka,[a("h4",Da,i(t.name||"Product"),1),t.color?(p(),d("p",Ga,"Color: "+i(t.color),1)):I("",!0),t.size?(p(),d("p",$a,"Talla: "+i(t.size),1)):I("",!0),t.attributes&&Object.keys(t.attributes).length>0?(p(),d("p",Oa,[(p(!0),d(H,null,K(t.attributes,(n,l)=>(p(),d("span",{key:l},i(l)+": "+i(n),1))),128))])):I("",!0),t.variation_id?(p(),d("p",qa," Variaci√≥n: #"+i(t.variation_id),1)):I("",!0)]),a("div",Fa,[a("span",null,i(t.quantity),1)]),a("div",Na,i(R(t.price*t.quantity)),1)]))),128))])),a("div",xa,[e[35]||(e[35]=a("h3",{class:"discount-title"},"Discount code",-1)),a("div",Ha,[_(a("input",{type:"text","onUpdate:modelValue":e[17]||(e[17]=t=>L.value=t),placeholder:"Enter your discount code",class:"form-input"},null,512),[[k,L.value]]),e[34]||(e[34]=a("button",{class:"validate-btn"},"Validate",-1))])]),a("div",Va,[a("div",Ma,[a("span",null,i(o.$t("cart.checkout.form.subtotal")),1),a("span",Ya,i(R(x.value)),1)]),a("div",Ba,[a("span",null,i(o.$t("cart.checkout.form.shipping")),1),a("span",za,[U(i(R(z.value))+" ",1),v.value==="gift"&&T.value?(p(),d("span",Ka," ("+i(T.value.username)+") ",1)):r.value.city?(p(),d("span",ja," ("+i(r.value.city)+") ",1)):I("",!0)])]),a("div",Wa,[a("span",null,[U(i(o.$t("cart.checkout.form.tax"))+" ",1),e[36]||(e[36]=a("span",{class:"tax-included-badge"},"(Incluido)",-1))]),a("span",Ja,i(R(Z.value)),1)])]),a("div",Xa,[a("div",Za,[a("span",Qa,i(o.$t("cart.checkout.form.total")),1),a("span",eo,i(R(S.value)),1)]),a("p",ao,i(o.$t("cart.checkout.form.taxIncluded",{tax:R(Z.value)})),1)])])])])]))}},vo=De(oo,[["__scopeId","data-v-5de6234a"]]);export{vo as default};
