import{I as Ne,J as Ue,K as xe,L as Oe,M as O,o as we,E as Q,c as i,b as l,d as r,j as $,e as pe,t as n,g as S,F as D,i as M,k as W,s as Be,u as ze,N as je,r as k,l as m,C as He,O as Qe,f as x,p as Ke,z as Je,m as Ge}from"./index.5R5gWBkF.js";import{u as Xe}from"./productStore._KaFrpxi.js";import{u as Ye}from"./cartStore.B8vYxJnB.js";import{u as Ze}from"./authStore.DqNlVBei.js";import{u as et}from"./profileStore.Dc7AL3fN.js";import{N as tt,F as st}from"./Footer.D0jsN-pf.js";import{T as rt,F as at}from"./FAQ.C6e1dhb6.js";import{W as ot,L as it,H as lt,a as nt}from"./ProductCard.Chfi_O1w.js";import{_ as _e}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./constants.DjCFsGER.js";import"./transition.H9-L56hH.js";import"./wishlistStore.BZpqzo5D.js";const fe=Ne("review",{state:()=>({productReviews:[],currentProductId:null,totalReviews:0,reviewStats:{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},currentReview:null,myReviews:[],totalMyReviews:0,hasReviewedProduct:!1,userProductReview:null,isLoadingReviews:!1,isLoadingStats:!1,isLoadingReviewDetail:!1,isLoadingMyReviews:!1,isCreatingReview:!1,isUpdatingReview:!1,isDeletingReview:!1,isCheckingReview:!1,reviewsError:null,statsError:null,reviewDetailError:null,myReviewsError:null,createError:null,updateError:null,deleteError:null,checkError:null}),getters:{getProductReviews:t=>t.productReviews,getTotalReviews:t=>t.totalReviews,getReviewStats:t=>t.reviewStats,getAverageRating:t=>t.reviewStats.average_rating,getRatingDistribution:t=>t.reviewStats.rating_distribution,getCurrentReview:t=>t.currentReview,getMyReviews:t=>t.myReviews,hasUserReviewed:t=>t.hasReviewedProduct,getUserProductReview:t=>t.userProductReview,isLoading:t=>t.isLoadingReviews||t.isLoadingStats||t.isLoadingReviewDetail||t.isLoadingMyReviews||t.isCreatingReview||t.isUpdatingReview||t.isDeletingReview||t.isCheckingReview,hasError:t=>t.reviewsError||t.statsError||t.reviewDetailError||t.myReviewsError||t.createError||t.updateError||t.deleteError||t.checkError},actions:{async fetchProductReviews(t,g=!0){var c,u;this.isLoadingReviews=!0,this.reviewsError=null,this.currentProductId=t;try{console.log(`ðŸ” Fetching reviews for product ${t}...`);const d=`reviews/product/${t}/?active_only=${g}`,y=await O(d);if(y.data.success)return this.productReviews=y.data.reviews||[],this.totalReviews=y.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalReviews} reviews for product ${t}`),{success:!0,data:y.data};throw new Error("Failed to fetch reviews")}catch(d){return console.error("âŒ Error fetching product reviews:",d),this.reviewsError=((u=(c=d.response)==null?void 0:c.data)==null?void 0:u.error)||d.message||"Error al cargar reseÃ±as",this.productReviews=[],this.totalReviews=0,{success:!1,error:this.reviewsError}}finally{this.isLoadingReviews=!1}},async fetchReviewStats(t){var g,c;this.isLoadingStats=!0,this.statsError=null;try{console.log(`ðŸ“Š Fetching review stats for product ${t}...`);const u=`reviews/product/${t}/stats/`,d=await O(u);if(d.data.success)return this.reviewStats=d.data.stats||{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},console.log(`âœ… Loaded stats: ${this.reviewStats.average_rating} avg rating, ${this.reviewStats.total_reviews} reviews`),{success:!0,data:d.data};throw new Error("Failed to fetch review stats")}catch(u){return console.error("âŒ Error fetching review stats:",u),this.statsError=((c=(g=u.response)==null?void 0:g.data)==null?void 0:c.error)||u.message||"Error al cargar estadÃ­sticas",{success:!1,error:this.statsError}}finally{this.isLoadingStats=!1}},async fetchReviewDetail(t){var g,c;this.isLoadingReviewDetail=!0,this.reviewDetailError=null;try{console.log(`ðŸ” Fetching review detail ${t}...`);const u=`reviews/${t}/`,d=await O(u);if(d.data.success)return this.currentReview=d.data.review,console.log(`âœ… Loaded review detail for review ${t}`),{success:!0,data:d.data};throw new Error("Failed to fetch review detail")}catch(u){return console.error("âŒ Error fetching review detail:",u),this.reviewDetailError=((c=(g=u.response)==null?void 0:g.data)==null?void 0:c.error)||u.message||"Error al cargar detalle de reseÃ±a",this.currentReview=null,{success:!1,error:this.reviewDetailError}}finally{this.isLoadingReviewDetail=!1}},async checkUserReview(t){var g,c;this.isCheckingReview=!0,this.checkError=null;try{console.log(`ðŸ” Checking if user has reviewed product ${t}...`);const u=`reviews/product/${t}/check/`,d=await O(u);if(d.data.success)return this.hasReviewedProduct=d.data.has_reviewed,this.userProductReview=d.data.review,console.log(`âœ… User ${this.hasReviewedProduct?"has":"has not"} reviewed product ${t}`),{success:!0,has_reviewed:this.hasReviewedProduct,review:this.userProductReview};throw new Error("Failed to check user review")}catch(u){return console.error("âŒ Error checking user review:",u),this.checkError=((c=(g=u.response)==null?void 0:g.data)==null?void 0:c.error)||u.message||"Error al verificar reseÃ±a",this.hasReviewedProduct=!1,this.userProductReview=null,{success:!1,error:this.checkError}}finally{this.isCheckingReview=!1}},async fetchMyReviews(){var t,g;this.isLoadingMyReviews=!0,this.myReviewsError=null;try{console.log("ðŸ” Fetching user reviews...");const u=await O("reviews/user/my-reviews/");if(u.data.success)return this.myReviews=u.data.reviews||[],this.totalMyReviews=u.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalMyReviews} user reviews`),{success:!0,data:u.data};throw new Error("Failed to fetch user reviews")}catch(c){return console.error("âŒ Error fetching user reviews:",c),this.myReviewsError=((g=(t=c.response)==null?void 0:t.data)==null?void 0:g.error)||c.message||"Error al cargar tus reseÃ±as",this.myReviews=[],this.totalMyReviews=0,{success:!1,error:this.myReviewsError}}finally{this.isLoadingMyReviews=!1}},async createReview(t){var g,c,u,d,y,w;this.isCreatingReview=!0,this.createError=null;try{console.log("ðŸ“ Creating new review...",t);const p=await Oe("reviews/",t);if(p.data.success){const R=p.data.review;return R.woocommerce_product_id===this.currentProductId&&(this.productReviews.unshift(R),this.totalReviews++),R.is_user_review&&(this.myReviews.unshift(R),this.totalMyReviews++,this.hasReviewedProduct=!0,this.userProductReview=R),console.log("âœ… Review created successfully:",R.id),{success:!0,data:p.data,review:R}}else throw new Error(p.data.message||"Failed to create review")}catch(_){return console.error("âŒ Error creating review:",_),this.createError=((c=(g=_.response)==null?void 0:g.data)==null?void 0:c.errors)||((d=(u=_.response)==null?void 0:u.data)==null?void 0:d.error)||_.message||"Error al crear reseÃ±a",{success:!1,error:this.createError,errors:(w=(y=_.response)==null?void 0:y.data)==null?void 0:w.errors}}finally{this.isCreatingReview=!1}},async updateReview(t,g){var c,u,d,y,w,_,p,R;this.isUpdatingReview=!0,this.updateError=null;try{console.log(`ðŸ“ Updating review ${t}...`,g);const L=`reviews/${t}/update/`,F=await xe(L,g);if(F.data.success){const f=F.data.review,E=this.productReviews.findIndex(T=>T.id===t);E!==-1&&(this.productReviews[E]=f);const C=this.myReviews.findIndex(T=>T.id===t);return C!==-1&&(this.myReviews[C]=f),((c=this.userProductReview)==null?void 0:c.id)===t&&(this.userProductReview=f),((u=this.currentReview)==null?void 0:u.id)===t&&(this.currentReview=f),console.log("âœ… Review updated successfully:",t),{success:!0,data:F.data,review:f}}else throw new Error(F.data.message||"Failed to update review")}catch(L){return console.error("âŒ Error updating review:",L),this.updateError=((y=(d=L.response)==null?void 0:d.data)==null?void 0:y.errors)||((_=(w=L.response)==null?void 0:w.data)==null?void 0:_.error)||L.message||"Error al actualizar reseÃ±a",{success:!1,error:this.updateError,errors:(R=(p=L.response)==null?void 0:p.data)==null?void 0:R.errors}}finally{this.isUpdatingReview=!1}},async deleteReview(t){var g,c,u,d;this.isDeletingReview=!0,this.deleteError=null;try{console.log(`ðŸ—‘ï¸ Deleting review ${t}...`);const y=`reviews/${t}/delete/`,w=await Ue(y);if(w.data.success){const _=w.data.woocommerce_product_id;return this.productReviews=this.productReviews.filter(p=>p.id!==t),this.totalReviews=Math.max(0,this.totalReviews-1),this.myReviews=this.myReviews.filter(p=>p.id!==t),this.totalMyReviews=Math.max(0,this.totalMyReviews-1),((g=this.userProductReview)==null?void 0:g.id)===t&&(this.userProductReview=null,this.hasReviewedProduct=!1),((c=this.currentReview)==null?void 0:c.id)===t&&(this.currentReview=null),console.log("âœ… Review deleted successfully:",t),{success:!0,data:w.data,productId:_}}else throw new Error(w.data.message||"Failed to delete review")}catch(y){return console.error("âŒ Error deleting review:",y),this.deleteError=((d=(u=y.response)==null?void 0:u.data)==null?void 0:d.error)||y.message||"Error al eliminar reseÃ±a",{success:!1,error:this.deleteError}}finally{this.isDeletingReview=!1}},clearErrors(){this.reviewsError=null,this.statsError=null,this.reviewDetailError=null,this.myReviewsError=null,this.createError=null,this.updateError=null,this.deleteError=null,this.checkError=null},clearProductReviews(){this.productReviews=[],this.totalReviews=0,this.currentProductId=null,this.reviewStats={total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},this.hasReviewedProduct=!1,this.userProductReview=null},clearCurrentReview(){this.currentReview=null},clearMyReviews(){this.myReviews=[],this.totalMyReviews=0},resetStore(){this.clearProductReviews(),this.clearCurrentReview(),this.clearMyReviews(),this.clearErrors()}}}),ct={class:"product-reviews-section"},ut={class:"reviews-container"},dt={class:"reviews-header"},vt={class:"reviews-title"},ht={class:"reviews-count"},gt={class:"reviews-actions"},pt={class:"latest-button"},wt={class:"write-review-button"},_t={key:0,class:"loading-state"},ft={class:"loading-text"},mt={key:1,class:"error-state"},yt={class:"error-text"},Rt={key:2,class:"empty-state"},bt={class:"empty-text"},kt={key:3,class:"reviews-grid"},$t={class:"review-header"},Et={class:"review-stars"},Ct=["onClick"],Pt={class:"review-author"},St={class:"author-name"},Dt={key:0,class:"verified-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},Lt={key:0,class:"review-title"},Ft={class:"review-text"},Tt={class:"review-date"},qt={key:4,class:"load-more-container"},At={class:"load-more-button"},Mt={__name:"ProductReviews",props:{productId:{type:[Number,String],required:!0}},setup(t){const g=t,c=fe(),u=async()=>{g.productId&&(console.log(`ðŸ”„ Loading reviews for product ${g.productId}...`),await Promise.all([c.fetchProductReviews(g.productId,!0),c.fetchReviewStats(g.productId)]))},d=w=>{if(!w)return"";const _=new Date(w),p={year:"numeric",month:"long",day:"numeric"};return _.toLocaleDateString("es-ES",p)},y=w=>{console.log("Review menu clicked:",w)};return we(()=>{u()}),Q(()=>g.productId,w=>{w&&u()}),(w,_)=>(l(),i("section",ct,[r("div",ut,[r("div",dt,[r("h2",vt,[pe(n(w.$t("productReviews.title"))+" ",1),r("span",ht,"("+n(S(c).getTotalReviews)+")",1)]),r("div",gt,[r("button",pt,[pe(n(w.$t("productReviews.latest"))+" ",1),_[0]||(_[0]=r("svg",{class:"dropdown-icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),r("button",wt,n(w.$t("productReviews.writeReview")),1)])]),S(c).isLoadingReviews?(l(),i("div",_t,[_[1]||(_[1]=r("div",{class:"loading-spinner"},null,-1)),r("p",ft,n(w.$t("productReviews.loading")),1)])):S(c).reviewsError?(l(),i("div",mt,[r("p",yt,n(S(c).reviewsError),1),r("button",{onClick:u,class:"retry-button"},n(w.$t("productReviews.retry")),1)])):S(c).getTotalReviews===0?(l(),i("div",Rt,[r("p",bt,n(w.$t("productReviews.noReviews")),1)])):(l(),i("div",kt,[(l(!0),i(D,null,M(S(c).getProductReviews,p=>(l(),i("div",{key:p.id,class:W(["review-card",{highlighted:p.is_user_review}])},[r("div",$t,[r("div",Et,[(l(),i(D,null,M(5,R=>r("span",{key:R,class:W(["star",{filled:R<=p.rating}])}," â˜… ",2)),64))]),p.is_user_review?(l(),i("button",{key:0,class:"review-menu-button",onClick:R=>y(p.id)},[..._[2]||(_[2]=[r("span",null,"â‹¯",-1)])],8,Ct)):$("",!0)]),r("div",Pt,[r("span",St,n(p.reviewer_name),1),p.is_verified_purchase?(l(),i("svg",Dt,[..._[3]||(_[3]=[r("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z","clip-rule":"evenodd"},null,-1)])])):$("",!0)]),p.title?(l(),i("h4",Lt,n(p.title),1)):$("",!0),r("p",Ft,n(p.comment),1),r("p",Tt,n(w.$t("productReviews.postedOn"))+" "+n(d(p.created_at)),1)],2))),128))])),S(c).getTotalReviews>0?(l(),i("div",qt,[r("button",At,n(w.$t("productReviews.loadMore")),1)])):$("",!0)])]))}},Vt=_e(Mt,[["__scopeId","data-v-6c17376b"]]),It={class:"product-detail-container"},Wt={class:"main-content"},Nt={class:"product-detail-view"},Ut={key:0,class:"loading-container"},xt={key:1,class:"error-container"},Ot={key:2,class:"product-content"},Bt={class:"product-layout"},zt={class:"product-gallery"},jt={class:"thumbnail-selector"},Ht=["disabled"],Qt=["onClick"],Kt=["src","alt"],Jt=["disabled"],Gt={class:"main-image-container"},Xt=["src","alt"],Yt={class:"product-info"},Zt={class:"flex items-center justify-between gap-4 mb-4"},es={class:"product-title flex-1"},ts={class:"flex items-center gap-2"},ss=["title"],rs=["src"],as=["disabled","title"],os=["src"],is={class:"product-reviews"},ls={class:"stars"},ns={key:0,class:"rating-text"},cs={key:1,class:"rating-count"},us={key:2,class:"rating-count"},ds={class:"product-price"},vs={key:0,class:"sale-badge"},hs={class:"flex items-baseline gap-2"},gs={class:"current-price"},ps={class:"text-sm text-gray-500 font-poppins"},ws={key:1,class:"regular-price"},_s={key:0,class:"sale-badge"},fs={class:"flex items-baseline gap-2"},ms={class:"current-price"},ys={class:"text-sm text-gray-500 font-poppins"},Rs={key:1,class:"regular-price"},bs={key:0,class:"product-description"},ks=["innerHTML"],$s={key:1,class:"product-options-container"},Es={class:"attribute-selector"},Cs=["onClick"],Ps={class:"attribute-selector"},Ss=["onClick"],Ds={class:"product-actions"},Ls={class:"quantity-selector"},Fs=["disabled"],Ts=["disabled"],qs=["disabled"],As={class:"action-buttons-row"},Ms=["disabled"],Vs={key:0,class:"loading-text"},Is={key:1},Ws=["disabled"],Ns={key:0,class:"loading-text"},Us={key:1},xs={key:2,class:"whitespace-nowrap"},Os={key:3,class:"cart-error-message"},Bs={class:"attribute-info"},zs={class:"info-value"},js={key:3,class:"not-found-container"},Hs={__name:"ProductDetailView",props:{id:{type:String,required:!0}},setup(t){const g=He(),c=Ge(),{t:u}=Be(),d=Xe(),y=Ye(),w=Ze(),_=ze(),p=fe(),R=je(),L=et(),F=k(0),f=k({}),E=k(1),C=k(!1),T=k(!1),B=k(null),V=k(0),j=k(5),K=k(null),H=k(!1),z=k(!1),J=k(!1),P=k(null),G=k(!1),N=k(null),A=m(()=>g.params.id),a=m(()=>d.wooCurrentProduct),me=m(()=>d.isLoadingWooProduct),se=m(()=>d.wooError),X=m(()=>{var e;return p.getAverageRating>0?parseFloat(p.getAverageRating):(e=a.value)!=null&&e.average_rating?parseFloat(a.value.average_rating):0}),Y=m(()=>{var e;return p.getTotalReviews>0?p.getTotalReviews:(e=a.value)!=null&&e.rating_count?a.value.rating_count:0}),ye=m(()=>!a.value||!a.value.images||a.value.images.length===0?[{src:"https://images.unsplash.com/photo-1583394838336-acd977736f90?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1519947486511-46149fa0a254?w=500&h=500&fit=crop&crop=center"}]:a.value.images),I=m(()=>$e.value),Re=m(()=>{var e,s;return((e=I.value[F.value])==null?void 0:e.src)||((s=I.value[0])==null?void 0:s.src)});m(()=>{var e;if(!((e=a.value)!=null&&e.short_description))return"";if(ke.value){let s=a.value.short_description;return s=s.replace(/<h[3-5][^>]*>.*?(?:Precio sugerido|precio sugerido).*?<\/h[3-5]>/gi,""),s=s.replace(/<(?:span|div)[^>]*>\s*\$[\d,.]+\s*<\/(?:span|div)>/gi,""),s.trim()}return a.value.short_description});const be=m(()=>{var o;if(!((o=a.value)!=null&&o.description))return!1;if(!a.value.short_description)return!0;const e=a.value.short_description.replace(/<[^>]*>/g,"").trim(),s=a.value.description.replace(/<[^>]*>/g,"").trim();return e!==s&&s.length>e.length}),ke=m(()=>a.value&&a.value.type==="simple"),b=m(()=>a.value&&a.value.type==="variable"),h=m(()=>d.wooCurrentVariation),re=m(()=>{var e;return(e=a.value)!=null&&e.attributes?a.value.attributes.map(s=>({id:s.slug||s.name,name:s.name,slug:s.slug,options:s.options||[],variation:!0})).reverse():[]}),U=m(()=>{var e;return((e=a.value)==null?void 0:e.available_variations)||[]}),$e=m(()=>{var e;if(b.value&&h.value){if(h.value.images&&h.value.images.length>0)return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes mÃºltiples de variaciÃ³n:",h.value.images.length),h.value.images;if(h.value.image){console.log("ðŸ–¼ï¸ [ProductDetail] Usando imagen Ãºnica de variaciÃ³n:",h.value.image);const s=typeof h.value.image=="string"?h.value.image:h.value.image.src;if(s)return[{src:s,thumbnail:s,alt:((e=a.value)==null?void 0:e.name)||"Product variation"}]}}return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes del producto base"),ye.value}),ae=m(()=>{if(!a.value)return"$0";let e=0,s=!1;return b.value&&h.value?(e=parseFloat(h.value.converted_price||h.value.price)||0,s=h.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] VariaciÃ³n - Precio: $${e}, En oferta: ${s}`)):(e=parseFloat(a.value.converted_price||a.value.price)||0,s=a.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] Producto - Precio: $${e}, En oferta: ${s}`)),`$${e.toLocaleString("es-CO")}`}),Ee=m(()=>{var e;return a.value?b.value&&((e=h.value)!=null&&e.price)?parseFloat(h.value.converted_price||h.value.price)||0:parseFloat(a.value.converted_price||a.value.price)||0:0}),oe=m(()=>{if(b.value){if(h.value)return h.value.stock_status==="instock"&&(h.value.stock_quantity===null||h.value.stock_quantity>0);if(U.value.length>0){const e=ve();if(e)return e.in_stock&&e.stock_quantity>0}return!1}return P.value&&!b.value?P.value.available&&P.value.status==="instock":a.value?a.value.stock_status==="instock"&&a.value.in_stock:!1}),ie=m(()=>{var e;return(e=a.value)!=null&&e.attributes?a.value.attributes.filter(s=>{const o=s.name.toLowerCase();return!o.includes("color")&&!o.includes("colour")&&!o.includes("cor")&&!o.includes("size")&&!o.includes("talla")&&!o.includes("tamaÃ±o")}):[]}),le=m(()=>ie.value.filter(e=>e.variation===!0)),Ce=m(()=>ie.value.filter(e=>e.variation===!1)),ne=async e=>{if(a.value){console.log(`ðŸ”„ Cargando detalle completo de variaciÃ³n ${e}`);try{const s=await d.fetchWooProductVariation(a.value.id,e);s.success&&s.data&&(console.log(`âœ… VariaciÃ³n ${e} cargada con detalle completo:`,{id:s.data.id,price:s.data.price,stock_quantity:s.data.stock_quantity,stock_status:s.data.stock_status,image:s.data.image,attributes:s.data.attributes}),F.value=0)}catch(s){console.error(`âŒ Error cargando variaciÃ³n ${e}:`,s)}}},ce=async()=>{if(!(!A.value||G.value)){if(b.value){console.log("ðŸ“¦ Producto variable detectado - stock se maneja por variaciÃ³n"),P.value={status:"variable",requires_variation_selection:!0,available:!0};return}G.value=!0;try{console.log(`ðŸ“¦ Consultando stock en tiempo real para producto ${A.value}...`);const e=await O(`products/woocommerce/products/${A.value}/stock/`);e.data.success&&(P.value=e.data.stock,console.log("âœ… Stock actualizado:",{status:P.value.status,quantity:P.value.quantity,available:P.value.available,source:e.data.source}),a.value&&!b.value&&(a.value.stock_status=P.value.status,a.value.stock_quantity=P.value.quantity,a.value.in_stock=P.value.in_stock))}catch(e){console.error("âŒ Error consultando stock en tiempo real:",e),a.value&&(P.value={status:a.value.stock_status,quantity:a.value.stock_quantity,manage_stock:a.value.manage_stock,in_stock:a.value.in_stock,available:a.value.stock_status==="instock"})}finally{G.value=!1}}},Pe=()=>{N.value&&clearInterval(N.value),N.value=setInterval(()=>{ce()},3e4),console.log("â° Polling de stock iniciado (cada 30 segundos)")},ue=()=>{N.value&&(clearInterval(N.value),N.value=null,console.log("â° Polling de stock detenido"))},Se=async()=>{if(!b.value||U.value.length===0)return;console.log("ðŸŽ¯ Preseleccionando primera variaciÃ³n...");const e=U.value[0];f.value={...e.attributes},console.log("ðŸ“‹ Atributos preseleccionados:",f.value),d.setWooCurrentVariation({id:e.id,price:e.price,stock_status:e.in_stock?"instock":"outofstock",stock_quantity:e.stock_quantity,attributes:e.attributes,image:e.image||null}),console.log(`âœ… Primera variaciÃ³n preseleccionada: ID ${e.id}, Precio: $${e.price}`),await ne(e.id)},Z=async()=>{var e;if(A.value){console.log(`ðŸ›ï¸ Cargando producto ID: ${A.value}`);try{const s=await d.fetchWooProduct(A.value);s.success?(console.log("âœ… Producto cargado:",s.data.name),s.data.type==="variable"&&(console.log(`ðŸ“¦ Producto variable con ${s.data.variations_count} variaciones`),console.log("âœ… available_variations ya incluidas:",((e=s.data.available_variations)==null?void 0:e.length)||0),Se()),await ce(),Pe()):console.error("âŒ Error cargando producto:",s.error)}catch(s){console.error("âŒ Error inesperado:",s)}}},De=e=>{F.value=e},Le=()=>{V.value>0&&(V.value--,de())},Fe=()=>{V.value<I.value.length-j.value&&(V.value++,de())},de=()=>{if(K.value){const e=V.value*78;K.value.scrollTop=e}},ve=()=>{if(!b.value||U.value.length===0)return console.warn("âš ï¸ No hay producto variable o no hay variaciones disponibles"),null;console.log("ðŸ” Buscando variaciÃ³n con atributos seleccionados:",f.value),console.log("ðŸ“¦ Variaciones disponibles:",U.value);const e=U.value.find(s=>{console.log(`ðŸ”Ž Comparando con variaciÃ³n ${s.id}:`,s.attributes);const o=Object.keys(f.value).every(v=>{const q=f.value[v],te=s.attributes[v];return console.log(`  - Atributo "${v}": seleccionado="${q}", variaciÃ³n="${te}", match=${te===q}`),te===q});return console.log(`  â†’ VariaciÃ³n ${s.id} ${o?"âœ… COINCIDE":"âŒ NO coincide"}`),o});return e?console.log("âœ… VariaciÃ³n encontrada:",e.id):console.error("âŒ No se encontrÃ³ variaciÃ³n que coincida con:",f.value),e},he=async(e,s)=>{if(f.value={...f.value,[e]:s},console.log(`ðŸŽ¯ Atributo seleccionado: ${e} = ${s}`),console.log("ðŸ“‹ Atributos seleccionados:",f.value),b.value){const o=ve();o?(console.log("âœ… VariaciÃ³n encontrada en available_variations:",o.id),console.log("ðŸ’° Precio de variaciÃ³n:",o.price),console.log("ðŸ–¼ï¸ Imagen de variaciÃ³n:",o.image),d.setWooCurrentVariation({id:o.id,price:o.price,stock_status:o.in_stock?"instock":"outofstock",stock_quantity:o.stock_quantity,attributes:o.attributes,image:o.image||null}),await ne(o.id)):(console.warn("âš ï¸ No se encontrÃ³ variaciÃ³n con esos atributos"),d.setWooCurrentVariation(null))}},ee=e=>{const o=`productDetail.attributes.${e.toLowerCase()}`,v=u(o);return v===o?e:v},Te=()=>{E.value<99&&E.value++},qe=()=>{E.value>1&&E.value--},ge=async()=>{var e,s,o;if(!(!a.value||C.value)){T.value=!1,B.value=null,C.value=!0;try{const v={name:a.value.name,price:Ee.value,image:((s=(e=a.value.images)==null?void 0:e[0])==null?void 0:s.src)||null,stock_status:a.value.stock_status};b.value&&h.value&&(v.variation_id=h.value.id,(o=h.value.image)!=null&&o.src&&(v.image=h.value.image.src),console.log(`ðŸ“¦ Producto variable - VariaciÃ³n ID: ${h.value.id}`)),Object.keys(f.value).length>0&&(v.attributes=f.value),console.log("ðŸ›’ Agregando al carrito:",{productId:a.value.id,variationId:v.variation_id||null,quantity:E.value,options:v});const q=await y.addToCart(a.value.id,E.value,v);q.success?(T.value=!0,console.log("âœ… Producto agregado al carrito exitosamente"),setTimeout(()=>{T.value=!1},3e3),E.value=1):(B.value=q.error||"Error al agregar al carrito",console.error("âŒ Error al agregar al carrito:",q.error))}catch(v){B.value="Error inesperado al agregar al carrito",console.error("âŒ Error inesperado:",v)}finally{C.value=!1}}},Ae=async()=>{!a.value||C.value||(await ge(),T.value&&c.push({name:`Checkout-${_.locale}`}))},Me=async()=>{if(!w.isLoggedIn){c.push({name:`Login-${_.locale}`});return}J.value=!0;try{z.value?(await L.removeProductFromFavorites(a.value.id)).success&&(z.value=!1):(await L.addProductToFavorites(a.value.id)).success&&(z.value=!0)}catch(e){console.error("Error toggling favorite:",e)}finally{J.value=!1}},Ve=()=>{if(!w.isLoggedIn){c.push({name:`Login-${_.locale}`});return}H.value=!0},Ie=e=>{console.log(`Product ${a.value.id} added to wishlist ${e}`)},We=()=>{H.value=!1,c.push({name:`ProfileWishlist-${_.locale}`})};return we(()=>{Z()}),Qe(()=>{ue()}),Q(h,e=>{if(e&&e.attributes&&e.attributes.length>0){console.log("ðŸ”„ Inicializando atributos con variaciÃ³n:",e.id);const s={};e.attributes.forEach(o=>{s[o.name]=o.option,console.log(`âœ… Atributo "${o.name}" = "${o.option}"`)}),f.value=s}}),Q(A,(e,s)=>{e&&e!==s&&(console.log(`ðŸ”„ Cambio de producto detectado: ${s} â†’ ${e}`),ue(),P.value=null,f.value={},d.setWooCurrentVariation(null),Z())}),Q(a,(e,s)=>{if(e&&(s&&e.id!==s.id&&(console.log("ðŸ”„ Cambio de producto detectado, limpiando variaciones"),d.clearWooVariations(),f.value={}),V.value=0,F.value=0,!b.value)){const o={...f.value};le.value.forEach(v=>{v.options&&v.options.length>0&&!o[v.name]&&(o[v.name]=v.options[0])}),f.value=o}},{immediate:!0}),(e,s)=>(l(),i("div",It,[x(tt),r("main",Wt,[r("div",Nt,[me.value?(l(),i("div",Ut,[s[2]||(s[2]=r("div",{class:"loading-spinner"},null,-1)),r("p",null,n(e.$t("productDetail.loading")),1)])):se.value?(l(),i("div",xt,[r("h2",null,n(e.$t("productDetail.error.title")),1),r("p",null,n(se.value),1),r("button",{onClick:Z,class:"retry-btn"},n(e.$t("productDetail.error.retry")),1)])):a.value?(l(),i("div",Ot,[r("div",Bt,[r("div",zt,[r("div",jt,[I.value.length>j.value?(l(),i("button",{key:0,onClick:Le,disabled:V.value===0,class:"thumbnail-nav-btn thumbnail-nav-up"}," â–² ",8,Ht)):$("",!0),r("div",{class:"thumbnail-list",ref_key:"thumbnailList",ref:K},[(l(!0),i(D,null,M(I.value,(o,v)=>(l(),i("div",{key:v,class:W(["thumbnail",{active:F.value===v}]),onClick:q=>De(v)},[r("img",{src:o.src,alt:`${a.value.name} - imagen ${v+1}`},null,8,Kt)],10,Qt))),128))],512),I.value.length>j.value?(l(),i("button",{key:1,onClick:Fe,disabled:V.value>=I.value.length-j.value,class:"thumbnail-nav-btn thumbnail-nav-down"}," â–¼ ",8,Jt)):$("",!0)]),r("div",Gt,[r("img",{src:Re.value,alt:a.value.name,class:"main-image"},null,8,Xt)])]),r("div",Yt,[r("div",Zt,[r("h1",es,n(a.value.name),1),r("div",ts,[r("button",{onClick:Ve,class:"action-icon-btn",title:e.$t("productDetail.addToWishlist")||"Add to wishlist"},[r("img",{src:S(it),alt:"Wishlist icon",class:"w-6 h-6"},null,8,rs)],8,ss),r("button",{onClick:Me,disabled:J.value,class:"action-icon-btn",title:z.value?e.$t("productDetail.removeFromFavorites"):e.$t("productDetail.addToFavorites")},[r("img",{src:z.value?S(lt):S(nt),alt:"Favorite icon",class:"w-6 h-6"},null,8,os)],8,as)])]),r("div",is,[r("div",ls,[(l(),i(D,null,M(5,o=>r("span",{key:o,class:W(["star",{filled:o<=Math.floor(X.value)}])},"â˜…",2)),64)),X.value>0?(l(),i("span",ns,n(X.value.toFixed(1))+"/5",1)):$("",!0),Y.value>0?(l(),i("span",cs,"("+n(Y.value)+" "+n(Y.value===1?e.$t("productReviews.review"):e.$t("productReviews.reviews"))+")",1)):(l(),i("span",us,"("+n(e.$t("productReviews.reviewCount.none"))+")",1))])]),r("div",ds,[b.value&&h.value?(l(),i(D,{key:0},[h.value.on_sale?(l(),i("span",vs,n(e.$t("productDetail.saleBadge")||"SALE"),1)):$("",!0),r("div",hs,[r("span",gs,n(ae.value),1),r("span",ps,n(S(R).currentCurrency),1)]),h.value.on_sale&&h.value.regular_price?(l(),i("span",ws," $"+n(parseFloat(h.value.converted_regular_price||h.value.regular_price).toLocaleString("es-CO")),1)):$("",!0)],64)):(l(),i(D,{key:1},[a.value.on_sale?(l(),i("span",_s,n(e.$t("productDetail.saleBadge")||"SALE"),1)):$("",!0),r("div",fs,[r("span",ms,n(ae.value),1),r("span",ys,n(S(R).currentCurrency),1)]),a.value.on_sale&&a.value.regular_price?(l(),i("span",Rs," $"+n(parseFloat(a.value.converted_regular_price||a.value.regular_price).toLocaleString("es-CO")),1)):$("",!0)],64))]),be.value?(l(),i("div",bs,[r("div",{innerHTML:a.value.description},null,8,ks)])):$("",!0),b.value&&re.value.length>0?(l(),i("div",$s,[(l(!0),i(D,null,M(re.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(ee(o.name)),1),r("div",Es,[(l(!0),i(D,null,M(o.options,v=>(l(),i("button",{key:v,class:W(["attribute-option",{active:f.value[o.name]===v}]),onClick:q=>he(o.name,v)},n(v),11,Cs))),128))])]))),128))])):$("",!0),b.value?$("",!0):(l(!0),i(D,{key:2},M(le.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(ee(o.name)),1),r("div",Ps,[(l(!0),i(D,null,M(o.options,v=>(l(),i("button",{key:v,class:W(["attribute-option",{active:f.value[o.name]===v}]),onClick:q=>he(o.name,v)},n(v),11,Ss))),128))])]))),128)),r("div",Ds,[r("div",Ls,[r("button",{onClick:qe,disabled:E.value<=1||C.value,class:"quantity-btn"},"-",8,Fs),Ke(r("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>E.value=o),type:"number",min:"1",max:"99",class:"quantity-input",disabled:C.value},null,8,Ts),[[Je,E.value,void 0,{number:!0}]]),r("button",{onClick:Te,disabled:E.value>=99||C.value,class:"quantity-btn"},"+",8,qs)]),r("div",As,[r("button",{onClick:Ae,disabled:!oe.value||C.value,class:"buy-now-btn"},[C.value?(l(),i("span",Vs,"â³")):(l(),i("span",Is,n(e.$t("productDetail.buyNow")),1))],8,Ms),r("button",{onClick:ge,disabled:!oe.value||C.value,class:W(["add-to-cart-btn",{success:T.value}])},[C.value?(l(),i("span",Ns,"â³")):T.value?(l(),i("span",Us,"âœ“ "+n(e.$t("productDetail.addedToCart")),1)):(l(),i("span",xs,n(e.$t("productDetail.addToCart")),1))],10,Ws)])]),x(ot,{show:H.value,"product-id":a.value.id,onClose:s[1]||(s[1]=o=>H.value=!1),onAdded:Ie,onCreateWishlist:We},null,8,["show","product-id"]),B.value?(l(),i("div",Os,n(B.value),1)):$("",!0),(l(!0),i(D,null,M(Ce.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(ee(o.name)),1),r("div",Bs,[r("span",zs,n(o.options.join(", ")),1)])]))),128))])])])):(l(),i("div",js,[r("h2",null,n(e.$t("productDetail.notFound.title")),1),r("p",null,n(e.$t("productDetail.notFound.message",{id:A.value})),1)]))]),x(Vt,{"product-id":A.value},null,8,["product-id"]),x(rt),x(at)]),x(st)]))}},or=_e(Hs,[["__scopeId","data-v-a4ba07d0"]]);export{or as default};
