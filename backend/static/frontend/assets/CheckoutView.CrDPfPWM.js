import{r as f,o as ke,O as De,E as re,c as n,b as i,d as t,N as Le,u as Ve,l as U,m as Ge,j as w,t as r,p as D,P as Ce,e as M,z as W,F as Q,H as _e,Q as Re,i as se,g as Z,f as He,k as be,G as qe}from"./index.wIsFJS4U.js";import{u as Ke}from"./cartStore.DmGuu8Rw.js";import{u as Ye}from"./authStore.CY8u6nYg.js";import{u as ze}from"./crushStore.DOAObdj4.js";import{u as Be}from"./paymentStore.BNbGchZc.js";import{u as Je}from"./productStore.BRRaSOmZ.js";import{u as je}from"./useAlert.DokLwNXu.js";import{C as xe,S as Qe}from"./state.DRCieogr.js";import{_ as Se}from"./_plugin-vue_export-helper.DlAUqK2U.js";import"./constants.DjCFsGER.js";const Xe={class:"wompi-widget-container"},Ze={__name:"WompiWidget",props:{widgetData:{type:Object,required:!0},renderMode:{type:String,default:"button"}},setup(ge){const c=ge,_=f(null);let u=null;ke(()=>{G()}),De(()=>{u&&u.parentNode&&u.parentNode.removeChild(u)}),re(()=>c.widgetData,()=>{G()},{deep:!0});function G(){if(console.log("ðŸ”µ [WOMPI WIDGET] Loading widget with data:",c.widgetData),console.log("ðŸ”µ [WOMPI WIDGET] Form ref:",_.value),console.log("ðŸ”µ [WOMPI WIDGET] Render mode:",c.renderMode),!_.value||!c.widgetData){console.warn("âš ï¸ [WOMPI WIDGET] Form ref or widget data not ready",{hasForm:!!_.value,hasData:!!c.widgetData});return}u&&u.parentNode&&(console.log("ðŸ§¹ [WOMPI WIDGET] Removing previous script"),u.parentNode.removeChild(u)),u=document.createElement("script"),u.src="https://checkout.wompi.co/widget.js",console.log("ðŸ“ [WOMPI WIDGET] Configurando atributos del widget:",{public_key:c.widgetData.public_key,currency:c.widgetData.currency,amount_in_cents:c.widgetData.amount_in_cents,reference:c.widgetData.reference,redirect_url:c.widgetData.redirect_url}),u.setAttribute("data-render",c.renderMode),u.setAttribute("data-public-key",c.widgetData.public_key),u.setAttribute("data-currency",c.widgetData.currency),u.setAttribute("data-amount-in-cents",c.widgetData.amount_in_cents),u.setAttribute("data-reference",c.widgetData.reference),u.setAttribute("data-signature:integrity",c.widgetData.signature),u.setAttribute("data-redirect-url",c.widgetData.redirect_url),c.widgetData.customer_data&&(console.log("ðŸ‘¤ [WOMPI WIDGET] Customer data:",c.widgetData.customer_data),u.setAttribute("data-customer-data:email",c.widgetData.customer_data.email),u.setAttribute("data-customer-data:full-name",c.widgetData.customer_data.full_name),c.widgetData.customer_data.phone_number&&u.setAttribute("data-customer-data:phone-number",c.widgetData.customer_data.phone_number),c.widgetData.customer_data.phone_number_prefix&&u.setAttribute("data-customer-data:phone-number-prefix",c.widgetData.customer_data.phone_number_prefix)),_.value.appendChild(u),console.log("âœ… [WOMPI WIDGET] Script agregado al DOM"),I(),console.log("âœ… [WOMPI WIDGET] Widget script loaded and listeners setup")}function I(){const S=T=>{var le,ee,te;if(!T.origin.includes("wompi.co")&&!T.origin.includes("localhost"))return;const l=T.data;l&&l.event&&!["heightchanged","scrolltop"].includes(l.event)&&console.log("ðŸ“¨ [WOMPI WIDGET] Evento:",l.event,l);let A=null,F=null,h=null;if(l&&l.transaction)A=l.transaction.id,F=l.transaction.status,h=l.transaction.reference,console.log("ðŸ“‹ [WOMPI] Formato 1 - transaction object:",l.transaction);else if(l&&l.id)A=l.id,F=l.status,h=l.reference,console.log("ðŸ“‹ [WOMPI] Formato 2 - direct id:",l);else if(l&&l.data&&l.data.transaction_id)A=l.data.transaction_id,F=l.data.status,h=l.data.reference,console.log("ðŸ“‹ [WOMPI] Formato 3 - nested transaction_id:",l.data);else if(l&&l.transaction_id)A=l.transaction_id,F=l.status,h=l.reference,console.log("ðŸ“‹ [WOMPI] Formato 4 - direct transaction_id:",l);else if(typeof l=="string")try{const $=JSON.parse(l);A=((le=$.transaction)==null?void 0:le.id)||$.transaction_id||$.id,F=((ee=$.transaction)==null?void 0:ee.status)||$.status,h=((te=$.transaction)==null?void 0:te.reference)||$.reference,console.log("ðŸ“‹ [WOMPI] Formato 5 - parsed string:",$)}catch{}if(A){console.log("âœ… [WOMPI WIDGET] TransacciÃ³n detectada:",{id:A,status:F,reference:h}),localStorage.setItem("wompi_last_transaction",JSON.stringify({id:A,status:F,reference:h,timestamp:Date.now()}));const $=`${c.widgetData.redirect_url}?id=${A}`;console.log("ðŸ”— [WOMPI WIDGET] Redirigiendo a:",$),window.removeEventListener("message",S),setTimeout(()=>{window.location.href=$},500)}};window.addEventListener("message",S);const C=setInterval(()=>{const T=localStorage.getItem("wompi_last_transaction");if(T)try{const l=JSON.parse(T);l.id&&l.reference===c.widgetData.reference&&(console.log("âœ… [WOMPI WIDGET] TransacciÃ³n detectada via localStorage:",l),clearInterval(C),window.removeEventListener("message",S),window.location.href=`${c.widgetData.redirect_url}?id=${l.id}`)}catch{}},1e3);setTimeout(()=>{clearInterval(C)},3e5)}return(S,C)=>(i(),n("div",Xe,[t("form",{ref_key:"wompiForm",ref:_},null,512)]))}},et=Se(Ze,[["__scopeId","data-v-51bb85e1"]]),tt={class:"checkout-view"},at={class:"checkout-container"},ot={class:"shipping-section"},st={class:"shipping-card"},rt={class:"section-title"},lt={class:"shipping-type"},nt={class:"radio-label"},it={class:"radio-label"},ct={class:"form-group"},ut={for:"email"},dt=["placeholder"],pt={key:0,class:"gift-field-description"},mt={class:"form-group"},vt={for:"fullname"},ht=["placeholder"],_t={class:"form-group"},gt={for:"country"},ft={class:"form-group"},yt={for:"address1"},wt=["placeholder"],Ct={class:"form-group"},bt={for:"address2"},Pt=["placeholder"],kt={class:"form-group"},Dt={for:"city"},St=["placeholder"],It={key:0,class:"city-shipping-info"},$t={class:"form-row"},Et={class:"form-group"},Ot={for:"state"},Ut={value:""},Tt=["value"],At={class:"form-group"},Nt={for:"zipcode"},Wt=["placeholder"],Ft={class:"form-group"},Mt={for:"phone"},Lt={class:"phone-input"},Vt=["value"],Gt=["placeholder"],Rt={class:"form-group"},Ht={for:"additional"},qt=["placeholder"],Kt={class:"form-group"},Yt={for:"username"},zt={class:"username-search-container"},Bt=["placeholder"],Jt={key:0,class:"username-search-results"},jt=["onMousedown"],xt=["src","alt"],Qt={class:"search-user-info"},Xt={class:"search-username"},Zt={key:0,class:"search-crush-label"},ea={class:"gift-field-description"},ta={class:"form-group"},aa={for:"note"},oa=["placeholder"],sa={class:"form-group payment-button-section"},ra={key:0},la={key:0,class:"payment-disabled-message"},na={key:1,class:"wompi-widget-wrapper"},ia=["disabled"],ca={key:0},ua={key:1},da=["disabled"],pa={key:0},ma={key:1},va={key:2,class:"payment-error"},ha={key:2,id:"paypal-section",class:"paypal-section"},_a={class:"paypal-title"},ga={class:"summary-section"},fa={class:"summary-card"},ya={class:"section-title"},wa={key:0,class:"loading-state"},Ca={key:1,class:"products-list"},ba={class:"product-image"},Pa=["src","alt"],ka={class:"product-details"},Da={class:"product-name"},Sa={key:0,class:"product-meta"},Ia={key:1,class:"product-meta"},$a={key:2,class:"product-meta"},Ea={key:3,class:"product-meta variation-id"},Oa={class:"product-quantity"},Ua={class:"product-price"},Ta={class:"discount-section"},Aa={class:"discount-title"},Na={key:0,class:"discount-input"},Wa=["placeholder","disabled"],Fa=["disabled"],Ma={key:1,class:"discount-applied"},La={class:"discount-applied-content"},Va={class:"discount-code-badge"},Ga={class:"discount-percentage"},Ra={key:2,class:"discount-error"},Ha={class:"totals-section"},qa={class:"total-row"},Ka={class:"subtotal-values"},Ya={key:0,class:"original-subtotal"},za={class:"total-row"},Ba={class:"total-value"},Ja={key:0,class:"shipping-city-note"},ja={key:1,class:"shipping-city-note"},xa={key:0,class:"total-row discount-row"},Qa={class:"discount-label"},Xa={class:"total-value discount-value"},Za={class:"total-row tax-row"},eo={class:"tax-included-badge"},to={class:"total-value tax-included-value"},ao={class:"final-total"},oo={class:"total-row"},so={class:"total-label"},ro={class:"total-amount"},lo={class:"tax-note"},Pe=48500,no={__name:"CheckoutView",setup(ge){const c=Ge(),_=Le(),u=e=>_.formatPrice(e),G=e=>_.currentCurrency==="USD"?Math.round(e/4e3*100)/100:e,I=Ke(),S=Ye(),C=ze(),T=Ve(),l=Be(),A=Je(),{showSuccess:F,showError:h,showLoading:le,closeAlert:ee}=je(),te=xe.getAllCountries().map(e=>({...e,flag:e.flag||"ðŸ³ï¸"})),$=[{code:"CO",dial_code:"+57",flag:"ðŸ‡¨ðŸ‡´",name:"Colombia"}],y=f("me"),s=f({email:"",fullName:"",country:"CO",address1:"",address2:"",city:"",state:"",zipCode:"",phoneCode:"+57",phone:"",additionalDetails:"",username:"",note:""}),R=f(""),d=f(null),z=f(""),ae=f(!1),E=f(""),pe=f(!1),me=f(!1),O=f(null),fe=f(!1),H=f(""),B=f(!1),v=f(null);let q=null;const X=f(null),ne=f(null),Ie=U(()=>Qe.getStatesOfCountry("CO")),$e=U(()=>I.items),ie=U(()=>S.isLoggedIn&&S.username),Ee=U(()=>v.value&&v.value.username?T.locale==="es"?`Nota para @${v.value.username}`:`Note for @${v.value.username}`:T.locale==="es"?"Nota para el destinatario":"Note for recipient"),Oe=async e=>{if(!e||!e.trim()){C.clearSearch();return}try{await C.searchUsers(e.trim(),5)}catch(o){console.error("Error searching users:",o)}},Ue=()=>{setTimeout(()=>{B.value=!1},200)},ye=e=>{console.log("ðŸ‘¤ [SELECT USER] Usuario seleccionado:",e),v.value=e,B.value=!1,C.clearSearch(),q&&(clearTimeout(q),q=null),s.value.username=`@${e.username}`,H.value=`@${e.username}`,console.log("ðŸ’° [SELECT USER] Costo de envÃ­o del usuario:",e.shipping_cost)};re(H,e=>{if(s.value.username=e,q&&clearTimeout(q),!e.trim()){C.clearSearch(),B.value=!1,v.value=null;return}if(v.value&&e===`@${v.value.username}`){console.log("â­ï¸ [WATCH] Usuario ya seleccionado, no buscar de nuevo");return}q=setTimeout(async()=>{await Oe(e),B.value=C.searchResults.length>0},300)}),re(y,e=>{e!=="gift"&&(H.value="",B.value=!1,v.value=null,C.clearSearch())}),re(()=>s.value.username,e=>{y.value==="gift"&&e!==H.value&&(H.value=e)});const Te=async()=>{fe.value=!0;try{console.log(`ðŸ“¦ [DROPSHIPPING] Consultando producto ${Pe}...`);const e=await A.fetchWooProduct(Pe);e.success&&e.data?(O.value=e.data,console.log("âœ… [DROPSHIPPING] Producto cargado:",{id:e.data.id,name:e.data.name,price:e.data.price})):console.error("âŒ [DROPSHIPPING] Error al cargar producto:",e.error)}catch(e){console.error("âŒ [DROPSHIPPING] Error inesperado:",e)}finally{fe.value=!1}},N=U(()=>I.totalPrice),J=U(()=>{if(y.value==="me"){const e=!!(s.value.email&&s.value.fullName&&s.value.address1&&s.value.city&&s.value.state&&s.value.zipCode&&s.value.phone);return e||console.log("ðŸ” [VALIDATION] Campos faltantes:",{email:!!s.value.email,fullName:!!s.value.fullName,address1:!!s.value.address1,city:!!s.value.city,state:!!s.value.state,zipCode:!!s.value.zipCode,phone:!!s.value.phone}),e}return y.value==="gift"?!!(s.value.email&&s.value.username):!1}),Ae=async()=>{var e,o,a,p,b,m,P;E.value="";try{if(console.log("ðŸ“¦ [CHECKOUT] Preparando datos para pago..."),!J.value){E.value="Por favor completa todos los campos obligatorios",await h("Completa todos los campos obligatorios antes de continuar.","âš ï¸ Campos Incompletos");return}if(!I.items||I.items.length===0){E.value="El carrito estÃ¡ vacÃ­o",await h("Tu carrito estÃ¡ vacÃ­o.","ðŸ›’ Carrito VacÃ­o");return}const L=te.find(g=>g.isoCode===s.value.country),oe=L?L.name:s.value.country,x=I.items.map(g=>({woocommerce_product_id:g.product_id||g.id,woocommerce_variation_id:g.variation_id||null,product_name:g.name,quantity:g.quantity,unit_price:_.currentCurrency==="USD"?parseFloat(parseFloat(g.price).toFixed(2)):parseFloat(g.price),attributes:g.attributes||null}));O.value&&(x.push({woocommerce_product_id:O.value.id,woocommerce_variation_id:null,product_name:O.value.name,quantity:1,unit_price:_.currentCurrency==="USD"?parseFloat(parseFloat(O.value.price).toFixed(2)):parseFloat(O.value.price),attributes:null}),console.log("ðŸ“¦ [DROPSHIPPING] Producto agregado a items"));let k;y.value==="gift"?(k={items:x,customer_email:s.value.email,customer_name:ie.value?`${((e=S.user)==null?void 0:e.first_name)||""} ${((o=S.user)==null?void 0:o.last_name)||""}`.trim()||S.username:s.value.email,receiver_username:s.value.username.replace("@",""),gift_message:s.value.note||"",is_gift:!0,shipping:_.currentCurrency==="USD"?parseFloat(Y.value.toFixed(2)):Y.value,subtotal:_.currentCurrency==="USD"?parseFloat(N.value.toFixed(2)):N.value,total:_.currentCurrency==="USD"?parseFloat(j.value.toFixed(2)):j.value,discount_code:d.value?d.value.code:null,is_from_wishlist:!!X.value,wishlist_id:X.value||null,wishlist_name:ne.value||null,shipping_address:((a=v.value)==null?void 0:a.address)||"DirecciÃ³n del destinatario",shipping_city:((p=v.value)==null?void 0:p.city)||"Ciudad",shipping_state:((b=v.value)==null?void 0:b.state)||"Departamento",shipping_postal_code:((m=v.value)==null?void 0:m.postal_code)||"00000",shipping_country:oe,phone_number:((P=v.value)==null?void 0:P.phone)||"+57 300 0000000"},ie.value&&(k.sender_username=S.username)):k={items:x,customer_email:s.value.email,customer_name:s.value.fullName,shipping_address:s.value.address1,shipping_address_line_2:s.value.address2||"",shipping_city:s.value.city,shipping_state:s.value.state,shipping_postal_code:s.value.zipCode,shipping_country:oe,phone_number:`${s.value.phoneCode} ${s.value.phone}`,notes:s.value.additionalDetails||"",shipping:_.currentCurrency==="USD"?parseFloat(Y.value.toFixed(2)):Y.value,subtotal:_.currentCurrency==="USD"?parseFloat(N.value.toFixed(2)):N.value,total:_.currentCurrency==="USD"?parseFloat(j.value.toFixed(2)):j.value,discount_code:d.value?d.value.code:null},console.log("ðŸ“¤ [CHECKOUT] Datos de orden preparados:",k),console.log("ðŸŽŸï¸ [CHECKOUT] discount_code en orderData:",k.discount_code),d.value?console.log("ðŸŽŸï¸ [DISCOUNT] CÃ³digo de descuento incluido en orden:",{code:d.value.code,percentage:d.value.discount_percentage,subtotal_original:k.subtotal,descuento_aplicado:ue.value,total_con_descuento:k.total,shipping:k.shipping,discount_code_enviado:k.discount_code,nota:"Backend validarÃ¡ el descuento usando subtotal + discount_code"}):console.log("â„¹ï¸ [CHECKOUT] No hay cÃ³digo de descuento aplicado"),sessionStorage.setItem("checkout_order_data",JSON.stringify(k)),pe.value=!0,setTimeout(()=>{const g=document.getElementById("paypal-section");g&&g.scrollIntoView({behavior:"smooth",block:"center"})},100)}catch(L){console.error("âŒ [CHECKOUT] Error al preparar datos:",L),E.value="Error al preparar la orden",await h("Error al preparar la orden.","âŒ Error")}},ve=f(null),K=f(!1),Ne=async()=>{var e,o,a,p,b,m,P;E.value="",K.value=!0;try{if(console.log("ðŸ“¦ [CHECKOUT] Preparando datos para Wompi..."),!J.value){E.value="Por favor completa todos los campos obligatorios",await h("Completa todos los campos obligatorios.","âš ï¸ Campos Incompletos"),K.value=!1;return}if(!I.items||I.items.length===0){E.value="El carrito estÃ¡ vacÃ­o",await h("Tu carrito estÃ¡ vacÃ­o.","ðŸ›’ Carrito VacÃ­o"),K.value=!1;return}const L=te.find(V=>V.isoCode===s.value.country),oe=L?L.name:s.value.country,x=I.items.map(V=>({woocommerce_product_id:V.product_id||V.id,woocommerce_variation_id:V.variation_id||null,product_name:V.name,quantity:V.quantity,unit_price:parseFloat(V.price),attributes:V.attributes||null}));O.value&&x.push({woocommerce_product_id:O.value.id,woocommerce_variation_id:null,product_name:O.value.name,quantity:1,unit_price:parseFloat(O.value.price),attributes:null});let k;y.value==="gift"?(k={items:x,customer_email:s.value.email,customer_name:ie.value?`${((e=S.user)==null?void 0:e.first_name)||""} ${((o=S.user)==null?void 0:o.last_name)||""}`.trim()||S.username:s.value.email,receiver_username:s.value.username.replace("@",""),gift_message:s.value.note||"",is_gift:!0,shipping:Y.value,subtotal:N.value,total:j.value,discount_code:d.value?d.value.code:null,is_from_wishlist:!!X.value,wishlist_id:X.value||null,wishlist_name:ne.value||null,shipping_address:((a=v.value)==null?void 0:a.address)||"DirecciÃ³n del destinatario",shipping_city:((p=v.value)==null?void 0:p.city)||"Ciudad",shipping_state:((b=v.value)==null?void 0:b.state)||"Departamento",shipping_postal_code:((m=v.value)==null?void 0:m.postal_code)||"00000",shipping_country:oe,phone_number:((P=v.value)==null?void 0:P.phone)||"+57 300 0000000"},ie.value&&(k.sender_username=S.username)):k={items:x,customer_email:s.value.email,customer_name:s.value.fullName,shipping_address:s.value.address1,shipping_city:s.value.city,shipping_state:s.value.state,shipping_postal_code:s.value.postalCode,shipping_country:oe,phone_number:`${s.value.phoneCode}${s.value.phone}`,shipping:Y.value,subtotal:N.value,total:j.value,notes:s.value.note||"",discount_code:d.value?d.value.code:null},console.log("ðŸ’³ [WOMPI] Creando transacciÃ³n...",k);const g=await l.createWompiTransaction(k);if(!g.success){E.value=g.error||"Error al preparar pago con Wompi",await h(E.value,"âŒ Error en Wompi"),K.value=!1;return}console.log("âœ… [WOMPI] Widget data recibida:",g.data),localStorage.setItem("wompi_reference",g.data.reference),localStorage.setItem("wompi_order_data",JSON.stringify(k)),localStorage.setItem("wompi_widget_data",JSON.stringify(g.data.widget_data)),ve.value=g.data.widget_data,K.value=!1}catch(L){console.error("âŒ [WOMPI] Error inesperado:",L),E.value="Error al procesar el pago con Wompi",await h(E.value,"âŒ Error"),K.value=!1}},We=async()=>new Promise(async(e,o)=>{if(window.paypal){console.log("ðŸ’³ [PAYPAL] SDK ya estÃ¡ cargado"),me.value=!0,e();return}const a=document.querySelector('script[src*="paypal.com/sdk/js"]');if(a){a.addEventListener("load",()=>{console.log("ðŸ’³ [PAYPAL] SDK cargado desde script existente"),me.value=!0,e()});return}console.log("ðŸ’³ [PAYPAL] Cargando SDK...");const p="AXOC4gQsXk_e8NhrrZRorJzU3rld7lOJP5_2S8RYDKUgjkDT-2wfc-1Eu1AqYQseWTcJA_VBEnGUUGCQ",b=_.currentCurrency;console.log("ðŸ’³ [PAYPAL] Client ID:",p),console.log("ðŸ’³ [PAYPAL] Currency:",b);const m=document.createElement("script");m.src=`https://www.paypal.com/sdk/js?client-id=${p}&currency=${b}&components=buttons`,m.setAttribute("data-sdk-integration-source","developer-studio"),m.onload=()=>{console.log("âœ… [PAYPAL] SDK cargado exitosamente"),me.value=!0,e()},m.onerror=P=>{console.error("âŒ [PAYPAL] Error al cargar SDK:",P),o(P)},document.head.appendChild(m)}),Fe=()=>{if(!window.paypal){console.error("âŒ [PAYPAL] SDK no estÃ¡ disponible");return}const e=document.getElementById("paypal-button-container");if(!e){console.error("âŒ [PAYPAL] Contenedor no encontrado");return}e.innerHTML="";const o=sessionStorage.getItem("checkout_order_data");if(!o){console.error("âŒ [PAYPAL] No hay datos de orden");return}const a=JSON.parse(o);window.paypal.Buttons({style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal"},createOrder:async(p,b)=>{console.log("ðŸ’³ [PAYPAL] Creando orden...");try{if(a.is_gift){const P=await l.sendGift(a);if(!P.success)throw new Error(P.error);return P.paypal_order_id}const m=await l.createPayPalOrder(a);if(!m.success)throw new Error(m.error);return m.paypal_order_id}catch(m){throw console.error("âŒ [PAYPAL] Error al crear orden:",m),await h(m.message||"Error al crear orden","âŒ Error"),m}},onApprove:async(p,b)=>{console.log("âœ… [PAYPAL] Pago aprobado");try{le("Procesando tu pago...","ðŸ’³ Procesando");const m={paypal_order_id:p.orderID,...a},P=await l.capturePayPalOrder(p.orderID,m);if(ee(),!P.success)throw new Error(P.error);console.log("âœ… [PAYPAL] Pago procesado exitosamente"),await F(`Tu orden ha sido creada exitosamente.

ðŸ“‹ Orden: ${P.order.order_number}
ðŸ’° Total: $${P.order.total}

RecibirÃ¡s un email de confirmaciÃ³n pronto.`,"ðŸŽ‰ Â¡Pago Exitoso!",{timer:8e3}),sessionStorage.removeItem("checkout_order_data"),I.clearCart(),l.clearPaymentState(),setTimeout(()=>{c.push({name:`Home-${T.locale}`})},1e3)}catch(m){console.error("âŒ [PAYPAL] Error al capturar pago:",m),ee(),await h(m.message||"Error al procesar el pago","âŒ Error")}},onCancel:p=>{console.log("âš ï¸ [PAYPAL] Pago cancelado"),h("Has cancelado el proceso de pago.","âš ï¸ Pago Cancelado",{timer:5e3})},onError:p=>{console.error("âŒ [PAYPAL] Error:",p),h("Hubo un error con PayPal. Por favor intenta de nuevo.","âŒ Error en PayPal")}}).render("#paypal-button-container")},we=async()=>{var e,o;if(!R.value||!R.value.trim()){z.value="Por favor ingresa un cÃ³digo de descuento";return}ae.value=!0,z.value="";try{console.log("ðŸŽŸï¸ [DISCOUNT] Validando cÃ³digo:",R.value);const a=await l.validateDiscountCode(R.value.trim().toUpperCase());console.log("ðŸŽŸï¸ [DISCOUNT] Respuesta:",a),a.success&&a.data.exists&&a.data.is_valid?(d.value={code:a.data.code,discount_percentage:parseFloat(a.data.discount_percentage)},await F(`Â¡CÃ³digo aplicado! Descuento del ${a.data.discount_percentage}%`,"ðŸŽ‰ Descuento Aplicado"),console.log("âœ… [DISCOUNT] Descuento aplicado:",d.value)):(d.value=null,z.value=((e=a.data)==null?void 0:e.message)||a.error||"CÃ³digo de descuento no vÃ¡lido",await h(((o=a.data)==null?void 0:o.message)||a.error||"El cÃ³digo ingresado no es vÃ¡lido o ha expirado","âŒ CÃ³digo InvÃ¡lido"))}catch(a){console.error("âŒ [DISCOUNT] Error al validar:",a),d.value=null,z.value="Error al validar el cÃ³digo",await h("Hubo un error al validar el cÃ³digo. Por favor intenta de nuevo.","âŒ Error")}finally{ae.value=!1}},Me=()=>{d.value=null,R.value="",z.value="",console.log("ðŸ—‘ï¸ [DISCOUNT] Descuento removido")},Y=U(()=>{if(y.value==="gift"&&v.value&&v.value.shipping_cost){const o=parseFloat(v.value.shipping_cost),a=G(o);return console.log(`ðŸ“¦ [SHIPPING] Costo del usuario destinatario: ${o} COP â†’ ${a} ${_.currentCurrency}`),a}const e=(s.value.city||"").toLowerCase().trim();if(!e)return G(15e3);switch(e){case"medellÃ­n":case"medellin":return G(10500);case"san andrÃ©s isla":case"san andres isla":case"san andrÃ©s":case"san andres":case"santa catalina":case"providencia":return G(45e3);default:return G(15e3)}}),ce=U(()=>{let e=Y.value;if(O.value&&O.value.price){const o=parseFloat(O.value.price);e+=o,console.log(`ðŸ“¦ [DROPSHIPPING] Shipping mostrado: ${Y.value} + ${o} = ${e}`)}return e}),he=U(()=>de.value*(.19/1.19)),ue=U(()=>{if(!d.value)return 0;const e=N.value*d.value.discount_percentage/100;return console.log("ðŸŽŸï¸ [DISCOUNT] Monto calculado:",{subtotal:N.value,percentage:d.value.discount_percentage,discount:e}),e}),de=U(()=>N.value-ue.value),j=U(()=>{const e=de.value+ce.value;return console.log("ðŸ’° [TOTAL] CÃ¡lculo:",{subtotal:N.value,discount:ue.value,subtotal_after_discount:de.value,shipping:ce.value,tax_included:he.value,total:e}),e});return ke(async()=>{if(I.loadCart(),I.isEmpty){c.push({name:`Cart-${T.locale}`});return}const e=c.currentRoute.value;if(e.query.giftMode==="true"){if(y.value="gift",e.query.username){const o=e.query.username,a=o.startsWith("@")?o:`@${o}`;s.value.username=a,H.value=a;try{const p=o.replace("@","").trim();if(console.log("ðŸ” [CHECKOUT] Buscando usuario automÃ¡ticamente:",p),await C.searchUsers(p,5),C.searchResults.length>0){const b=C.searchResults.find(m=>m.username.toLowerCase()===p.toLowerCase());b?(console.log("âœ… [CHECKOUT] Usuario encontrado automÃ¡ticamente:",b),ye(b)):console.warn("âš ï¸ [CHECKOUT] No se encontrÃ³ coincidencia exacta para:",p)}else console.warn("âš ï¸ [CHECKOUT] No se encontraron resultados para:",p)}catch(p){console.error("âŒ [CHECKOUT] Error al buscar usuario automÃ¡ticamente:",p)}}e.query.wishlistId&&(X.value=parseInt(e.query.wishlistId),ne.value=e.query.wishlistName||null,console.log("ðŸŽ [WISHLIST] Compra desde wishlist:",{id:X.value,name:ne.value}))}await Te()}),re(pe,async e=>{if(e&&_.currentCurrency==="USD")try{await We(),setTimeout(()=>{Fe()},100)}catch(o){console.error("âŒ [PAYPAL] Error al inicializar:",o),await h("No se pudo cargar PayPal.","âŒ Error")}}),De(()=>{q&&clearTimeout(q),v.value=null,C.clearSearch()}),(e,o)=>(i(),n("div",tt,[t("div",at,[t("div",ot,[t("div",st,[t("h2",rt,r(e.$t("cart.checkout.shippingInformation")),1),t("div",lt,[t("label",nt,[D(t("input",{type:"radio",name:"shipping-type",value:"me","onUpdate:modelValue":o[0]||(o[0]=a=>y.value=a),checked:""},null,512),[[Ce,y.value]]),t("span",null,r(e.$t("cart.checkout.shippingType.forMe")),1)]),t("label",it,[D(t("input",{type:"radio",name:"shipping-type",value:"gift","onUpdate:modelValue":o[1]||(o[1]=a=>y.value=a)},null,512),[[Ce,y.value]]),t("span",null,r(e.$t("cart.checkout.shippingType.forGift")),1)])]),t("div",ct,[t("label",ut,[M(r(y.value==="gift"?e.$t("cart.checkout.form.emailGift"):e.$t("cart.checkout.form.email"))+" ",1),o[17]||(o[17]=t("span",{class:"text-red-500"},"*",-1))]),D(t("input",{type:"email",id:"email","onUpdate:modelValue":o[2]||(o[2]=a=>s.value.email=a),placeholder:y.value==="gift"?e.$t("cart.checkout.form.placeholders.emailGift"):e.$t("cart.checkout.form.placeholders.email"),class:"form-input",required:""},null,8,dt),[[W,s.value.email]]),y.value==="gift"?(i(),n("p",pt,r(e.$t("cart.checkout.form.help.emailGift")),1)):w("",!0)]),y.value==="me"?(i(),n(Q,{key:0},[t("div",mt,[t("label",vt,[M(r(e.$t("cart.checkout.form.fullName"))+" ",1),o[18]||(o[18]=t("span",{class:"text-red-500"},"*",-1))]),D(t("input",{type:"text",id:"fullname","onUpdate:modelValue":o[3]||(o[3]=a=>s.value.fullName=a),placeholder:e.$t("cart.checkout.form.placeholders.fullName"),class:"form-input",required:""},null,8,ht),[[W,s.value.fullName]])]),t("div",_t,[t("label",gt,r(e.$t("cart.checkout.form.country")),1),D(t("select",{id:"country","onUpdate:modelValue":o[4]||(o[4]=a=>s.value.country=a),class:"form-input form-select",disabled:""},[...o[19]||(o[19]=[t("option",{value:"CO"},"ðŸ‡¨ðŸ‡´ Colombia",-1)])],512),[[_e,s.value.country]])]),t("div",ft,[t("label",yt,[M(r(e.$t("cart.checkout.form.address1"))+" ",1),o[20]||(o[20]=t("span",{class:"text-red-500"},"*",-1))]),D(t("input",{type:"text",id:"address1","onUpdate:modelValue":o[5]||(o[5]=a=>s.value.address1=a),placeholder:e.$t("cart.checkout.form.placeholders.address1"),class:"form-input",required:""},null,8,wt),[[W,s.value.address1]])]),t("div",Ct,[t("label",bt,r(e.$t("cart.checkout.form.address2")),1),D(t("input",{type:"text",id:"address2","onUpdate:modelValue":o[6]||(o[6]=a=>s.value.address2=a),placeholder:e.$t("cart.checkout.form.placeholders.address2"),class:"form-input"},null,8,Pt),[[W,s.value.address2]])]),t("div",kt,[t("label",Dt,[M(r(e.$t("cart.checkout.form.city"))+" ",1),o[21]||(o[21]=t("span",{class:"text-red-500"},"*",-1))]),D(t("input",{type:"text",id:"city","onUpdate:modelValue":o[7]||(o[7]=a=>s.value.city=a),placeholder:e.$t("cart.checkout.form.placeholders.city"),class:"form-input",required:"",list:"colombia-cities"},null,8,St),[[W,s.value.city]]),o[22]||(o[22]=Re('<datalist id="colombia-cities" data-v-3ea573a2><option value="MedellÃ­n" data-v-3ea573a2></option><option value="BogotÃ¡" data-v-3ea573a2></option><option value="Cali" data-v-3ea573a2></option><option value="Barranquilla" data-v-3ea573a2></option><option value="Cartagena" data-v-3ea573a2></option><option value="San AndrÃ©s Isla" data-v-3ea573a2></option><option value="Santa Catalina" data-v-3ea573a2></option><option value="Providencia" data-v-3ea573a2></option><option value="Bucaramanga" data-v-3ea573a2></option><option value="Pereira" data-v-3ea573a2></option><option value="Manizales" data-v-3ea573a2></option><option value="IbaguÃ©" data-v-3ea573a2></option><option value="Villavicencio" data-v-3ea573a2></option><option value="Pasto" data-v-3ea573a2></option><option value="Neiva" data-v-3ea573a2></option></datalist>',1)),s.value.city?(i(),n("p",It,[t("span",null,r(e.$t("cart.checkout.form.shippingCost",{cost:u(ce.value)})),1)])):w("",!0)]),t("div",$t,[t("div",Et,[t("label",Ot,[M(r(e.$t("cart.checkout.form.state"))+" ",1),o[23]||(o[23]=t("span",{class:"text-red-500"},"*",-1))]),D(t("select",{id:"state","onUpdate:modelValue":o[8]||(o[8]=a=>s.value.state=a),class:"form-input form-select",required:""},[t("option",Ut,r(e.$t("cart.checkout.form.placeholders.selectState")),1),(i(!0),n(Q,null,se(Ie.value,a=>(i(),n("option",{key:a.isoCode,value:a.name},r(a.name),9,Tt))),128))],512),[[_e,s.value.state]])]),t("div",At,[t("label",Nt,[M(r(e.$t("cart.checkout.form.zipCode"))+" ",1),o[24]||(o[24]=t("span",{class:"text-red-500"},"*",-1))]),D(t("input",{type:"text",id:"zipcode","onUpdate:modelValue":o[9]||(o[9]=a=>s.value.zipCode=a),placeholder:e.$t("cart.checkout.form.placeholders.zipCode"),class:"form-input",required:""},null,8,Wt),[[W,s.value.zipCode]])])]),t("div",Ft,[t("label",Mt,[M(r(e.$t("cart.checkout.form.phone"))+" ",1),o[25]||(o[25]=t("span",{class:"text-red-500"},"*",-1))]),t("div",Lt,[D(t("select",{"onUpdate:modelValue":o[10]||(o[10]=a=>s.value.phoneCode=a),class:"phone-code",disabled:""},[(i(),n(Q,null,se($,a=>t("option",{key:a.code,value:a.dial_code},r(a.flag)+" "+r(a.dial_code),9,Vt)),64))],512),[[_e,s.value.phoneCode]]),D(t("input",{type:"tel",id:"phone","onUpdate:modelValue":o[11]||(o[11]=a=>s.value.phone=a),placeholder:e.$t("cart.checkout.form.placeholders.phone"),class:"form-input phone-number",required:""},null,8,Gt),[[W,s.value.phone]])])]),t("div",Rt,[t("label",Ht,r(e.$t("cart.checkout.form.additionalDetails")),1),D(t("textarea",{id:"additional","onUpdate:modelValue":o[12]||(o[12]=a=>s.value.additionalDetails=a),placeholder:e.$t("cart.checkout.form.placeholders.additionalDetails"),class:"form-textarea",rows:"3"},null,8,qt),[[W,s.value.additionalDetails]])])],64)):w("",!0),y.value==="gift"?(i(),n(Q,{key:1},[t("div",Kt,[t("label",Yt,[M(r(e.$t("cart.checkout.form.recipientUsername"))+" ",1),o[26]||(o[26]=t("span",{class:"text-red-500"},"*",-1))]),t("div",zt,[D(t("input",{type:"text",id:"username","onUpdate:modelValue":o[13]||(o[13]=a=>H.value=a),placeholder:e.$t("cart.checkout.form.placeholders.searchUser"),class:"form-input username-search-input",autocomplete:"off",onFocus:o[14]||(o[14]=a=>B.value=Z(C).searchResults.length>0),onBlur:Ue},null,40,Bt),[[W,H.value]]),B.value&&Z(C).searchResults.length>0?(i(),n("div",Jt,[(i(!0),n(Q,null,se(Z(C).searchResults,a=>(i(),n("div",{key:a.id,class:"username-search-item",onMousedown:p=>ye(a)},[t("img",{src:a.profile_picture||"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=40",alt:a.username,class:"search-avatar"},null,8,xt),t("div",Qt,[t("span",Xt,"@"+r(a.username),1),a.is_crush?(i(),n("span",Zt,"Crush")):w("",!0)])],40,jt))),128))])):w("",!0)]),t("p",ea,r(e.$t("cart.checkout.form.help.recipientUsername")),1)]),t("div",ta,[t("label",aa,r(Ee.value),1),D(t("textarea",{id:"note","onUpdate:modelValue":o[15]||(o[15]=a=>s.value.note=a),placeholder:e.$t("cart.checkout.form.placeholders.giftNote"),class:"form-textarea",rows:"3"},null,8,oa),[[W,s.value.note]])])],64)):w("",!0),t("div",sa,[Z(_).currentCurrency==="COP"?(i(),n("div",ra,[J.value?ve.value?(i(),n("div",na,[He(et,{"widget-data":ve.value,"render-mode":"button"},null,8,["widget-data"])])):(i(),n("button",{key:2,onClick:Ne,disabled:!J.value||K.value,class:"payment-btn"},[K.value?(i(),n("span",ca,r(e.$t("cart.checkout.form.buttons.preparing")||"Preparando..."),1)):(i(),n("span",ua,"ðŸ’³ "+r(e.$t("cart.checkout.form.buttons.payWithWompi")),1))],8,ia)):(i(),n("div",la,[t("p",null,r(e.$t("cart.checkout.form.buttons.completeRequired")),1)]))])):(i(),n("button",{key:1,onClick:Ae,disabled:!J.value,class:be(["payment-btn",{"payment-btn-disabled":!J.value}])},[J.value?(i(),n("span",ma,r(e.$t("cart.checkout.form.buttons.continueToPay")),1)):(i(),n("span",pa,r(e.$t("cart.checkout.form.buttons.completeRequired")),1))],10,da)),E.value?(i(),n("p",va,r(E.value),1)):w("",!0)]),pe.value&&Z(_).currentCurrency==="USD"?(i(),n("div",ha,[t("h3",_a,r(e.$t("cart.checkout.form.paypal.title")),1),o[27]||(o[27]=t("div",{id:"paypal-button-container"},null,-1))])):w("",!0)])]),t("div",ga,[t("div",fa,[t("h2",ya,r(e.$t("cart.checkout.form.orderSummary")),1),Z(I).isUpdating?(i(),n("div",wa,[t("p",null,r(e.$t("cart.checkout.form.loadingProducts")),1)])):(i(),n("div",Ca,[(i(!0),n(Q,null,se($e.value,a=>(i(),n("div",{key:a.id,class:"product-item"},[t("div",ba,[t("img",{src:a.image||"https://images.unsplash.com/photo-1560769629-975ec94e6a86?w=200",alt:a.name||"Product"},null,8,Pa)]),t("div",ka,[t("h4",Da,r(a.name||"Product"),1),a.color?(i(),n("p",Sa,r(e.$t("cart.checkout.form.color"))+": "+r(a.color),1)):w("",!0),a.size?(i(),n("p",Ia,r(e.$t("cart.checkout.form.size"))+": "+r(a.size),1)):w("",!0),a.attributes&&Object.keys(a.attributes).length>0?(i(),n("p",$a,[(i(!0),n(Q,null,se(a.attributes,(p,b)=>(i(),n("span",{key:b},r(b)+": "+r(p),1))),128))])):w("",!0),a.variation_id?(i(),n("p",Ea,r(e.$t("cart.checkout.form.variation"))+": #"+r(a.variation_id),1)):w("",!0)]),t("div",Oa,[t("span",null,r(a.quantity),1)]),t("div",Ua,r(u(a.price*a.quantity)),1)]))),128))])),t("div",Ta,[t("h3",Aa,r(e.$t("cart.checkout.form.discountCode")),1),d.value?w("",!0):(i(),n("div",Na,[D(t("input",{type:"text","onUpdate:modelValue":o[16]||(o[16]=a=>R.value=a),placeholder:e.$t("cart.checkout.form.placeholders.discountCode"),class:"form-input",disabled:ae.value,onKeyup:qe(we,["enter"])},null,40,Wa),[[W,R.value]]),t("button",{onClick:we,disabled:ae.value||!R.value.trim(),class:"validate-btn"},r(ae.value?e.$t("cart.checkout.form.buttons.validating"):e.$t("cart.checkout.form.buttons.validate")),9,Fa)])),d.value?(i(),n("div",Ma,[t("div",La,[t("span",Va,r(d.value.code),1),t("span",Ga,"-"+r(d.value.discount_percentage)+"%",1)]),t("button",{onClick:Me,class:"remove-discount-btn",title:"Remover descuento"}," âœ• ")])):w("",!0),z.value&&!d.value?(i(),n("p",Ra,r(z.value),1)):w("",!0)]),t("div",Ha,[t("div",qa,[t("span",null,r(e.$t("cart.checkout.form.subtotal")),1),t("div",Ka,[d.value?(i(),n("span",Ya,r(u(N.value)),1)):w("",!0),t("span",{class:be(["total-value",{"discounted-subtotal":d.value}])},r(u(de.value)),3)])]),t("div",za,[t("span",null,r(e.$t("cart.checkout.form.shipping")),1),t("span",Ba,[M(r(u(ce.value))+" ",1),y.value==="gift"&&v.value?(i(),n("span",Ja," ("+r(v.value.username)+") ",1)):s.value.city?(i(),n("span",ja," ("+r(s.value.city)+") ",1)):w("",!0)])]),d.value?(i(),n("div",xa,[t("span",Qa,r(e.$t("cart.checkout.form.discountApplied",{code:d.value.code,percentage:d.value.discount_percentage})),1),t("span",Xa,"-"+r(u(ue.value)),1)])):w("",!0),t("div",Za,[t("span",null,[M(r(e.$t("cart.checkout.form.tax"))+" ",1),t("span",eo,r(e.$t("cart.checkout.form.taxIncludedBadge")),1)]),t("span",to,r(u(he.value)),1)])]),t("div",ao,[t("div",oo,[t("span",so,r(e.$t("cart.checkout.form.total")),1),t("span",ro,r(u(j.value)),1)]),t("p",lo,r(e.$t("cart.checkout.form.taxIncluded",{tax:u(he.value)})),1)])])])])]))}},yo=Se(no,[["__scopeId","data-v-3ea573a2"]]);export{yo as default};
