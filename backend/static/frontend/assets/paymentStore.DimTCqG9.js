import{I as N,r as v,l as w,M as h,L as g}from"./index.5R5gWBkF.js";const q=N("payment",()=>{const _=v(null),P=v(null),y=v(null),f=v(null),p=v(!1),d=v(!1),a=v(null),O=w(()=>_.value!==null),E=w(()=>f.value==="COMPLETED"),W=w(()=>{var t;return((t=_.value)==null?void 0:t.client_id)||null});async function M(){var t,o;p.value=!0,a.value=null;try{const e=await h("orders/paypal/config/");return _.value={client_id:e.data.client_id,currency:e.data.currency,mode:e.data.mode},{success:!0,data:_.value}}catch(e){return a.value=((o=(t=e.response)==null?void 0:t.data)==null?void 0:o.error)||"Failed to fetch PayPal configuration",{success:!1,error:a.value}}finally{p.value=!1}}async function F(t){var o,e,r,n;d.value=!0,a.value=null;try{const s=await g("orders/paypal/create/",t),l={paypal_order_id:s.data.paypal_order_id,total:s.data.total,items_count:s.data.items_count};return y.value=l,{success:!0,data:l,paypal_order_id:l.paypal_order_id}}catch(s){return a.value=((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.error)||"Failed to create PayPal order",{success:!1,error:a.value,details:(n=(r=s.response)==null?void 0:r.data)==null?void 0:n.details}}finally{d.value=!1}}async function I(t,o){var e,r,n,s,l,u;d.value=!0,a.value=null;try{const c=await g("orders/paypal/capture/",o),i={order:c.data.order,payment:c.data.payment,woocommerce_integration:c.data.woocommerce_integration};return y.value=i.order,f.value=i.payment.status,{success:!0,data:i,order:i.order,payment:i.payment}}catch(c){return a.value=((r=(e=c.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to capture PayPal payment",{success:!1,error:a.value,details:(s=(n=c.response)==null?void 0:n.data)==null?void 0:s.details,paypal_status:(u=(l=c.response)==null?void 0:l.data)==null?void 0:u.paypal_status}}finally{d.value=!1}}async function T(t){var o,e,r,n,s,l;d.value=!0,a.value=null;try{console.log("üéÅ [GIFT] Enviando regalo:",t);const u=await g("orders/gifts/send/",t);return console.log("‚úÖ [GIFT] Regalo enviado exitosamente:",u.data),{success:!0,data:u.data,paypal_order_id:u.data.paypal_order_id,receiver_info:u.data.receiver_info}}catch(u){return console.error("‚ùå [GIFT] Error enviando regalo:",u),{success:!1,error:((e=(o=u.response)==null?void 0:o.data)==null?void 0:e.error)||"Failed to send gift",details:(n=(r=u.response)==null?void 0:r.data)==null?void 0:n.missing_fields,user_info:(l=(s=u.response)==null?void 0:s.data)==null?void 0:l.user_info}}finally{d.value=!1}}async function C(){var t,o;p.value=!0,a.value=null;try{const e=await h("orders/wompi/config/");return P.value={public_key:e.data.public_key,currency:e.data.currency,environment:e.data.environment},{success:!0,data:P.value}}catch(e){return a.value=((o=(t=e.response)==null?void 0:t.data)==null?void 0:o.error)||"Failed to fetch Wompi configuration",{success:!1,error:a.value}}finally{p.value=!1}}async function S(t){var o,e,r,n;d.value=!0,a.value=null;try{console.log("üí≥ [WOMPI] Preparando widget de pago...",t);const s=await g("orders/wompi/create/",t),l={widget_data:s.data.widget_data,reference:s.data.reference,total:s.data.total,amount_in_cents:s.data.amount_in_cents,items_count:s.data.items_count};return y.value=l,console.log("‚úÖ [WOMPI] Widget data recibida:",l),{success:!0,data:l}}catch(s){return console.error("‚ùå [WOMPI] Error preparando widget:",s),a.value=((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.error)||"Failed to prepare Wompi widget",{success:!1,error:a.value,details:(n=(r=s.response)==null?void 0:r.data)==null?void 0:n.details}}finally{d.value=!1}}async function R(t){var o,e;try{const r=await h(`orders/wompi/status/${t}/`);return{status:r.data.status,order_id:r.data.order_id,transaction_id:r.data.transaction_id,error:r.data.error,message:r.data.message}}catch(r){return console.error("‚ùå [WOMPI] Error verificando estado:",r),{status:"error",error:((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.error)||"Failed to check payment status"}}}async function k(t,o){var e,r,n,s,l,u;d.value=!0,a.value=null;try{console.log("‚úÖ [WOMPI] Confirmando pago...",{transactionId:t,confirmData:o});const c={transaction_id:t,...o},i=await g("orders/wompi/confirm/",c),m={order:i.data.order,payment:i.data.payment,woocommerce_integration:i.data.woocommerce_integration};return y.value=m.order,f.value=m.payment.status,console.log("‚úÖ [WOMPI] Pago confirmado:",m),{success:!0,data:m,order:m.order,payment:m.payment}}catch(c){return console.error("‚ùå [WOMPI] Error confirmando pago:",c),a.value=((r=(e=c.response)==null?void 0:e.data)==null?void 0:r.error)||"Failed to confirm Wompi payment",{success:!1,error:a.value,details:(s=(n=c.response)==null?void 0:n.data)==null?void 0:s.details,status:(u=(l=c.response)==null?void 0:l.data)==null?void 0:u.status}}finally{d.value=!1}}function G(){y.value=null,f.value=null,a.value=null}function L(){a.value=null}async function b(t){var o,e,r;p.value=!0,a.value=null;try{console.log("üéüÔ∏è [PAYMENT STORE] Validando c√≥digo de descuento:",t);const n=await g("discounts/validate/",{code:t});return console.log("üéüÔ∏è [PAYMENT STORE] Respuesta de validaci√≥n:",n.data),{success:!0,data:n.data}}catch(n){return console.error("‚ùå [PAYMENT STORE] Error validando c√≥digo:",n),a.value=((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.error)||"Failed to validate discount code",{success:!1,error:a.value,data:(r=n.response)==null?void 0:r.data}}finally{p.value=!1}}function A(){return{hasConfig:O.value,isLoading:p.value,isProcessing:d.value,currentOrder:y.value,paymentStatus:f.value,error:a.value}}return{paypalConfig:_,wompiConfig:P,currentOrder:y,paymentStatus:f,isLoading:p,isProcessing:d,error:a,hasPayPalConfig:O,isPaymentComplete:E,paypalClientId:W,fetchPayPalConfig:M,createPayPalOrder:F,capturePayPalOrder:I,sendGift:T,fetchWompiConfig:C,createWompiTransaction:S,checkWompiPaymentStatus:R,confirmWompiPayment:k,validateDiscountCode:b,clearPaymentState:G,clearError:L,getPaymentState:A}});export{q as u};
