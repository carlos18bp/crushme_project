import{s as K,u as N,r as k,x as P,l as D,o as U,a as j,c as d,b as f,d as i,f as z,t as v,y as H,F as Z,i as G,e as J,C as O,m as Q,p as W,z as X}from"../index.js";import{u as Y}from"./authStore-DVIAn0uN.js";import{u as x}from"./useAlert-BgI_2DEv.js";import{L as ee}from"./LanguageSelector-Cde5xz4W.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";const oe={class:"verification-view"},se={class:"verification-container"},ie={class:"verification-card"},re={class:"welcome-section"},ae={class:"welcome-title"},ne={class:"welcome-subtitle"},ce={class:"code-input-container"},le=["onUpdate:modelValue","placeholder","onInput","onKeydown"],ue=["disabled"],de={key:0},fe={key:1,class:"loading-spinner"},ve={class:"resend-section"},pe={class:"resend-text"},me=["disabled"],he={key:0},_e={key:1},ye={key:2},ge={__name:"VerificationView",setup(we){const E=Q(),y=O(),{t:a}=K(),I=N(),C=Y(),{showError:p,showSuccess:R}=x(),l=k([]),r=P(["","","",""]),g=k(!1),w=k(!1),m=k(0);let b=null;const V=D(()=>r.every(e=>e.length===1)),$=D(()=>r.join("")),B=(e,t)=>{var o;const n=t.target.value;if(!/^\d*$/.test(n)){r[e]="";return}r[e]=n,n&&e<3&&((o=l.value[e+1])==null||o.focus())},S=(e,t)=>{var n,o,s;t.key==="Backspace"&&!r[e]&&e>0&&((n=l.value[e-1])==null||n.focus()),t.key==="ArrowLeft"&&e>0&&((o=l.value[e-1])==null||o.focus()),t.key==="ArrowRight"&&e<3&&((s=l.value[e+1])==null||s.focus())},A=e=>{var _;e.preventDefault(),e.clipboardData.getData("text").replace(/\D/g,"").slice(0,4).split("").forEach((u,c)=>{c<4&&(r[c]=u)});const o=r.findIndex(u=>!u),s=o!==-1?o:3;(_=l.value[s])==null||_.focus()},F=()=>V.value?$.value.length!==4?(p(a("verification.validation.codeLength")),!1):!0:(p(a("verification.validation.codeRequired")),!1),L=async()=>{var e,t,n,o,s,_;g.value=!0;try{if(!F())return;const u=y.query.email||y.params.email,c=await C.verifyEmail({email:u,verification_code:$.value});if(c.success)E.push({path:`/${I.locale}/confirmation`,query:{title:a("verification.success.title"),message:a("verification.success.message"),primaryActionText:a("verification.success.actionButton"),primaryActionRoute:`/${I.locale}/profile`,autoRedirect:"true",redirectDelay:"3",redirectTo:`/${I.locale}/profile`}});else{let h=a("verification.errors.verificationFailed");(e=c.error)!=null&&e.includes("invalid")||(t=c.error)!=null&&t.includes("Invalid")?h=a("verification.errors.invalidCode"):(n=c.error)!=null&&n.includes("expired")||(o=c.error)!=null&&o.includes("Expired")?h=a("verification.errors.codeExpired"):h+=c.error,p(h),r.forEach((be,T)=>{r[T]=""}),(s=l.value[0])==null||s.focus()}}catch(u){console.error("Verification error:",u),p(a("verification.errors.verificationFailed")+(u.message||"Error desconocido")),r.forEach((c,h)=>{r[h]=""}),(_=l.value[0])==null||_.focus()}finally{g.value=!1}},q=async()=>{w.value=!0;try{const e=y.query.email||y.params.email,t=await C.resendVerificationCode(e);t.success?(R(a("verification.resendSuccess")),M()):p(a("verification.errors.resendFailed")+t.error)}catch(e){console.error("Resend error:",e),p(a("verification.errors.resendFailed")+(e.message||"Error desconocido"))}finally{w.value=!1}},M=()=>{m.value=60,b=setInterval(()=>{m.value--,m.value<=0&&clearInterval(b)},1e3)};return U(()=>{var e;(e=l.value[0])==null||e.focus()}),j(()=>{b&&clearInterval(b)}),(e,t)=>(f(),d("div",oe,[t[2]||(t[2]=i("div",{class:"background-container"},[i("div",{class:"background-overlay"})],-1)),z(ee,{position:"absolute",theme:"light"}),i("div",se,[i("div",ie,[i("div",re,[i("h2",ae,v(e.$t("verification.title")),1),i("p",ne,v(e.$t("verification.subtitle")),1)]),i("form",{onSubmit:H(L,["prevent"]),class:"verification-form"},[i("div",ce,[(f(!0),d(Z,null,G(r,(n,o)=>W((f(),d("input",{key:o,ref_for:!0,ref:s=>l.value[o]=s,"onUpdate:modelValue":s=>r[o]=s,type:"text",maxlength:"1",placeholder:e.$t("verification.codePlaceholder"),class:"code-input",onInput:s=>B(o,s),onKeydown:s=>S(o,s),onPaste:t[0]||(t[0]=s=>A(s)),required:""},null,40,le)),[[X,r[o]]])),128))]),i("button",{type:"submit",class:"submit-btn",disabled:g.value||!V.value},[g.value?(f(),d("span",fe,[t[1]||(t[1]=i("svg",{class:"animate-spin",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4","stroke-opacity":"0.25"}),i("path",{d:"M4 12C4 16.4183 7.58172 20 12 20V12H4Z",fill:"currentColor"})],-1)),J(" "+v(e.$t("verification.verifyingButton")),1)])):(f(),d("span",de,v(e.$t("verification.verifyButton")),1))],8,ue)],32),i("div",ve,[i("span",pe,v(e.$t("verification.didntReceive")),1),i("button",{onClick:q,class:"resend-link",disabled:w.value||m.value>0},[m.value>0?(f(),d("span",he,v(m.value)+"s",1)):w.value?(f(),d("span",ye,v(e.$t("verification.resendingButton")),1)):(f(),d("span",_e,v(e.$t("verification.resend")),1))],8,me)])])])]))}},Ee=te(ge,[["__scopeId","data-v-bf849f5b"]]);export{Ee as default};
