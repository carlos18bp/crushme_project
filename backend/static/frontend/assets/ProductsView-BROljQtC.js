import{s as xe,u as be,r as m,l as g,E as K,o as ye,c as i,b as l,f as Q,d as s,t as n,k as x,j as v,F as S,i as L,p as J,z as we,G as _e,H as ke,C as Pe,m as Ce,y as X,q as $e}from"../index.js";import{u as Be}from"./productStore-DGl72RrD.js";import{u as Te}from"./profileStore-B4Vmm1K_.js";import{u as Ie}from"./authStore-DVIAn0uN.js";import{u as Se}from"./cartStore-CDfjOPb9.js";import{P as Le}from"./ProductCard-BlrwzTCL.js";import{N as Ne,F as Me}from"./Footer-BlMTS6Me.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";import"./wishlistStore-BRMRVyY4.js";import"./transition-xy9MWKGA.js";const Ee={class:"products-page"},Fe={class:"main-content bg-pink-50 min-h-screen pt-20"},De={class:"container mx-auto px-4 md:px-5 lg:px-6 pt-20 md:pt-22 lg:pt-24 pb-4 md:pb-5 lg:pb-6"},We={class:"flex flex-col lg:flex-row gap-4 md:gap-6 lg:gap-8 relative z-10"},je={class:"sidebar w-full lg:w-80 flex-shrink-0"},Ge={class:"filters-container bg-white rounded-2xl md:rounded-3xl shadow-sm p-4 md:p-5 lg:p-6 border border-gray-100"},Ue={class:"filters-header mb-4 md:mb-5 lg:mb-6 pb-3 md:pb-4 border-b border-gray-200"},Oe={class:"flex items-center justify-between mb-3 md:mb-0"},ze={class:"text-lg md:text-xl lg:text-2xl font-semibold text-gray-800"},He={key:0,class:"text-center py-3 md:py-4"},Re={class:"text-gray-600 mt-2 text-sm md:text-base"},qe={key:1},Ve={class:"filter-item mb-2 md:mb-3"},Ke={class:"text-gray-700 text-sm md:text-base font-medium"},Qe={key:0,class:"text-brand-pink-dark"},Je=["onClick"],Xe={class:"flex items-center"},Ye={class:"text-gray-800 text-sm md:text-base font-medium"},Ze={class:"text-gray-500 text-xs ml-1.5 md:ml-2"},et={key:0,class:"mt-1.5 md:mt-2 ml-3 md:ml-4 space-y-1.5 md:space-y-2"},tt=["onClick"],st={class:"flex items-center"},ot={class:"text-gray-400 text-xs ml-1.5 md:ml-2"},at={class:"flex items-center"},rt={key:0,class:"text-purple-700 text-xs md:text-sm mr-1.5 md:mr-2"},lt={key:0,class:"ml-3 md:ml-4 mt-1 space-y-1"},nt=["onClick"],it={class:"flex items-center"},dt={class:"text-gray-400 text-xs ml-1.5 md:ml-2"},ut={key:0,class:"text-purple-700 text-xs md:text-sm"},ct={class:"products-section flex-1"},pt={class:"search-bar mb-4 md:mb-6"},mt={class:"relative"},gt={key:0,class:"text-sm text-gray-500 mt-2"},vt={class:"products-header flex flex-col md:flex-row items-start md:items-center justify-between mb-4 md:mb-6 lg:mb-8 gap-3 md:gap-4"},ht={class:"text-xl md:text-2xl lg:text-3xl font-bold text-gray-800 mb-1.5 md:mb-2 flex items-center"},ft={class:"text-sm md:text-base text-gray-600"},xt={class:"sort-section flex items-center w-full md:w-auto"},bt={class:"text-gray-600 mr-2 md:mr-3 text-sm md:text-base"},yt={value:"mostPopular"},wt={value:"priceLowHigh"},_t={value:"priceHighLow"},kt={value:"newest"},Pt={value:"bestRating"},Ct={class:"products-grid"},$t={key:0,class:"text-center py-8 md:py-10 lg:py-12"},Bt={class:"text-gray-600 text-base md:text-lg"},Tt={key:1,class:"text-center py-8 md:py-10 lg:py-12"},It={class:"text-gray-600 text-base md:text-lg mb-3 md:mb-4"},St={key:2,class:"text-center py-8 md:py-10 lg:py-12"},Lt={class:"text-gray-600 text-base md:text-lg"},Nt={key:3,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-5 lg:gap-6"},Mt={key:4,class:"flex justify-center items-center mt-8 md:mt-10 lg:mt-12 space-x-2 md:space-x-4"},At=["disabled"],Et={class:"flex items-center space-x-1 md:space-x-2"},Ft={class:"text-xs md:text-sm text-gray-600"},Dt=["disabled"],Wt={__name:"ProductsView",setup(jt){const{t:Y}=xe(),A=Ce(),E=Pe(),Z=be(),r=Be(),F=Te(),ee=Ie();Se();const u=m(""),d=m(""),h=m(new Set),B=m("mostPopular"),c=m(1),T=m(9),w=m(new Set),_=m(new Set),k=m(!1),b=m(""),I=m(!1),P=m(null),f=m(""),y=m(null),te=g(()=>r.wooThemes),N=g(()=>r.isLoadingWoo),se=g(()=>r.isLoadingWooThemes),D=g(()=>r.wooError);g(()=>r.isWooConnected);const W=g(()=>r.wooStats),j=g(()=>u.value?r.getThemeBySlug(u.value):null),G=g(()=>d.value?r.getCategoryById(d.value):null),oe=g(()=>G.value?G.value.name:j.value?j.value.name:Y("products.title")),M=g(()=>{const o=[...r.wooProducts];switch(B.value){case"mostPopular":return o.sort((t,a)=>(a.total_sales||0)-(t.total_sales||0));case"priceLowHigh":return o.sort((t,a)=>parseFloat(t.price)-parseFloat(a.price));case"priceHighLow":return o.sort((t,a)=>parseFloat(a.price)-parseFloat(t.price));case"newest":return o.sort((t,a)=>new Date(a.date_created)-new Date(t.date_created));case"bestRating":return o.sort((t,a)=>parseFloat(a.average_rating||0)-parseFloat(t.average_rating||0));default:return o}}),C=g(()=>{var e,o;if(f.value&&y.value)return y.value.total_results||0;if(d.value){const t=r.getCategoryById(d.value);return(t==null?void 0:t.count)||0}if(u.value){const t=r.getThemeBySlug(u.value);return(t==null?void 0:t.total_products)||0}return(o=(e=W.value)==null?void 0:e.totals)!=null&&o.products?W.value.totals.products:M.value.length});g(()=>Math.ceil(C.value/T.value));const U=g(()=>M.value),ae=async()=>{var e,o;try{console.log("🚀 Inicializando catálogo...");const t=await r.initializeWooCommerce();t.success?console.log("✅ Catálogo inicializado:",{themes:((e=t.themes)==null?void 0:e.length)||0,products:((o=t.products)==null?void 0:o.length)||0,totalCategories:t.total_categories||0}):console.error("❌ Error inicializando catálogo:",t.error)}catch(t){console.error("Error al inicializar catálogo:",t)}},re=e=>{u.value===e?(u.value="",d.value="",$()):(u.value=e,d.value="",c.value=1,$(),le(e))},le=async e=>{try{const o=await r.fetchProductsByTheme(e,9,1);o.success&&console.log(`✅ Productos de ${e} cargados:`,o.data.length)}catch(o){console.error("Error cargando productos del tema:",o)}},O=async e=>{d.value=e,c.value=1;const o=r.getCategoryById(e);o!=null&&o.has_subcategories&&(h.value.has(e)?h.value.delete(e):h.value.add(e),h.value=new Set(h.value)),$();try{const t=await r.fetchWooProductsByCategory(e,9,1);t.success&&console.log(`✅ Productos de categoría ${e} cargados:`,t.data.length)}catch(t){console.error("Error cargando productos de categoría:",t)}},z=async()=>{u.value="",d.value="",h.value.clear(),c.value=1,r.clearTheme(),r.clearSubcategory(),$(),console.log("🔄 Limpiando filtros, cargando productos generales...");const e=await r.fetchWooProducts({perPage:9,page:1});e.success&&console.log("✅ Productos generales cargados:",e.data.length)},ne=e=>{B.value=e.target.value,c.value=1},H=async e=>{var o;if(!(e<1)){console.log(`📄 PAGINATION DEBUG - Cambiando a página ${e}, productos actuales en store:`,r.wooProducts.length),c.value=e,$();try{if(f.value){console.log(`📄 PAGINATION DEBUG - Cargando página ${e} de búsqueda: "${f.value}"`);const t=await r.searchWooProducts(f.value,e);t.success&&(y.value=t.pagination,P.value=((o=t.pagination)==null?void 0:o.total_results)||t.data.length)}else d.value?(console.log(`📄 PAGINATION DEBUG - Cargando página ${e} de categoría ${d.value}`),await r.fetchWooProductsByCategory(d.value,9,e)):u.value?(console.log(`📄 PAGINATION DEBUG - Cargando página ${e} de tema ${u.value}`),await r.fetchProductsByTheme(u.value,9,e)):(console.log(`📄 PAGINATION DEBUG - Cargando página ${e} de todos los productos`),await r.fetchWooProducts({perPage:9,page:e}));console.log(`📄 PAGINATION DEBUG - Después de cargar página ${e}, productos en store:`,r.wooProducts.length),console.log("📄 PAGINATION DEBUG - IDs de productos cargados:",r.wooProducts.map(t=>{var a;return`${t.id}-${(a=t.name)==null?void 0:a.substring(0,15)}`})),window.scrollTo({top:0,behavior:"smooth"})}catch(t){console.error("Error cambiando de página:",t)}}},ie=e=>{const o=Z.locale;A.push({name:`ProductDetail-${o}`,params:{id:e}})},de=e=>{w.value.has(e)?w.value.delete(e):w.value.add(e),w.value=new Set(w.value)},ue=e=>{_.value.has(e)?_.value.delete(e):_.value.add(e),_.value=new Set(_.value)},ce=e=>w.value.has(e),pe=e=>_.value.has(e),me=e=>F.isProductInFavorites(e),ge=async({productId:e,isFavorited:o})=>{console.log(`Producto ${e} ${o?"agregado a":"eliminado de"} favoritos`)};K(u,e=>{e&&r.selectTheme(e)}),K(d,e=>{e&&r.selectSubcategory(e)});const $=()=>{const e={};u.value&&(e.theme=u.value),d.value&&(e.category=d.value),c.value>1&&(e.page=c.value),A.replace({name:E.name,query:e})},ve=async()=>{const{theme:e,category:o,page:t}=E.query;if(console.log("🔍 Restaurando estado desde URL:",{theme:e,category:o,page:t}),t&&(c.value=parseInt(t)||1),e&&(u.value=e,console.log("🔍 Tema restaurado:",e)),o){const a=parseInt(o);d.value=a,console.log("🔍 Categoría restaurada:",a);const p=await r.fetchWooProductsByCategory(a,9,c.value);p.success&&console.log(`✅ Productos de categoría ${a} cargados (página ${c.value}):`,p.data.length)}else if(e){const a=await r.fetchProductsByTheme(e,9,c.value);a.success&&console.log(`✅ Productos de tema ${e} cargados (página ${c.value}):`,a.data.length)}else if(t){const a=await r.fetchWooProducts({perPage:9,page:c.value});a.success&&console.log(`✅ Productos generales cargados (página ${c.value}):`,a.data.length)}},he=()=>{k.value=!k.value};let R=null;const fe=()=>{clearTimeout(R),R=setTimeout(()=>{b.value.trim().length>=2?q():b.value.trim().length===0&&V()},500)},q=async()=>{var o,t,a;const e=b.value.trim();if(!(e.length<2)){I.value=!0,P.value=null,u.value="",d.value="",c.value=1,console.log("🔍 Buscando productos:",e);try{const p=await r.searchWooProducts(e,1);p.success?(f.value=e,y.value=p.pagination,P.value=((o=p.pagination)==null?void 0:o.total_results)||p.data.length,console.log(`✅ Búsqueda completada: ${((t=p.pagination)==null?void 0:t.total_results)||p.data.length} productos encontrados (página 1 de ${((a=p.pagination)==null?void 0:a.total_pages)||1})`)):(console.error("❌ Error en búsqueda:",p.error),P.value=0,f.value="",y.value=null)}catch(p){console.error("❌ Error inesperado en búsqueda:",p),P.value=0,f.value="",y.value=null}finally{I.value=!1}}},V=async()=>{b.value="",P.value=null,I.value=!1,f.value="",y.value=null,console.log("🔄 Limpiando búsqueda, cargando productos generales..."),await z()};return ye(async()=>{if(await ae(),await ve(),ee.isLoggedIn){console.log("🔄 Cargando IDs de favoritos...");const e=await F.fetchFavoriteProductIds();e.success&&console.log("✅ IDs de favoritos cargados:",e.data.length)}window.innerWidth<1024?k.value=!1:k.value=!0}),(e,o)=>(l(),i("div",Ee,[Q(Ne),s("div",Fe,[s("div",De,[s("div",We,[s("aside",je,[s("div",Ge,[s("div",Ue,[s("div",Oe,[s("h3",ze,n(e.$t("products.filters.title")),1),s("button",{onClick:he,class:"lg:hidden text-gray-600 hover:text-brand-pink-dark transition-colors"},[(l(),i("svg",{class:x(["w-6 h-6 transition-transform",k.value?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[5]||(o[5]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))])])]),s("div",{class:x(["filter-categories",{"hidden lg:block":!k.value}])},[se.value?(l(),i("div",He,[o[6]||(o[6]=s("div",{class:"animate-spin rounded-full h-7 w-7 md:h-8 md:w-8 border-b-2 border-brand-blue-medium mx-auto"},null,-1)),s("p",Re,n(e.$t("products.filters.loadingCategories")),1)])):(l(),i("div",qe,[s("div",Ve,[s("button",{onClick:z,class:x(["filter-button w-full flex items-center justify-between py-2.5 md:py-3 px-2.5 md:px-3 text-left transition-colors rounded-lg",!u.value&&!d.value?"bg-brand-pink-light":"hover:bg-gray-50"])},[s("span",Ke,n(e.$t("products.filters.allProducts")),1),!u.value&&!d.value?(l(),i("span",Qe,"✓")):v("",!0)],2)]),(l(!0),i(S,null,L(te.value,t=>(l(),i("div",{key:t.theme,class:"filter-item mb-2 md:mb-3"},[s("button",{onClick:a=>re(t.theme),class:x(["filter-button w-full flex items-center justify-between py-2.5 md:py-3 px-2.5 md:px-3 text-left transition-colors rounded-lg",u.value===t.theme?"bg-brand-pink-light":"hover:bg-gray-50"])},[s("div",Xe,[s("div",null,[s("span",Ye,n(t.name),1),s("span",Ze,"("+n(t.total_products)+")",1)])]),(l(),i("svg",{class:x(["arrow w-4 h-4 md:w-5 md:h-5 text-gray-400 transition-transform",u.value===t.theme?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[7]||(o[7]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],10,Je),u.value===t.theme?(l(),i("div",et,[(l(!0),i(S,null,L(t.categories,a=>(l(),i("div",{key:a.id},[s("button",{onClick:X(p=>O(a.id),["stop"]),class:x(["w-full flex items-center justify-between py-1.5 md:py-2 px-2.5 md:px-3 text-left transition-colors rounded-lg text-xs md:text-sm",d.value===a.id?"bg-purple-100 text-purple-700":"hover:bg-gray-100"])},[s("div",st,[s("span",null,n(a.name),1),s("span",ot,"("+n(a.count)+")",1)]),s("div",at,[d.value===a.id?(l(),i("span",rt,"✓")):v("",!0),a.has_subcategories?(l(),i("svg",{key:1,class:x(["w-3.5 h-3.5 md:w-4 md:h-4 text-gray-400 transition-transform",h.value.has(a.id)?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[8]||(o[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)):v("",!0)])],10,tt),a.has_subcategories&&h.value.has(a.id)?(l(),i("div",lt,[(l(!0),i(S,null,L(a.subcategories,p=>(l(),i("button",{key:p.id,onClick:X(Gt=>O(p.id),["stop"]),class:x(["w-full flex items-center justify-between py-1.5 md:py-2 px-2.5 md:px-3 text-left transition-colors rounded-lg text-xs md:text-sm",d.value===p.id?"bg-purple-100 text-purple-700":"hover:bg-gray-100"])},[s("div",it,[o[9]||(o[9]=s("span",{class:"text-gray-400 mr-1.5 md:mr-2 text-xs"},"└─",-1)),s("span",null,n(p.name),1),s("span",dt,"("+n(p.count)+")",1)]),d.value===p.id?(l(),i("span",ut,"✓")):v("",!0)],10,nt))),128))])):v("",!0)]))),128))])):v("",!0)]))),128))]))],2)])]),s("main",ct,[s("div",pt,[s("div",mt,[J(s("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>b.value=t),onInput:fe,onKeyup:_e(q,["enter"]),type:"text",placeholder:"Buscar productos...",class:"w-full px-4 py-2.5 md:py-3 pl-11 md:pl-12 pr-10 md:pr-12 border-2 border-gray-200 rounded-xl md:rounded-2xl focus:outline-none focus:border-brand-purple-light focus:ring-2 focus:ring-brand-purple-light focus:ring-opacity-20 transition-all text-sm md:text-base"},null,544),[[we,b.value]]),o[11]||(o[11]=s("svg",{class:"absolute left-3 md:left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 md:w-6 md:h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),b.value?(l(),i("button",{key:0,onClick:V,class:"absolute right-3 md:right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"},[...o[10]||(o[10]=[s("svg",{class:"w-5 h-5 md:w-6 md:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):v("",!0)]),I.value?(l(),i("p",gt,n(e.$t("products.searching")||"Buscando..."),1)):v("",!0)]),s("div",vt,[s("div",null,[s("h1",ht,[s("span",null,n(oe.value),1)]),s("p",ft,n(e.$t("products.header.showing",{start:Math.min((c.value-1)*T.value+1,C.value),end:Math.min(c.value*T.value,C.value),total:C.value})),1)]),s("div",xt,[s("span",bt,n(e.$t("products.header.sortBy")),1),J(s("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>B.value=t),onChange:ne,class:"sort-select bg-white border border-gray-300 rounded px-2.5 md:px-3 py-1.5 md:py-2 text-sm md:text-base text-gray-700 focus:outline-none focus:border-brand-pink-medium flex-1 md:flex-initial"},[s("option",yt,n(e.$t("products.header.sortOptions.mostPopular")),1),s("option",wt,n(e.$t("products.header.sortOptions.priceLowHigh")),1),s("option",_t,n(e.$t("products.header.sortOptions.priceHighLow")),1),s("option",kt,n(e.$t("products.header.sortOptions.newest")),1),s("option",Pt,n(e.$t("products.header.sortOptions.bestRating")),1)],544),[[ke,B.value]])])]),s("div",Ct,[N.value?(l(),i("div",$t,[o[12]||(o[12]=s("div",{class:"animate-spin rounded-full h-12 w-12 md:h-14 md:w-14 lg:h-16 lg:w-16 border-b-2 border-brand-blue-medium mx-auto mb-3 md:mb-4"},null,-1)),s("p",Bt,n(e.$t("products.loading")),1)])):D.value?(l(),i("div",Tt,[o[13]||(o[13]=s("div",{class:"text-red-500 mb-3 md:mb-4"},[s("svg",{class:"w-12 h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),s("p",It,n(D.value),1),s("button",{onClick:o[2]||(o[2]=(...t)=>e.loadProducts&&e.loadProducts(...t)),class:"bg-brand-blue-medium text-white px-4 md:px-6 py-1.5 md:py-2 rounded-lg hover:bg-opacity-90 transition-colors text-sm md:text-base"},n(e.$t("products.retry")),1)])):U.value.length===0?(l(),i("div",St,[o[14]||(o[14]=s("div",{class:"text-gray-400 mb-3 md:mb-4"},[s("svg",{class:"w-12 h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})])],-1)),s("p",Lt,n(e.$t("products.noProducts")),1)])):(l(),i("div",Nt,[(l(!0),i(S,null,L(U.value,t=>(l(),$e(Le,{key:t.id,product:t,"is-in-wishlist":ce(t.id),"is-in-list":pe(t.id),"is-in-favorites":me(t.id),onNavigateToProduct:ie,onToggleWishlist:de,onToggleList:ue,onFavoriteUpdated:ge},null,8,["product","is-in-wishlist","is-in-list","is-in-favorites"]))),128))])),C.value>0?(l(),i("div",Mt,[s("button",{onClick:o[3]||(o[3]=t=>H(c.value-1)),disabled:c.value===1||N.value,class:"px-3 md:px-4 py-1.5 md:py-2 border border-gray-300 rounded-lg text-sm md:text-base text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},n(e.$t("products.pagination.previous")),9,At),s("div",Et,[s("span",Ft,n(e.$t("products.pagination.page"))+" "+n(c.value),1)]),s("button",{onClick:o[4]||(o[4]=t=>H(c.value+1)),disabled:M.value.length<T.value||N.value,class:"px-3 md:px-4 py-1.5 md:py-2 border border-gray-300 rounded-lg text-sm md:text-base text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},n(e.$t("products.pagination.next")),9,Dt)])):v("",!0)])])])])]),Q(Me)]))}},Yt=Ae(Wt,[["__scopeId","data-v-6fbaaedf"]]);export{Yt as default};
