import{N as P,u as h,r as l,o as E,a as W,c as y,b as C,m as k}from"./index.wIsFJS4U.js";import{u as x}from"./cartStore.DmGuu8Rw.js";import{u as M}from"./paymentStore.BNbGchZc.js";import{u as O}from"./useAlert.DokLwNXu.js";import{_ as T}from"./_plugin-vue_export-helper.DlAUqK2U.js";const b={class:"wompi-success-view"},A={__name:"WompiSuccess",setup(B){const s=k(),f=x(),c=M();P();const n=h(),{showLoading:d,showSuccess:g,showError:t,closeAlert:o}=O(),e=l(null),_=l(60),i=l(0);function S(){o(),s.push({name:`Home-${n.locale}`})}async function u(){try{const a=localStorage.getItem("wompi_reference");if(!a)throw new Error("No se encontrÃ³ la referencia de pago.");console.log("ðŸ” [WOMPI] Verificando estado del pago...");const r=await c.checkWompiPaymentStatus(a);if(r.status==="success"){console.log("âœ… [WOMPI] Pago confirmado:",r),e.value&&(clearInterval(e.value),e.value=null);const m=localStorage.getItem("wompi_order_data");let w=0,p="";if(m){const v=JSON.parse(m);w=parseFloat(v.total||0),p=v.customer_email||""}localStorage.removeItem("wompi_reference"),localStorage.removeItem("wompi_order_data"),localStorage.removeItem("wompi_widget_data"),sessionStorage.removeItem("checkout_order_data"),f.clearCart(),c.clearPaymentState(),o(),await g(`Tu pago ha sido confirmado exitosamente.
RecibirÃ¡s un email de confirmaciÃ³n en: ${p}`,"ðŸŽ‰ Â¡Pago Exitoso!",{timer:5e3,timerProgressBar:!0,willClose:()=>{S()}})}else r.status==="error"?(console.error("âŒ [WOMPI] Error:",r.error),e.value&&(clearInterval(e.value),e.value=null),o(),await t(r.error||"Hubo un problema al procesar tu pago.","âŒ Error en el Pago",{confirmButtonText:"Volver al checkout",willClose:()=>{s.push({name:`Checkout-${n.locale}`})}})):(i.value++,i.value>=_.value&&(console.warn("â±ï¸ [WOMPI] Timeout"),e.value&&(clearInterval(e.value),e.value=null),o(),await t("El pago estÃ¡ tomando mÃ¡s tiempo de lo esperado. Por favor verifica tu email o contacta a soporte.","â±ï¸ Tiempo de espera agotado")))}catch(a){console.error("âŒ [WOMPI] Error:",a),e.value&&(clearInterval(e.value),e.value=null),o(),await t(a.message||"Error al verificar el pago.","âŒ Error")}}function I(){d("Verificando tu pago con Wompi...","ðŸ’³ Procesando"),u(),e.value=setInterval(()=>{u()},1e3)}return E(()=>{console.log("ðŸš€ [WOMPI SUCCESS] Iniciando verificaciÃ³n de pago"),I()}),W(()=>{e.value&&(clearInterval(e.value),e.value=null),o()}),(a,r)=>(C(),y("div",b))}},R=T(A,[["__scopeId","data-v-5e8c8e67"]]);export{R as default};
