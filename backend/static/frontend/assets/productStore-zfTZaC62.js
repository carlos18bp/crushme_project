import{G as ta,r as u,i,K as d}from"../index.js";import{P as X}from"./constants-DjCFsGER.js";const oa=ta("product",()=>{const f=u([]),L=u(null),W=u([]),U=u([]),m=u([]),O=u([]),w=u([]),P=u([]),v=u([]),z=u([]),R=u(null),E=u([]),_=u(null),D=u(null),T=u(""),y=u(""),K=u(null),$=u([]),g=u(!1),I=u(!1),G=u(!1),p=u(!1),C=u(!1),N=u(!1),S=u(!1),V=u(!1),M=u(!1),l=u(null),o=u(null),k=u(""),F=u(""),A=u(""),b=i(()=>f.value.filter(e=>e.is_active)),Z=i(()=>b.value.filter(e=>e.is_in_stock)),q=i(()=>F.value?b.value.filter(e=>e.category===F.value):b.value),x=i(()=>X.map(e=>({...e,count:f.value.filter(t=>t.category===e.value&&t.is_active).length}))),ee=i(()=>f.value.length>0),ae=i(()=>m.value.length>0),h=i(()=>w.value.filter(e=>e.status==="publish")),te=i(()=>h.value.filter(e=>e.stock_status==="instock")),re=i(()=>A.value?h.value.filter(e=>e.categories.some(t=>t.id===A.value)):h.value),se=i(()=>P.value.map(e=>({...e,count:w.value.filter(t=>t.categories.some(a=>a.id===e.id)&&t.status==="publish").length}))),oe=i(()=>w.value.length>0),ce=i(()=>P.value.length>0),ue=i(()=>v.value.length>0),ne=i(()=>E.value.length>0),le=i(()=>$.value.length>0),de=i(()=>D.value==="OK"),Y=i(()=>{if(!T.value)return h.value;const e=v.value.find(a=>a.theme===T.value);if(!e)return[];const t=new Set;return e.categories.forEach(a=>{t.add(a.id),a.has_subcategories&&a.subcategories&&a.subcategories.forEach(r=>t.add(r.id))}),h.value.filter(a=>a.categories.some(r=>t.has(r.id)))}),ie=i(()=>y.value?h.value.filter(e=>e.categories.some(t=>t.id===y.value)):Y.value),fe=e=>{const t=v.value.find(a=>a.theme===e);return t?t.categories:[]},ve=e=>{for(const t of v.value){const a=t.categories.find(r=>r.id===e);if(a&&a.has_subcategories)return a.subcategories||[]}return[]};async function ge(){var e,t;g.value=!0,l.value=null;try{const a=await d("products/");return f.value=a.data.products||[],{success:!0,data:f.value}}catch(a){return l.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch products",{success:!1,error:l.value}}finally{g.value=!1}}async function pe(e){var t,a;I.value=!0,l.value=null;try{const r=await d(`products/${e}/`);return L.value=r.data.product,{success:!0,data:r.data.product}}catch(r){return l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch product",L.value=null,{success:!1,error:l.value}}finally{I.value=!1}}async function he(e){var t,a;g.value=!0,l.value=null,F.value=e;try{const s=(await d(`products/category/?category=${e}`)).data.products||[];return f.value=f.value.filter(c=>c.category!==e),f.value.push(...s),{success:!0,data:s}}catch(r){return l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch category products",{success:!1,error:l.value}}finally{g.value=!1}}async function me(e){var t,a;if(!e||e.length<2)return m.value=[],k.value="",{success:!0,data:[]};G.value=!0,l.value=null,k.value=e;try{const r=await d(`products/search/?q=${encodeURIComponent(e)}`);return m.value=r.data.products||[],{success:!0,data:m.value}}catch(r){return l.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Search failed",m.value=[],{success:!1,error:l.value}}finally{G.value=!1}}async function ye(){try{const e=await d("products/categories/");return W.value=e.data.categories||[],{success:!0,data:W.value}}catch{return W.value=X,{success:!0,data:W.value}}}async function Ce(){var e,t;try{const a=await d("products/featured/");return U.value=a.data.featured_products||[],{success:!0,data:U.value}}catch(a){return l.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch featured products",{success:!1,error:l.value}}}async function we(e){var t,a;try{const r=await d(`products/${e}/recommendations/`);return O.value=r.data.recommendations||[],{success:!0,data:O.value}}catch(r){return O.value=[],{success:!1,error:((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch recommendations"}}}function Ee(e){return f.value.find(t=>t.id===e)||null}function _e(){m.value=[],k.value=""}function We(){F.value=""}function Pe(){L.value=null}function Re(){l.value=null}function Te(e){g.value=e}function Se(e,t){let a=b.value;return e!=null&&(a=a.filter(r=>r.price>=e)),t!=null&&(a=a.filter(r=>r.price<=t)),a}function Fe(e,t="name",a="asc"){return[...e].sort((s,c)=>{let n=0;switch(t){case"name":n=s.name.localeCompare(c.name);break;case"price":n=s.price-c.price;break;case"date":n=new Date(s.created_at)-new Date(c.created_at);break;default:n=0}return a==="desc"?-n:n})}async function Ae(){var e,t;p.value=!0,o.value=null;try{const a=await d("products/woocommerce/test/");return D.value=a.data.connection_status,{success:!0,data:a.data}}catch(a){return o.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to test WooCommerce connection",D.value="ERROR",{success:!1,error:o.value}}finally{p.value=!1}}async function B({categoryId:e=null,perPage:t=10,page:a=1}={}){var r,s;p.value=!0,o.value=null;try{let c=`products/woocommerce/products/?per_page=${t}&page=${a}`;e&&(c+=`&category_id=${e}`);const n=await d(c),J=n.data.data||[];return w.value=J,{success:!0,data:J,pagination:n.data.pagination_info}}catch(c){return o.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.error)||"Failed to fetch WooCommerce products",{success:!1,error:o.value}}finally{p.value=!1}}async function be(e,t=10,a=1){return A.value=e,await B({categoryId:e,perPage:t,page:a})}async function Be({perPage:e=100,page:t=1}={}){var a,r;N.value=!0,o.value=null;try{const s=await d(`products/woocommerce/categories/?per_page=${e}&page=${t}`);return t===1?P.value=s.data.data||[]:P.value.push(...s.data.data||[]),{success:!0,data:s.data.data||[],pagination:s.data.pagination_info}}catch(s){return o.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch WooCommerce categories",{success:!1,error:o.value}}finally{N.value=!1}}async function Q(){var e,t,a,r;S.value=!0,o.value=null;try{const s=await d("products/woocommerce/categories/organized/");return console.log("🚀 RESPUESTA COMPLETA DEL BACKEND:",{status:s.status,data:s.data,headers:s.headers,fullResponse:s}),console.log("📊 DATOS DE TEMAS RECIBIDOS:",s.data.data),console.log("🔢 TOTAL DE CATEGORÍAS:",s.data.total_categories),v.value=s.data.data||[],{success:!0,data:s.data.data||[],total_categories:s.data.total_categories||0}}catch(s){return console.error("❌ ERROR EN LLAMADA AL BACKEND:",{message:s.message,response:s.response,status:(e=s.response)==null?void 0:e.status,data:(t=s.response)==null?void 0:t.data,fullError:s}),o.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch organized WooCommerce categories",{success:!1,error:o.value}}finally{S.value=!1}}async function Le(){var e,t;V.value=!0,o.value=null;try{const a=await d("products/woocommerce/categories/tree/");return z.value=a.data.data||[],{success:!0,data:a.data.data||[],total:a.data.total||0}}catch(a){return o.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch WooCommerce category tree",{success:!1,error:o.value}}finally{V.value=!1}}async function Oe(e){var t;C.value=!0,o.value=null;try{const a=await d(`products/woocommerce/products/${e}/`);if(a.data.success){const r=a.data.data;return R.value=r,{success:!0,data:r}}else return o.value=a.data.error||"Error desconocido del backend",R.value=null,{success:!1,error:o.value}}catch(a){let r="Failed to fetch WooCommerce product";return(t=a.response)!=null&&t.data&&(a.response.data.error?r=a.response.data.error:a.response.data.message&&(r=a.response.data.message)),o.value=r,R.value=null,{success:!1,error:o.value}}finally{C.value=!1}}async function De(e,t=100,a=1){var r;C.value=!0,o.value=null;try{const s=await d(`products/woocommerce/products/${e}/variations/?per_page=${t}&page=${a}`);if(s.data.success){const c=s.data.data||[];return E.value=c,{success:!0,data:c}}else return o.value=s.data.error||"Error desconocido del backend",E.value=[],{success:!1,error:o.value}}catch(s){let c="Failed to fetch product variations";return(r=s.response)!=null&&r.data&&(s.response.data.error?c=s.response.data.error:s.response.data.message&&(c=s.response.data.message)),o.value=c,E.value=[],{success:!1,error:o.value}}finally{C.value=!1}}async function $e(e,t){var a;C.value=!0,o.value=null;try{const r=await d(`products/woocommerce/products/${e}/variations/${t}/`);if(r.data.success){const s=r.data.data;return _.value=s,{success:!0,data:s}}else return o.value=r.data.error||"Error desconocido del backend",_.value=null,{success:!1,error:o.value}}catch(r){let s="Failed to fetch product variation";return(a=r.response)!=null&&a.data&&(r.response.data.error?s=r.response.data.error:r.response.data.message&&(s=r.response.data.message)),o.value=s,_.value=null,{success:!1,error:o.value}}finally{C.value=!1}}function ke(){E.value=[],_.value=null}function Ue(e){_.value=e}function Ie(e){return w.value.find(t=>t.id===e)||null}function Ge(e,t){let a=h.value;return e!=null&&(a=a.filter(r=>parseFloat(r.price)>=e)),t!=null&&(a=a.filter(r=>parseFloat(r.price)<=t)),a}function Ne(e,t="name",a="asc"){return[...e].sort((s,c)=>{let n=0;switch(t){case"name":n=s.name.localeCompare(c.name);break;case"price":n=parseFloat(s.price)-parseFloat(c.price);break;case"date":n=new Date(s.date_created)-new Date(c.date_created);break;case"popularity":n=s.total_sales-c.total_sales;break;case"rating":n=parseFloat(s.average_rating)-parseFloat(c.average_rating);break;default:n=0}return a==="desc"?-n:n})}function Ve(){A.value=""}function Me(){R.value=null}function ze(){o.value=null}function Ke(){v.value=[]}function Ye(e){p.value=e}function Qe(e){T.value=e,y.value=""}function je(e){y.value=e}function He(){T.value="",y.value=""}function Je(){y.value=""}function j(e){return v.value.find(t=>t.theme===e)||null}function Xe(e){for(const t of v.value){const a=t.categories.find(r=>r.id===e);if(a)return a;for(const r of t.categories)if(r.has_subcategories&&r.subcategories){const s=r.subcategories.find(c=>c.id===e);if(s)return s}}return null}async function Ze(e,t=20,a=1){const r=j(e);if(!r)return{success:!1,error:"Tema no encontrado"};const s=r.categories.find(c=>c.is_main);return s?await B({categoryId:s.id,perPage:t,page:a}):r.categories.length>0?await B({categoryId:r.categories[0].id,perPage:t,page:a}):{success:!1,error:"No hay categorías en este tema"}}async function H(){var e,t;p.value=!0,o.value=null;try{const a=await d("products/woocommerce/stats/");return K.value=a.data.data||null,{success:!0,data:a.data.data||null}}catch(a){return o.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch WooCommerce stats",{success:!1,error:o.value}}finally{p.value=!1}}async function qe(){var e,t;M.value=!0,o.value=null;try{const a=await d("products/woocommerce/products/trending/"),r=a.data.data||[];return $.value=r,{success:!0,data:r,total_products:a.data.total_products||0,message:a.data.message}}catch(a){return o.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch trending products",$.value=[],{success:!1,error:o.value}}finally{M.value=!1}}async function xe(){var e,t,a,r;S.value=!0,o.value=null;try{const s=await d("products/woocommerce/categories/featured-random/");console.log("🚀 RESPUESTA FEATURED CATEGORIES:",{status:s.status,data:s.data,headers:s.headers,fullResponse:s});const c=s.data.data||[];return v.value=c.map(n=>({theme:n.slug,name:n.name,icon:n.icon,first_product_image:n.first_product_image,category_id:n.category_id})),{success:!0,data:c,total_selected:s.data.total_selected||0,message:s.data.message}}catch(s){return console.error("❌ ERROR EN FEATURED CATEGORIES:",{message:s.message,response:s.response,status:(e=s.response)==null?void 0:e.status,data:(t=s.response)==null?void 0:t.data,fullError:s}),o.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch featured categories",{success:!1,error:o.value}}finally{S.value=!1}}async function ea(e,t=20,a=1){var r,s;g.value=!0,l.value=null;try{const c=await d(`products/category/?category=${encodeURIComponent(e)}&per_page=${t}&page=${a}`);return console.log("🚀 RESPUESTA PRODUCTS BY CATEGORY SLUG:",{status:c.status,data:c.data,categorySlug:e,perPage:t,page:a}),{success:!0,data:c.data.products||[],pagination:c.data.pagination_info,total_products:c.data.total_products||0}}catch(c){return console.error("❌ ERROR EN PRODUCTS BY CATEGORY SLUG:",{message:c.message,response:c.response,categorySlug:e,fullError:c}),l.value=((s=(r=c.response)==null?void 0:r.data)==null?void 0:s.error)||"Failed to fetch category products",{success:!1,error:l.value}}finally{g.value=!1}}async function aa(){try{const e=await Q();if(!e.success)return{success:!1,error:"Error cargando categorías - No se pueden cargar productos sin categorías"};const t=await B({perPage:9,page:1});return H(),{success:!0,themes:e.data,products:t.data||[],total_categories:e.total_categories,stats:null}}catch(e){return o.value=e.message||"Error inicializando WooCommerce",{success:!1,error:o.value}}}return{products:f,currentProduct:L,categories:W,featuredProducts:U,searchResults:m,recommendations:O,isLoading:g,isLoadingProduct:I,isLoadingSearch:G,error:l,searchQuery:k,selectedCategory:F,wooProducts:w,wooCategories:P,wooThemes:v,wooCategoryTree:z,wooCurrentProduct:R,wooProductVariations:E,wooCurrentVariation:_,wooConnectionStatus:D,wooStats:K,trendingProducts:$,isLoadingWoo:p,isLoadingWooProduct:C,isLoadingWooCategories:N,isLoadingWooThemes:S,isLoadingWooCategoryTree:V,isLoadingTrending:M,wooError:o,selectedWooCategory:A,selectedTheme:T,selectedSubcategory:y,activeProducts:b,inStockProducts:Z,productsByCategory:q,categoriesWithCount:x,hasProducts:ee,hasSearchResults:ae,activeWooProducts:h,inStockWooProducts:te,wooProductsByCategory:re,wooCategoriesWithCount:se,hasWooProducts:oe,hasWooCategories:ce,hasWooThemes:ue,hasWooVariations:ne,hasTrendingProducts:le,isWooConnected:de,wooProductsByTheme:Y,wooProductsBySubcategory:ie,getCategoriesByTheme:fe,getSubcategoriesByCategory:ve,fetchProducts:ge,fetchProduct:pe,fetchProductsByCategory:he,searchProducts:me,fetchCategories:ye,fetchFeaturedProducts:Ce,fetchRecommendations:we,getProductById:Ee,clearSearch:_e,clearCategory:We,clearCurrentProduct:Pe,clearError:Re,setLoading:Te,filterByPriceRange:Se,sortProducts:Fe,testWooConnection:Ae,fetchWooProducts:B,fetchWooProductsByCategory:be,fetchWooCategories:Be,fetchWooOrganizedCategories:Q,fetchWooCategoryTree:Le,fetchWooStats:H,fetchWooTrendingProducts:qe,fetchFeaturedCategories:xe,fetchProductsByCategorySlug:ea,fetchWooProduct:Oe,fetchWooProductVariations:De,fetchWooProductVariation:$e,getWooProductById:Ie,filterWooByPriceRange:Ge,sortWooProducts:Ne,clearWooCategory:Ve,clearWooCurrentProduct:Me,clearWooVariations:ke,setWooCurrentVariation:Ue,clearWooError:ze,clearFeaturedCategories:Ke,setWooLoading:Ye,selectTheme:Qe,selectSubcategory:je,clearTheme:He,clearSubcategory:Je,getThemeBySlug:j,getCategoryById:Xe,fetchProductsByTheme:Ze,initializeWooCommerce:aa}});export{oa as u};
