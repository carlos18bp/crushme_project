import{I as sa,r as n,l as i,M as l}from"./index.T4J3j10_.js";import{P as Z}from"./constants.DjCFsGER.js";const ua=sa("product",()=>{const f=n([]),B=n(null),W=n([]),U=n([]),m=n([]),L=n([]),y=n([]),P=n([]),v=n([]),z=n([]),R=n(null),_=n([]),E=n(null),O=n(null),T=n(""),C=n(""),Y=n(null),D=n([]),p=n(!1),I=n(!1),G=n(!1),g=n(!1),w=n(!1),M=n(!1),S=n(!1),N=n(!1),V=n(!1),d=n(null),c=n(null),k=n(""),F=n(""),b=n(""),A=i(()=>f.value.filter(e=>e.is_active)),q=i(()=>A.value.filter(e=>e.is_in_stock)),x=i(()=>F.value?A.value.filter(e=>e.category===F.value):A.value),ee=i(()=>Z.map(e=>({...e,count:f.value.filter(t=>t.category===e.value&&t.is_active).length}))),ae=i(()=>f.value.length>0),te=i(()=>m.value.length>0),h=i(()=>y.value.filter(e=>e.status==="publish")),re=i(()=>h.value.filter(e=>e.stock_status==="instock")),se=i(()=>b.value?h.value.filter(e=>e.categories.some(t=>t.id===b.value)):h.value),oe=i(()=>P.value.map(e=>({...e,count:y.value.filter(t=>t.categories.some(a=>a.id===e.id)&&t.status==="publish").length}))),ce=i(()=>y.value.length>0),ue=i(()=>P.value.length>0),ne=i(()=>v.value.length>0),le=i(()=>_.value.length>0),de=i(()=>D.value.length>0),ie=i(()=>O.value==="OK"),K=i(()=>{if(!T.value)return h.value;const e=v.value.find(a=>a.theme===T.value);if(!e)return[];const t=new Set;return e.categories.forEach(a=>{t.add(a.id),a.has_subcategories&&a.subcategories&&a.subcategories.forEach(r=>t.add(r.id))}),h.value.filter(a=>a.categories.some(r=>t.has(r.id)))}),fe=i(()=>C.value?h.value.filter(e=>e.categories.some(t=>t.id===C.value)):K.value),ve=e=>{const t=v.value.find(a=>a.theme===e);return t?t.categories:[]},ge=e=>{for(const t of v.value){const a=t.categories.find(r=>r.id===e);if(a&&a.has_subcategories)return a.subcategories||[]}return[]};async function pe(){var e,t;p.value=!0,d.value=null;try{const a=await l("products/");return f.value=a.data.products||[],{success:!0,data:f.value}}catch(a){return d.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch products",{success:!1,error:d.value}}finally{p.value=!1}}async function he(e){var t,a;I.value=!0,d.value=null;try{const r=await l(`products/${e}/`);return B.value=r.data.product,{success:!0,data:r.data.product}}catch(r){return d.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch product",B.value=null,{success:!1,error:d.value}}finally{I.value=!1}}async function me(e){var t,a;p.value=!0,d.value=null,F.value=e;try{const s=(await l(`products/category/?category=${e}`)).data.products||[];return f.value=f.value.filter(o=>o.category!==e),f.value.push(...s),{success:!0,data:s}}catch(r){return d.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch category products",{success:!1,error:d.value}}finally{p.value=!1}}async function ye(e){var t,a;if(!e||e.length<2)return m.value=[],k.value="",{success:!0,data:[]};G.value=!0,d.value=null,k.value=e;try{const r=await l(`products/search/?q=${encodeURIComponent(e)}`);return m.value=r.data.products||[],{success:!0,data:m.value}}catch(r){return d.value=((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Search failed",m.value=[],{success:!1,error:d.value}}finally{G.value=!1}}async function Ce(){try{const e=await l("products/categories/");return W.value=e.data.categories||[],{success:!0,data:W.value}}catch{return W.value=Z,{success:!0,data:W.value}}}async function we(){var e,t;try{const a=await l("products/featured/");return U.value=a.data.featured_products||[],{success:!0,data:U.value}}catch(a){return d.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch featured products",{success:!1,error:d.value}}}async function _e(e){var t,a;try{const r=await l(`products/${e}/recommendations/`);return L.value=r.data.recommendations||[],{success:!0,data:L.value}}catch(r){return L.value=[],{success:!1,error:((a=(t=r.response)==null?void 0:t.data)==null?void 0:a.error)||"Failed to fetch recommendations"}}}function Ee(e){return f.value.find(t=>t.id===e)||null}function We(){m.value=[],k.value=""}function Pe(){F.value=""}function Re(){B.value=null}function Te(){d.value=null}function Se(e){p.value=e}function Fe(e,t){let a=A.value;return e!=null&&(a=a.filter(r=>r.price>=e)),t!=null&&(a=a.filter(r=>r.price<=t)),a}function be(e,t="name",a="asc"){return[...e].sort((s,o)=>{let u=0;switch(t){case"name":u=s.name.localeCompare(o.name);break;case"price":u=s.price-o.price;break;case"date":u=new Date(s.created_at)-new Date(o.created_at);break;default:u=0}return a==="desc"?-u:u})}async function Ae(){var e,t;g.value=!0,c.value=null;try{const a=await l("products/woocommerce/test/");return O.value=a.data.connection_status,{success:!0,data:a.data}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to test WooCommerce connection",O.value="ERROR",{success:!1,error:c.value}}finally{g.value=!1}}async function $({categoryId:e=null,perPage:t=10,page:a=1,sortBy:r=null}={}){var s,o;g.value=!0,c.value=null;try{let u=`products/woocommerce/products/?per_page=${t}&page=${a}`;e&&(u+=`&category_id=${e}`),r&&(u+=`&sort_by=${r}`);const J=await l(u),X=J.data.data||[];return y.value=X,{success:!0,data:X,pagination:J.data.pagination_info}}catch(u){return c.value=((o=(s=u.response)==null?void 0:s.data)==null?void 0:o.error)||"Failed to fetch WooCommerce products",{success:!1,error:c.value}}finally{g.value=!1}}async function $e(e,t=10,a=1,r=null){return b.value=e,await $({categoryId:e,perPage:t,page:a,sortBy:r})}async function Be({perPage:e=100,page:t=1}={}){var a,r;M.value=!0,c.value=null;try{const s=await l(`products/woocommerce/categories/?per_page=${e}&page=${t}`);return t===1?P.value=s.data.data||[]:P.value.push(...s.data.data||[]),{success:!0,data:s.data.data||[],pagination:s.data.pagination_info}}catch(s){return c.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch WooCommerce categories",{success:!1,error:c.value}}finally{M.value=!1}}async function Q(){var e,t,a,r;S.value=!0,c.value=null;try{const s=await l("products/woocommerce/categories/organized/");return console.log("üöÄ RESPUESTA COMPLETA DEL BACKEND:",{status:s.status,data:s.data,headers:s.headers,fullResponse:s}),console.log("üìä DATOS DE TEMAS RECIBIDOS:",s.data.data),console.log("üî¢ TOTAL DE CATEGOR√çAS:",s.data.total_categories),v.value=s.data.data||[],{success:!0,data:s.data.data||[],total_categories:s.data.total_categories||0}}catch(s){return console.error("‚ùå ERROR EN LLAMADA AL BACKEND:",{message:s.message,response:s.response,status:(e=s.response)==null?void 0:e.status,data:(t=s.response)==null?void 0:t.data,fullError:s}),c.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch organized WooCommerce categories",{success:!1,error:c.value}}finally{S.value=!1}}async function Le(){var e,t;N.value=!0,c.value=null;try{const a=await l("products/woocommerce/categories/tree/");return z.value=a.data.data||[],{success:!0,data:a.data.data||[],total:a.data.total||0}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch WooCommerce category tree",{success:!1,error:c.value}}finally{N.value=!1}}async function Oe(e){var t;w.value=!0,c.value=null;try{const a=await l(`products/woocommerce/products/${e}/`);if(a.data.success){const r=a.data.data;return R.value=r,{success:!0,data:r}}else return c.value=a.data.error||"Error desconocido del backend",R.value=null,{success:!1,error:c.value}}catch(a){let r="Failed to fetch WooCommerce product";return(t=a.response)!=null&&t.data&&(a.response.data.error?r=a.response.data.error:a.response.data.message&&(r=a.response.data.message)),c.value=r,R.value=null,{success:!1,error:c.value}}finally{w.value=!1}}async function De(e,t=100,a=1){var r;w.value=!0,c.value=null;try{const s=await l(`products/woocommerce/products/${e}/variations/?per_page=${t}&page=${a}`);if(s.data.success){const o=s.data.data||[];return _.value=o,{success:!0,data:o}}else return c.value=s.data.error||"Error desconocido del backend",_.value=[],{success:!1,error:c.value}}catch(s){let o="Failed to fetch product variations";return(r=s.response)!=null&&r.data&&(s.response.data.error?o=s.response.data.error:s.response.data.message&&(o=s.response.data.message)),c.value=o,_.value=[],{success:!1,error:c.value}}finally{w.value=!1}}async function ke(e,t){var a;w.value=!0,c.value=null;try{const r=await l(`products/woocommerce/products/${e}/variations/${t}/`);if(r.data.success){const s=r.data.data;return E.value=s,{success:!0,data:s}}else return c.value=r.data.error||"Error desconocido del backend",E.value=null,{success:!1,error:c.value}}catch(r){let s="Failed to fetch product variation";return(a=r.response)!=null&&a.data&&(r.response.data.error?s=r.response.data.error:r.response.data.message&&(s=r.response.data.message)),c.value=s,E.value=null,{success:!1,error:c.value}}finally{w.value=!1}}function Ue(){_.value=[],E.value=null}function Ie(e){E.value=e}function Ge(e){return y.value.find(t=>t.id===e)||null}function Me(e,t){let a=h.value;return e!=null&&(a=a.filter(r=>parseFloat(r.price)>=e)),t!=null&&(a=a.filter(r=>parseFloat(r.price)<=t)),a}function Ne(e,t="name",a="asc"){return[...e].sort((s,o)=>{let u=0;switch(t){case"name":u=s.name.localeCompare(o.name);break;case"price":u=parseFloat(s.price)-parseFloat(o.price);break;case"date":u=new Date(s.date_created)-new Date(o.date_created);break;case"popularity":u=s.total_sales-o.total_sales;break;case"rating":u=parseFloat(s.average_rating)-parseFloat(o.average_rating);break;default:u=0}return a==="desc"?-u:u})}function Ve(){b.value=""}function ze(){R.value=null}function Ye(){c.value=null}function Ke(){v.value=[]}function Qe(e){g.value=e}function je(e){T.value=e,C.value=""}function He(e){C.value=e}function Je(){T.value="",C.value=""}function Xe(){C.value=""}function j(e){return v.value.find(t=>t.theme===e)||null}function Ze(e){for(const t of v.value){const a=t.categories.find(r=>r.id===e);if(a)return a;for(const r of t.categories)if(r.has_subcategories&&r.subcategories){const s=r.subcategories.find(o=>o.id===e);if(s)return s}}return null}async function qe(e,t=20,a=1){const r=j(e);if(!r)return{success:!1,error:"Tema no encontrado"};const s=r.categories.find(o=>o.is_main);return s?await $({categoryId:s.id,perPage:t,page:a}):r.categories.length>0?await $({categoryId:r.categories[0].id,perPage:t,page:a}):{success:!1,error:"No hay categor√≠as en este tema"}}async function H(){var e,t;g.value=!0,c.value=null;try{const a=await l("products/woocommerce/stats/");return Y.value=a.data.data||null,{success:!0,data:a.data.data||null}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch WooCommerce stats",{success:!1,error:c.value}}finally{g.value=!1}}async function xe(){var e,t;V.value=!0,c.value=null;try{const a=await l("products/woocommerce/products/trending/"),r=a.data.data||[];return D.value=r,{success:!0,data:r,total_products:a.data.total_products||0,message:a.data.message}}catch(a){return c.value=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.error)||"Failed to fetch trending products",D.value=[],{success:!1,error:c.value}}finally{V.value=!1}}async function ea(){var e,t,a,r;S.value=!0,c.value=null;try{const s=await l("products/woocommerce/categories/featured-random/");console.log("üöÄ RESPUESTA FEATURED CATEGORIES:",{status:s.status,data:s.data,headers:s.headers,fullResponse:s});const o=s.data.data||[];return v.value=o.map(u=>({theme:u.slug,name:u.name,icon:u.icon,first_product_image:u.first_product_image,category_id:u.category_id})),{success:!0,data:o,total_selected:s.data.total_selected||0,message:s.data.message}}catch(s){return console.error("‚ùå ERROR EN FEATURED CATEGORIES:",{message:s.message,response:s.response,status:(e=s.response)==null?void 0:e.status,data:(t=s.response)==null?void 0:t.data,fullError:s}),c.value=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.error)||"Failed to fetch featured categories",{success:!1,error:c.value}}finally{S.value=!1}}async function aa(e,t=20,a=1){var r,s;p.value=!0,d.value=null;try{const o=await l(`products/category/?category=${encodeURIComponent(e)}&per_page=${t}&page=${a}`);return console.log("üöÄ RESPUESTA PRODUCTS BY CATEGORY SLUG:",{status:o.status,data:o.data,categorySlug:e,perPage:t,page:a}),{success:!0,data:o.data.products||[],pagination:o.data.pagination_info,total_products:o.data.total_products||0}}catch(o){return console.error("‚ùå ERROR EN PRODUCTS BY CATEGORY SLUG:",{message:o.message,response:o.response,categorySlug:e,fullError:o}),d.value=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.error)||"Failed to fetch category products",{success:!1,error:d.value}}finally{p.value=!1}}async function ta(e,t=1){var a,r,s;if(!e||e.trim().length<2)return{success:!0,data:[],message:"Query too short"};g.value=!0,c.value=null;try{const o=await l(`products/woocommerce/products/search/?q=${encodeURIComponent(e.trim())}&page=${t}`),u=o.data.data||[];return y.value=u,{success:!0,data:u,pagination:o.data.pagination||null,search:o.data.search||null,total:((a=o.data.pagination)==null?void 0:a.total_results)||u.length,message:o.data.message}}catch(o){return c.value=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.error)||"Failed to search products",{success:!1,error:c.value}}finally{g.value=!1}}async function ra(){try{const e=await Q();if(!e.success)return{success:!1,error:"Error cargando categor√≠as - No se pueden cargar productos sin categor√≠as"};const t=await $({perPage:9,page:1});return H(),{success:!0,themes:e.data,products:t.data||[],total_categories:e.total_categories,stats:null}}catch(e){return c.value=e.message||"Error inicializando WooCommerce",{success:!1,error:c.value}}}return{products:f,currentProduct:B,categories:W,featuredProducts:U,searchResults:m,recommendations:L,isLoading:p,isLoadingProduct:I,isLoadingSearch:G,error:d,searchQuery:k,selectedCategory:F,wooProducts:y,wooCategories:P,wooThemes:v,wooCategoryTree:z,wooCurrentProduct:R,wooProductVariations:_,wooCurrentVariation:E,wooConnectionStatus:O,wooStats:Y,trendingProducts:D,isLoadingWoo:g,isLoadingWooProduct:w,isLoadingWooCategories:M,isLoadingWooThemes:S,isLoadingWooCategoryTree:N,isLoadingTrending:V,wooError:c,selectedWooCategory:b,selectedTheme:T,selectedSubcategory:C,activeProducts:A,inStockProducts:q,productsByCategory:x,categoriesWithCount:ee,hasProducts:ae,hasSearchResults:te,activeWooProducts:h,inStockWooProducts:re,wooProductsByCategory:se,wooCategoriesWithCount:oe,hasWooProducts:ce,hasWooCategories:ue,hasWooThemes:ne,hasWooVariations:le,hasTrendingProducts:de,isWooConnected:ie,wooProductsByTheme:K,wooProductsBySubcategory:fe,getCategoriesByTheme:ve,getSubcategoriesByCategory:ge,fetchProducts:pe,fetchProduct:he,fetchProductsByCategory:me,searchProducts:ye,fetchCategories:Ce,fetchFeaturedProducts:we,fetchRecommendations:_e,getProductById:Ee,clearSearch:We,clearCategory:Pe,clearCurrentProduct:Re,clearError:Te,setLoading:Se,filterByPriceRange:Fe,sortProducts:be,testWooConnection:Ae,fetchWooProducts:$,fetchWooProductsByCategory:$e,fetchWooCategories:Be,fetchWooOrganizedCategories:Q,fetchWooCategoryTree:Le,fetchWooStats:H,fetchWooTrendingProducts:xe,fetchFeaturedCategories:ea,fetchProductsByCategorySlug:aa,searchWooProducts:ta,fetchWooProduct:Oe,fetchWooProductVariations:De,fetchWooProductVariation:ke,getWooProductById:Ge,filterWooByPriceRange:Me,sortWooProducts:Ne,clearWooCategory:Ve,clearWooCurrentProduct:ze,clearWooVariations:Ue,setWooCurrentVariation:Ie,clearWooError:Ye,clearFeaturedCategories:Ke,setWooLoading:Qe,selectTheme:je,selectSubcategory:He,clearTheme:Je,clearSubcategory:Xe,getThemeBySlug:j,getCategoryById:Ze,fetchProductsByTheme:qe,initializeWooCommerce:ra}});export{ua as u};
