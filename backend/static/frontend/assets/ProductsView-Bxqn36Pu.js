import{p as ce,u as ue,r as h,i as m,D as O,j as me,c as i,o as n,d as V,a as o,h as p,t as l,n as w,F as T,g as B,v as ge,E as pe,B as ve,k as he,s as z,m as xe}from"../index.js";import{u as fe}from"./productStore-zfTZaC62.js";import{u as be}from"./profileStore-DZizYbaJ.js";import{u as ye}from"./authStore-tY-7-Xic.js";import{u as _e}from"./cartStore-VCuiRpOe.js";import{P as we}from"./ProductCard-C1-pDTjR.js";import{N as ke,F as Pe}from"./Footer-C_I2_Hif.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";import"./wishlistStore-2Sa37WF2.js";import"./transition-iPTSRwE7.js";const $e={class:"products-page"},Te={class:"main-content bg-pink-50 min-h-screen pt-0"},Be={class:"container mx-auto px-4 md:px-5 lg:px-6 pt-20 md:pt-22 lg:pt-24 pb-4 md:pb-5 lg:pb-6"},Ie={class:"breadcrumb mb-4 md:mb-6 lg:mb-8 flex items-center relative z-10 pt-2 md:pt-3 lg:pt-4"},Se={key:0,class:"text-gray-400 mx-2"},Le={key:2,class:"text-gray-400 mx-2"},Ee={key:3,class:"text-gray-800 font-medium"},Fe={class:"flex flex-col lg:flex-row gap-4 md:gap-6 lg:gap-8 relative z-10"},Ne={class:"sidebar w-full lg:w-80 flex-shrink-0"},Ae={class:"filters-container bg-white rounded-2xl md:rounded-3xl shadow-sm p-4 md:p-5 lg:p-6 border border-gray-100"},De={class:"filters-header mb-4 md:mb-5 lg:mb-6 pb-3 md:pb-4 border-b border-gray-200 flex items-center justify-between"},je={class:"text-lg md:text-xl lg:text-2xl font-semibold text-gray-800"},We={class:"filter-categories"},Ge={key:0,class:"text-center py-3 md:py-4"},Me={class:"text-gray-600 mt-2 text-sm md:text-base"},Ue={key:1},Oe={class:"filter-item mb-2 md:mb-3"},Ve={class:"text-gray-700 text-sm md:text-base font-medium"},ze={key:0,class:"text-brand-pink-dark"},He=["onClick"],Re={class:"flex items-center"},qe={class:"text-gray-800 text-sm md:text-base font-medium"},Je={class:"text-gray-500 text-xs ml-1.5 md:ml-2"},Ke={key:0,class:"mt-1.5 md:mt-2 ml-3 md:ml-4 space-y-1.5 md:space-y-2"},Qe=["onClick"],Xe={class:"flex items-center"},Ye={class:"text-gray-400 text-xs ml-1.5 md:ml-2"},Ze={class:"flex items-center"},et={key:0,class:"text-purple-700 text-xs md:text-sm mr-1.5 md:mr-2"},tt={key:0,class:"ml-3 md:ml-4 mt-1 space-y-1"},st=["onClick"],ot={class:"flex items-center"},at={class:"text-gray-400 text-xs ml-1.5 md:ml-2"},rt={key:0,class:"text-purple-700 text-xs md:text-sm"},lt={class:"products-section flex-1"},nt={class:"products-header flex flex-col md:flex-row items-start md:items-center justify-between mb-4 md:mb-6 lg:mb-8 gap-3 md:gap-4"},it={class:"text-xl md:text-2xl lg:text-3xl font-bold text-gray-800 mb-1.5 md:mb-2 flex items-center"},dt={class:"text-sm md:text-base text-gray-600"},ct={class:"sort-section flex items-center w-full md:w-auto"},ut={class:"text-gray-600 mr-2 md:mr-3 text-sm md:text-base"},mt={value:"mostPopular"},gt={value:"priceLowHigh"},pt={value:"priceHighLow"},vt={value:"newest"},ht={value:"bestRating"},xt={class:"products-grid"},ft={key:0,class:"text-center py-8 md:py-10 lg:py-12"},bt={class:"text-gray-600 text-base md:text-lg"},yt={key:1,class:"text-center py-8 md:py-10 lg:py-12"},_t={class:"text-gray-600 text-base md:text-lg mb-3 md:mb-4"},wt={key:2,class:"text-center py-8 md:py-10 lg:py-12"},kt={class:"text-gray-600 text-base md:text-lg"},Pt={key:3,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-5 lg:gap-6"},Ct={key:4,class:"flex justify-center items-center mt-8 md:mt-10 lg:mt-12 space-x-2 md:space-x-4"},$t=["disabled"],Tt={class:"flex items-center space-x-1 md:space-x-2"},Bt={class:"text-xs md:text-sm text-gray-600"},It=["disabled"],St={__name:"ProductsView",setup(Lt){const{t:H}=ce(),L=he(),E=ve(),R=ue(),r=fe(),F=be(),q=ye(),N=_e(),c=h(""),d=h(""),v=h(new Set),P=h("mostPopular"),u=h(1),C=h(9),x=h(new Set),f=h(new Set),J=m(()=>r.wooThemes),I=m(()=>r.isLoadingWoo),K=m(()=>r.isLoadingWooThemes),A=m(()=>r.wooError);m(()=>r.isWooConnected);const D=m(()=>r.wooStats),b=m(()=>c.value?r.getThemeBySlug(c.value):null),y=m(()=>d.value?r.getCategoryById(d.value):null),Q=m(()=>y.value?y.value.name:b.value?b.value.name:H("products.title")),S=m(()=>{const t=[...r.wooProducts];switch(P.value){case"mostPopular":return t.sort((s,a)=>(a.total_sales||0)-(s.total_sales||0));case"priceLowHigh":return t.sort((s,a)=>parseFloat(s.price)-parseFloat(a.price));case"priceHighLow":return t.sort((s,a)=>parseFloat(a.price)-parseFloat(s.price));case"newest":return t.sort((s,a)=>new Date(a.date_created)-new Date(s.date_created));case"bestRating":return t.sort((s,a)=>parseFloat(a.average_rating||0)-parseFloat(s.average_rating||0));default:return t}}),k=m(()=>{var e,t;if(d.value){const s=r.getCategoryById(d.value);return(s==null?void 0:s.count)||0}if(c.value){const s=r.getThemeBySlug(c.value);return(s==null?void 0:s.total_products)||0}return(t=(e=D.value)==null?void 0:e.totals)!=null&&t.products?D.value.totals.products:S.value.length});m(()=>Math.ceil(k.value/C.value));const j=m(()=>S.value),X=async()=>{var e,t;try{console.log("🚀 Inicializando catálogo...");const s=await r.initializeWooCommerce();s.success?console.log("✅ Catálogo inicializado:",{themes:((e=s.themes)==null?void 0:e.length)||0,products:((t=s.products)==null?void 0:t.length)||0,totalCategories:s.total_categories||0}):console.error("❌ Error inicializando catálogo:",s.error)}catch(s){console.error("Error al inicializar catálogo:",s)}},Y=e=>{c.value===e?(c.value="",d.value="",_()):(c.value=e,d.value="",u.value=1,_(),W(e))},Z=async e=>{c.value=e,d.value="",u.value=1,_(),await W(e)},W=async e=>{try{const t=await r.fetchProductsByTheme(e,9,1);t.success&&console.log(`✅ Productos de ${e} cargados:`,t.data.length)}catch(t){console.error("Error cargando productos del tema:",t)}},G=async e=>{d.value=e,u.value=1;const t=r.getCategoryById(e);t!=null&&t.has_subcategories&&(v.value.has(e)?v.value.delete(e):v.value.add(e),v.value=new Set(v.value)),_();try{const s=await r.fetchWooProductsByCategory(e,9,1);s.success&&console.log(`✅ Productos de categoría ${e} cargados:`,s.data.length)}catch(s){console.error("Error cargando productos de categoría:",s)}},M=async()=>{c.value="",d.value="",v.value.clear(),u.value=1,r.clearTheme(),r.clearSubcategory(),_(),console.log("🔄 Limpiando filtros, cargando productos generales...");const e=await r.fetchWooProducts({perPage:9,page:1});e.success&&console.log("✅ Productos generales cargados:",e.data.length)},ee=e=>{P.value=e.target.value,u.value=1},U=async e=>{if(!(e<1)){console.log(`📄 PAGINATION DEBUG - Cambiando a página ${e}, productos actuales en store:`,r.wooProducts.length),u.value=e,_();try{d.value?(console.log(`📄 PAGINATION DEBUG - Cargando página ${e} de categoría ${d.value}`),await r.fetchWooProductsByCategory(d.value,9,e)):c.value?(console.log(`📄 PAGINATION DEBUG - Cargando página ${e} de tema ${c.value}`),await r.fetchProductsByTheme(c.value,9,e)):(console.log(`📄 PAGINATION DEBUG - Cargando página ${e} de todos los productos`),await r.fetchWooProducts({perPage:9,page:e})),console.log(`📄 PAGINATION DEBUG - Después de cargar página ${e}, productos en store:`,r.wooProducts.length),console.log("📄 PAGINATION DEBUG - IDs de productos cargados:",r.wooProducts.map(t=>{var s;return`${t.id}-${(s=t.name)==null?void 0:s.substring(0,15)}`})),window.scrollTo({top:0,behavior:"smooth"})}catch(t){console.error("Error cambiando de página:",t)}}},te=e=>{const t=R.locale;L.push({name:`ProductDetail-${t}`,params:{id:e}})},se=async e=>{var t,s;console.log("🛒 Agregando al carrito desde ProductsView:",e.name);try{const a=parseFloat(e.converted_price||e.price)||0,g={name:e.name,price:a,image:((s=(t=e.images)==null?void 0:t[0])==null?void 0:s.src)||null,stock_status:e.stock_status,variation_id:null},$=await N.addToCart(e.id,1,g);$.success?(console.log("✅ Producto agregado al carrito exitosamente:",e.name),console.log("📦 Items en carrito ahora:",N.items.length)):(console.error("❌ Error al agregar al carrito:",$.error),alert(`Error al agregar ${e.name} al carrito: ${$.error}`))}catch(a){console.error("❌ Error inesperado al agregar al carrito:",a),alert(`Error inesperado al agregar ${e.name} al carrito`)}},oe=e=>{x.value.has(e)?x.value.delete(e):x.value.add(e),x.value=new Set(x.value)},ae=e=>{f.value.has(e)?f.value.delete(e):f.value.add(e),f.value=new Set(f.value)},re=e=>x.value.has(e),le=e=>f.value.has(e),ne=e=>F.isProductInFavorites(e),ie=async({productId:e,isFavorited:t})=>{console.log(`Producto ${e} ${t?"agregado a":"eliminado de"} favoritos`)};O(c,e=>{e&&r.selectTheme(e)}),O(d,e=>{e&&r.selectSubcategory(e)});const _=()=>{const e={};c.value&&(e.theme=c.value),d.value&&(e.category=d.value),u.value>1&&(e.page=u.value),L.replace({name:E.name,query:e})},de=async()=>{const{theme:e,category:t,page:s}=E.query;if(console.log("🔍 Restaurando estado desde URL:",{theme:e,category:t,page:s}),s&&(u.value=parseInt(s)||1),e&&(c.value=e,console.log("🔍 Tema restaurado:",e)),t){const a=parseInt(t);d.value=a,console.log("🔍 Categoría restaurada:",a);const g=await r.fetchWooProductsByCategory(a,9,u.value);g.success&&console.log(`✅ Productos de categoría ${a} cargados (página ${u.value}):`,g.data.length)}else if(e){const a=await r.fetchProductsByTheme(e,9,u.value);a.success&&console.log(`✅ Productos de tema ${e} cargados (página ${u.value}):`,a.data.length)}else if(s){const a=await r.fetchWooProducts({perPage:9,page:u.value});a.success&&console.log(`✅ Productos generales cargados (página ${u.value}):`,a.data.length)}};return me(async()=>{if(await X(),await de(),q.isLoggedIn){console.log("🔄 Cargando IDs de favoritos...");const e=await F.fetchFavoriteProductIds();e.success&&console.log("✅ IDs de favoritos cargados:",e.data.length)}}),(e,t)=>(n(),i("div",$e,[V(ke),o("div",Te,[o("div",Be,[o("div",Ie,[o("button",{onClick:M,class:"text-gray-600 hover:text-brand-pink-dark transition-colors"},l(e.$t("products.breadcrumb.home")),1),b.value||y.value?(n(),i("span",Se,">")):p("",!0),b.value?(n(),i("button",{key:1,onClick:t[0]||(t[0]=s=>Z(b.value.theme)),class:"text-gray-600 hover:text-brand-pink-dark transition-colors"},l(b.value.name),1)):p("",!0),y.value?(n(),i("span",Le,">")):p("",!0),y.value?(n(),i("span",Ee,l(y.value.name),1)):p("",!0)]),o("div",Fe,[o("aside",Ne,[o("div",Ae,[o("div",De,[o("h3",je,l(e.$t("products.filters.title")),1),t[5]||(t[5]=o("svg",{class:"w-5 h-5 md:w-6 md:h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1))]),o("div",We,[K.value?(n(),i("div",Ge,[t[6]||(t[6]=o("div",{class:"animate-spin rounded-full h-7 w-7 md:h-8 md:w-8 border-b-2 border-brand-blue-medium mx-auto"},null,-1)),o("p",Me,l(e.$t("products.filters.loadingCategories")),1)])):(n(),i("div",Ue,[o("div",Oe,[o("button",{onClick:M,class:w(["filter-button w-full flex items-center justify-between py-2.5 md:py-3 px-2.5 md:px-3 text-left transition-colors rounded-lg",!c.value&&!d.value?"bg-brand-pink-light":"hover:bg-gray-50"])},[o("span",Ve,l(e.$t("products.filters.allProducts")),1),!c.value&&!d.value?(n(),i("span",ze,"✓")):p("",!0)],2)]),(n(!0),i(T,null,B(J.value,s=>(n(),i("div",{key:s.theme,class:"filter-item mb-2 md:mb-3"},[o("button",{onClick:a=>Y(s.theme),class:w(["filter-button w-full flex items-center justify-between py-2.5 md:py-3 px-2.5 md:px-3 text-left transition-colors rounded-lg",c.value===s.theme?"bg-brand-pink-light":"hover:bg-gray-50"])},[o("div",Re,[o("div",null,[o("span",qe,l(s.name),1),o("span",Je,"("+l(s.total_products)+")",1)])]),(n(),i("svg",{class:w(["arrow w-4 h-4 md:w-5 md:h-5 text-gray-400 transition-transform",c.value===s.theme?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[7]||(t[7]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],10,He),c.value===s.theme?(n(),i("div",Ke,[(n(!0),i(T,null,B(s.categories,a=>(n(),i("div",{key:a.id},[o("button",{onClick:z(g=>G(a.id),["stop"]),class:w(["w-full flex items-center justify-between py-1.5 md:py-2 px-2.5 md:px-3 text-left transition-colors rounded-lg text-xs md:text-sm",d.value===a.id?"bg-purple-100 text-purple-700":"hover:bg-gray-100"])},[o("div",Xe,[o("span",null,l(a.name),1),o("span",Ye,"("+l(a.count)+")",1)]),o("div",Ze,[d.value===a.id?(n(),i("span",et,"✓")):p("",!0),a.has_subcategories?(n(),i("svg",{key:1,class:w(["w-3.5 h-3.5 md:w-4 md:h-4 text-gray-400 transition-transform",v.value.has(a.id)?"rotate-90":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[8]||(t[8]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)):p("",!0)])],10,Qe),a.has_subcategories&&v.value.has(a.id)?(n(),i("div",tt,[(n(!0),i(T,null,B(a.subcategories,g=>(n(),i("button",{key:g.id,onClick:z($=>G(g.id),["stop"]),class:w(["w-full flex items-center justify-between py-1.5 md:py-2 px-2.5 md:px-3 text-left transition-colors rounded-lg text-xs md:text-sm",d.value===g.id?"bg-purple-100 text-purple-700":"hover:bg-gray-100"])},[o("div",ot,[t[9]||(t[9]=o("span",{class:"text-gray-400 mr-1.5 md:mr-2 text-xs"},"└─",-1)),o("span",null,l(g.name),1),o("span",at,"("+l(g.count)+")",1)]),d.value===g.id?(n(),i("span",rt,"✓")):p("",!0)],10,st))),128))])):p("",!0)]))),128))])):p("",!0)]))),128))]))])])]),o("main",lt,[o("div",nt,[o("div",null,[o("h1",it,[o("span",null,l(Q.value),1)]),o("p",dt,l(e.$t("products.header.showing",{start:Math.min((u.value-1)*C.value+1,k.value),end:Math.min(u.value*C.value,k.value),total:k.value})),1)]),o("div",ct,[o("span",ut,l(e.$t("products.header.sortBy")),1),ge(o("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>P.value=s),onChange:ee,class:"sort-select bg-white border border-gray-300 rounded px-2.5 md:px-3 py-1.5 md:py-2 text-sm md:text-base text-gray-700 focus:outline-none focus:border-brand-pink-medium flex-1 md:flex-initial"},[o("option",mt,l(e.$t("products.header.sortOptions.mostPopular")),1),o("option",gt,l(e.$t("products.header.sortOptions.priceLowHigh")),1),o("option",pt,l(e.$t("products.header.sortOptions.priceHighLow")),1),o("option",vt,l(e.$t("products.header.sortOptions.newest")),1),o("option",ht,l(e.$t("products.header.sortOptions.bestRating")),1)],544),[[pe,P.value]])])]),o("div",xt,[I.value?(n(),i("div",ft,[t[10]||(t[10]=o("div",{class:"animate-spin rounded-full h-12 w-12 md:h-14 md:w-14 lg:h-16 lg:w-16 border-b-2 border-brand-blue-medium mx-auto mb-3 md:mb-4"},null,-1)),o("p",bt,l(e.$t("products.loading")),1)])):A.value?(n(),i("div",yt,[t[11]||(t[11]=o("div",{class:"text-red-500 mb-3 md:mb-4"},[o("svg",{class:"w-12 h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),o("p",_t,l(A.value),1),o("button",{onClick:t[2]||(t[2]=(...s)=>e.loadProducts&&e.loadProducts(...s)),class:"bg-brand-blue-medium text-white px-4 md:px-6 py-1.5 md:py-2 rounded-lg hover:bg-opacity-90 transition-colors text-sm md:text-base"},l(e.$t("products.retry")),1)])):j.value.length===0?(n(),i("div",wt,[t[12]||(t[12]=o("div",{class:"text-gray-400 mb-3 md:mb-4"},[o("svg",{class:"w-12 h-12 md:w-14 md:h-14 lg:w-16 lg:h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})])],-1)),o("p",kt,l(e.$t("products.noProducts")),1)])):(n(),i("div",Pt,[(n(!0),i(T,null,B(j.value,s=>(n(),xe(we,{key:s.id,product:s,"is-in-wishlist":re(s.id),"is-in-list":le(s.id),"is-in-favorites":ne(s.id),onNavigateToProduct:te,onAddToCart:se,onToggleWishlist:oe,onToggleList:ae,onFavoriteUpdated:ie},null,8,["product","is-in-wishlist","is-in-list","is-in-favorites"]))),128))])),k.value>0?(n(),i("div",Ct,[o("button",{onClick:t[3]||(t[3]=s=>U(u.value-1)),disabled:u.value===1||I.value,class:"px-3 md:px-4 py-1.5 md:py-2 border border-gray-300 rounded-lg text-sm md:text-base text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},l(e.$t("products.pagination.previous")),9,$t),o("div",Tt,[o("span",Bt,l(e.$t("products.pagination.page"))+" "+l(u.value),1)]),o("button",{onClick:t[4]||(t[4]=s=>U(u.value+1)),disabled:S.value.length<C.value||I.value,class:"px-3 md:px-4 py-1.5 md:py-2 border border-gray-300 rounded-lg text-sm md:text-base text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},l(e.$t("products.pagination.next")),9,It)])):p("",!0)])])])])]),V(Pe)]))}},Vt=Ce(St,[["__scopeId","data-v-a64a9d0d"]]);export{Vt as default};
