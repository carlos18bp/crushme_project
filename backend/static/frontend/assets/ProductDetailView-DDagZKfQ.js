import{I as Ne,J as Ue,K as We,L as xe,M as O,o as we,E as H,c as i,b as l,d as r,j as $,e as pe,t as n,g as D,F as S,i as V,k as N,s as Oe,u as Be,N as ze,r as k,l as m,C as je,O as He,f as x,p as Qe,z as Ke,m as Je}from"../index.js";import{u as Ge}from"./productStore-DGl72RrD.js";import{u as Xe}from"./cartStore-CDfjOPb9.js";import{u as Ye}from"./authStore-DVIAn0uN.js";import{u as Ze}from"./profileStore-B4Vmm1K_.js";import{N as et,F as tt}from"./Footer-BlMTS6Me.js";import{T as st,F as rt}from"./FAQ-C4tkLqWp.js";import{_ as at,H as ot,a as it}from"./ProductCard-BlrwzTCL.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";import"./transition-xy9MWKGA.js";import"./wishlistStore-BRMRVyY4.js";const fe=Ne("review",{state:()=>({productReviews:[],currentProductId:null,totalReviews:0,reviewStats:{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},currentReview:null,myReviews:[],totalMyReviews:0,hasReviewedProduct:!1,userProductReview:null,isLoadingReviews:!1,isLoadingStats:!1,isLoadingReviewDetail:!1,isLoadingMyReviews:!1,isCreatingReview:!1,isUpdatingReview:!1,isDeletingReview:!1,isCheckingReview:!1,reviewsError:null,statsError:null,reviewDetailError:null,myReviewsError:null,createError:null,updateError:null,deleteError:null,checkError:null}),getters:{getProductReviews:t=>t.productReviews,getTotalReviews:t=>t.totalReviews,getReviewStats:t=>t.reviewStats,getAverageRating:t=>t.reviewStats.average_rating,getRatingDistribution:t=>t.reviewStats.rating_distribution,getCurrentReview:t=>t.currentReview,getMyReviews:t=>t.myReviews,hasUserReviewed:t=>t.hasReviewedProduct,getUserProductReview:t=>t.userProductReview,isLoading:t=>t.isLoadingReviews||t.isLoadingStats||t.isLoadingReviewDetail||t.isLoadingMyReviews||t.isCreatingReview||t.isUpdatingReview||t.isDeletingReview||t.isCheckingReview,hasError:t=>t.reviewsError||t.statsError||t.reviewDetailError||t.myReviewsError||t.createError||t.updateError||t.deleteError||t.checkError},actions:{async fetchProductReviews(t,g=!0){var d,c;this.isLoadingReviews=!0,this.reviewsError=null,this.currentProductId=t;try{console.log(`ðŸ” Fetching reviews for product ${t}...`);const u=`reviews/product/${t}/?active_only=${g}`,y=await O(u);if(y.data.success)return this.productReviews=y.data.reviews||[],this.totalReviews=y.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalReviews} reviews for product ${t}`),{success:!0,data:y.data};throw new Error("Failed to fetch reviews")}catch(u){return console.error("âŒ Error fetching product reviews:",u),this.reviewsError=((c=(d=u.response)==null?void 0:d.data)==null?void 0:c.error)||u.message||"Error al cargar reseÃ±as",this.productReviews=[],this.totalReviews=0,{success:!1,error:this.reviewsError}}finally{this.isLoadingReviews=!1}},async fetchReviewStats(t){var g,d;this.isLoadingStats=!0,this.statsError=null;try{console.log(`ðŸ“Š Fetching review stats for product ${t}...`);const c=`reviews/product/${t}/stats/`,u=await O(c);if(u.data.success)return this.reviewStats=u.data.stats||{total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},console.log(`âœ… Loaded stats: ${this.reviewStats.average_rating} avg rating, ${this.reviewStats.total_reviews} reviews`),{success:!0,data:u.data};throw new Error("Failed to fetch review stats")}catch(c){return console.error("âŒ Error fetching review stats:",c),this.statsError=((d=(g=c.response)==null?void 0:g.data)==null?void 0:d.error)||c.message||"Error al cargar estadÃ­sticas",{success:!1,error:this.statsError}}finally{this.isLoadingStats=!1}},async fetchReviewDetail(t){var g,d;this.isLoadingReviewDetail=!0,this.reviewDetailError=null;try{console.log(`ðŸ” Fetching review detail ${t}...`);const c=`reviews/${t}/`,u=await O(c);if(u.data.success)return this.currentReview=u.data.review,console.log(`âœ… Loaded review detail for review ${t}`),{success:!0,data:u.data};throw new Error("Failed to fetch review detail")}catch(c){return console.error("âŒ Error fetching review detail:",c),this.reviewDetailError=((d=(g=c.response)==null?void 0:g.data)==null?void 0:d.error)||c.message||"Error al cargar detalle de reseÃ±a",this.currentReview=null,{success:!1,error:this.reviewDetailError}}finally{this.isLoadingReviewDetail=!1}},async checkUserReview(t){var g,d;this.isCheckingReview=!0,this.checkError=null;try{console.log(`ðŸ” Checking if user has reviewed product ${t}...`);const c=`reviews/product/${t}/check/`,u=await O(c);if(u.data.success)return this.hasReviewedProduct=u.data.has_reviewed,this.userProductReview=u.data.review,console.log(`âœ… User ${this.hasReviewedProduct?"has":"has not"} reviewed product ${t}`),{success:!0,has_reviewed:this.hasReviewedProduct,review:this.userProductReview};throw new Error("Failed to check user review")}catch(c){return console.error("âŒ Error checking user review:",c),this.checkError=((d=(g=c.response)==null?void 0:g.data)==null?void 0:d.error)||c.message||"Error al verificar reseÃ±a",this.hasReviewedProduct=!1,this.userProductReview=null,{success:!1,error:this.checkError}}finally{this.isCheckingReview=!1}},async fetchMyReviews(){var t,g;this.isLoadingMyReviews=!0,this.myReviewsError=null;try{console.log("ðŸ” Fetching user reviews...");const c=await O("reviews/user/my-reviews/");if(c.data.success)return this.myReviews=c.data.reviews||[],this.totalMyReviews=c.data.total_reviews||0,console.log(`âœ… Loaded ${this.totalMyReviews} user reviews`),{success:!0,data:c.data};throw new Error("Failed to fetch user reviews")}catch(d){return console.error("âŒ Error fetching user reviews:",d),this.myReviewsError=((g=(t=d.response)==null?void 0:t.data)==null?void 0:g.error)||d.message||"Error al cargar tus reseÃ±as",this.myReviews=[],this.totalMyReviews=0,{success:!1,error:this.myReviewsError}}finally{this.isLoadingMyReviews=!1}},async createReview(t){var g,d,c,u,y,w;this.isCreatingReview=!0,this.createError=null;try{console.log("ðŸ“ Creating new review...",t);const p=await xe("reviews/",t);if(p.data.success){const R=p.data.review;return R.woocommerce_product_id===this.currentProductId&&(this.productReviews.unshift(R),this.totalReviews++),R.is_user_review&&(this.myReviews.unshift(R),this.totalMyReviews++,this.hasReviewedProduct=!0,this.userProductReview=R),console.log("âœ… Review created successfully:",R.id),{success:!0,data:p.data,review:R}}else throw new Error(p.data.message||"Failed to create review")}catch(_){return console.error("âŒ Error creating review:",_),this.createError=((d=(g=_.response)==null?void 0:g.data)==null?void 0:d.errors)||((u=(c=_.response)==null?void 0:c.data)==null?void 0:u.error)||_.message||"Error al crear reseÃ±a",{success:!1,error:this.createError,errors:(w=(y=_.response)==null?void 0:y.data)==null?void 0:w.errors}}finally{this.isCreatingReview=!1}},async updateReview(t,g){var d,c,u,y,w,_,p,R;this.isUpdatingReview=!0,this.updateError=null;try{console.log(`ðŸ“ Updating review ${t}...`,g);const F=`reviews/${t}/update/`,L=await We(F,g);if(L.data.success){const f=L.data.review,E=this.productReviews.findIndex(T=>T.id===t);E!==-1&&(this.productReviews[E]=f);const P=this.myReviews.findIndex(T=>T.id===t);return P!==-1&&(this.myReviews[P]=f),((d=this.userProductReview)==null?void 0:d.id)===t&&(this.userProductReview=f),((c=this.currentReview)==null?void 0:c.id)===t&&(this.currentReview=f),console.log("âœ… Review updated successfully:",t),{success:!0,data:L.data,review:f}}else throw new Error(L.data.message||"Failed to update review")}catch(F){return console.error("âŒ Error updating review:",F),this.updateError=((y=(u=F.response)==null?void 0:u.data)==null?void 0:y.errors)||((_=(w=F.response)==null?void 0:w.data)==null?void 0:_.error)||F.message||"Error al actualizar reseÃ±a",{success:!1,error:this.updateError,errors:(R=(p=F.response)==null?void 0:p.data)==null?void 0:R.errors}}finally{this.isUpdatingReview=!1}},async deleteReview(t){var g,d,c,u;this.isDeletingReview=!0,this.deleteError=null;try{console.log(`ðŸ—‘ï¸ Deleting review ${t}...`);const y=`reviews/${t}/delete/`,w=await Ue(y);if(w.data.success){const _=w.data.woocommerce_product_id;return this.productReviews=this.productReviews.filter(p=>p.id!==t),this.totalReviews=Math.max(0,this.totalReviews-1),this.myReviews=this.myReviews.filter(p=>p.id!==t),this.totalMyReviews=Math.max(0,this.totalMyReviews-1),((g=this.userProductReview)==null?void 0:g.id)===t&&(this.userProductReview=null,this.hasReviewedProduct=!1),((d=this.currentReview)==null?void 0:d.id)===t&&(this.currentReview=null),console.log("âœ… Review deleted successfully:",t),{success:!0,data:w.data,productId:_}}else throw new Error(w.data.message||"Failed to delete review")}catch(y){return console.error("âŒ Error deleting review:",y),this.deleteError=((u=(c=y.response)==null?void 0:c.data)==null?void 0:u.error)||y.message||"Error al eliminar reseÃ±a",{success:!1,error:this.deleteError}}finally{this.isDeletingReview=!1}},clearErrors(){this.reviewsError=null,this.statsError=null,this.reviewDetailError=null,this.myReviewsError=null,this.createError=null,this.updateError=null,this.deleteError=null,this.checkError=null},clearProductReviews(){this.productReviews=[],this.totalReviews=0,this.currentProductId=null,this.reviewStats={total_reviews:0,average_rating:0,rating_distribution:{1:0,2:0,3:0,4:0,5:0}},this.hasReviewedProduct=!1,this.userProductReview=null},clearCurrentReview(){this.currentReview=null},clearMyReviews(){this.myReviews=[],this.totalMyReviews=0},resetStore(){this.clearProductReviews(),this.clearCurrentReview(),this.clearMyReviews(),this.clearErrors()}}}),lt={class:"product-reviews-section"},nt={class:"reviews-container"},ct={class:"reviews-header"},ut={class:"reviews-title"},dt={class:"reviews-count"},vt={class:"reviews-actions"},ht={class:"latest-button"},gt={class:"write-review-button"},pt={key:0,class:"loading-state"},wt={class:"loading-text"},_t={key:1,class:"error-state"},ft={class:"error-text"},mt={key:2,class:"empty-state"},yt={class:"empty-text"},Rt={key:3,class:"reviews-grid"},bt={class:"review-header"},kt={class:"review-stars"},$t=["onClick"],Et={class:"review-author"},Pt={class:"author-name"},Ct={key:0,class:"verified-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},St={key:0,class:"review-title"},Dt={class:"review-text"},Ft={class:"review-date"},Lt={key:4,class:"load-more-container"},Tt={class:"load-more-button"},qt={__name:"ProductReviews",props:{productId:{type:[Number,String],required:!0}},setup(t){const g=t,d=fe(),c=async()=>{g.productId&&(console.log(`ðŸ”„ Loading reviews for product ${g.productId}...`),await Promise.all([d.fetchProductReviews(g.productId,!0),d.fetchReviewStats(g.productId)]))},u=w=>{if(!w)return"";const _=new Date(w),p={year:"numeric",month:"long",day:"numeric"};return _.toLocaleDateString("es-ES",p)},y=w=>{console.log("Review menu clicked:",w)};return we(()=>{c()}),H(()=>g.productId,w=>{w&&c()}),(w,_)=>(l(),i("section",lt,[r("div",nt,[r("div",ct,[r("h2",ut,[pe(n(w.$t("productReviews.title"))+" ",1),r("span",dt,"("+n(D(d).getTotalReviews)+")",1)]),r("div",vt,[r("button",ht,[pe(n(w.$t("productReviews.latest"))+" ",1),_[0]||(_[0]=r("svg",{class:"dropdown-icon",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))]),r("button",gt,n(w.$t("productReviews.writeReview")),1)])]),D(d).isLoadingReviews?(l(),i("div",pt,[_[1]||(_[1]=r("div",{class:"loading-spinner"},null,-1)),r("p",wt,n(w.$t("productReviews.loading")),1)])):D(d).reviewsError?(l(),i("div",_t,[r("p",ft,n(D(d).reviewsError),1),r("button",{onClick:c,class:"retry-button"},n(w.$t("productReviews.retry")),1)])):D(d).getTotalReviews===0?(l(),i("div",mt,[r("p",yt,n(w.$t("productReviews.noReviews")),1)])):(l(),i("div",Rt,[(l(!0),i(S,null,V(D(d).getProductReviews,p=>(l(),i("div",{key:p.id,class:N(["review-card",{highlighted:p.is_user_review}])},[r("div",bt,[r("div",kt,[(l(),i(S,null,V(5,R=>r("span",{key:R,class:N(["star",{filled:R<=p.rating}])}," â˜… ",2)),64))]),p.is_user_review?(l(),i("button",{key:0,class:"review-menu-button",onClick:R=>y(p.id)},[..._[2]||(_[2]=[r("span",null,"â‹¯",-1)])],8,$t)):$("",!0)]),r("div",Et,[r("span",Pt,n(p.reviewer_name),1),p.is_verified_purchase?(l(),i("svg",Ct,[..._[3]||(_[3]=[r("path",{"fill-rule":"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z","clip-rule":"evenodd"},null,-1)])])):$("",!0)]),p.title?(l(),i("h4",St,n(p.title),1)):$("",!0),r("p",Dt,n(p.comment),1),r("p",Ft,n(w.$t("productReviews.postedOn"))+" "+n(u(p.created_at)),1)],2))),128))])),D(d).getTotalReviews>0?(l(),i("div",Lt,[r("button",Tt,n(w.$t("productReviews.loadMore")),1)])):$("",!0)])]))}},Mt=_e(qt,[["__scopeId","data-v-6c17376b"]]),Vt={class:"product-detail-container"},At={class:"main-content"},It={class:"product-detail-view"},Nt={key:0,class:"loading-container"},Ut={key:1,class:"error-container"},Wt={key:2,class:"product-content"},xt={class:"product-layout"},Ot={class:"product-gallery"},Bt={class:"thumbnail-selector"},zt=["disabled"],jt=["onClick"],Ht=["src","alt"],Qt=["disabled"],Kt={class:"main-image-container"},Jt=["src","alt"],Gt={class:"product-info"},Xt={class:"flex items-center justify-between gap-4 mb-4"},Yt={class:"product-title flex-1"},Zt=["disabled","title"],es=["src"],ts={class:"product-reviews"},ss={class:"stars"},rs={key:0,class:"rating-text"},as={key:1,class:"rating-count"},os={key:2,class:"rating-count"},is={class:"product-price"},ls={key:0,class:"sale-badge"},ns={class:"flex items-baseline gap-2"},cs={class:"current-price"},us={class:"text-sm text-gray-500 font-poppins"},ds={key:1,class:"regular-price"},vs={key:0,class:"sale-badge"},hs={class:"flex items-baseline gap-2"},gs={class:"current-price"},ps={class:"text-sm text-gray-500 font-poppins"},ws={key:1,class:"regular-price"},_s={key:0,class:"product-description"},fs=["innerHTML"],ms={key:1,class:"product-options-container"},ys={class:"attribute-selector"},Rs=["onClick"],bs={class:"attribute-selector"},ks=["onClick"],$s={class:"product-actions"},Es={class:"quantity-selector"},Ps=["disabled"],Cs=["disabled"],Ss=["disabled"],Ds={class:"action-buttons-row"},Fs=["disabled"],Ls={key:0,class:"loading-text"},Ts={key:1},qs=["disabled"],Ms={key:0,class:"loading-text"},Vs={key:1},As={key:2,class:"whitespace-nowrap"},Is={key:3,class:"cart-error-message"},Ns={class:"attribute-info"},Us={class:"info-value"},Ws={key:3,class:"not-found-container"},xs={__name:"ProductDetailView",props:{id:{type:String,required:!0}},setup(t){const g=je(),d=Je(),{t:c}=Oe(),u=Ge(),y=Xe(),w=Ye(),_=Be(),p=fe(),R=ze(),F=Ze(),L=k(0),f=k({}),E=k(1),P=k(!1),T=k(!1),B=k(null),A=k(0),j=k(5),Q=k(null),K=k(!1),z=k(!1),J=k(!1),C=k(null),G=k(!1),U=k(null),M=m(()=>g.params.id),a=m(()=>u.wooCurrentProduct),me=m(()=>u.isLoadingWooProduct),se=m(()=>u.wooError),X=m(()=>{var e;return p.getAverageRating>0?parseFloat(p.getAverageRating):(e=a.value)!=null&&e.average_rating?parseFloat(a.value.average_rating):0}),Y=m(()=>{var e;return p.getTotalReviews>0?p.getTotalReviews:(e=a.value)!=null&&e.rating_count?a.value.rating_count:0}),ye=m(()=>!a.value||!a.value.images||a.value.images.length===0?[{src:"https://images.unsplash.com/photo-1583394838336-acd977736f90?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&h=500&fit=crop&crop=center"},{src:"https://images.unsplash.com/photo-1519947486511-46149fa0a254?w=500&h=500&fit=crop&crop=center"}]:a.value.images),I=m(()=>$e.value),Re=m(()=>{var e,s;return((e=I.value[L.value])==null?void 0:e.src)||((s=I.value[0])==null?void 0:s.src)});m(()=>{var e;if(!((e=a.value)!=null&&e.short_description))return"";if(ke.value){let s=a.value.short_description;return s=s.replace(/<h[3-5][^>]*>.*?(?:Precio sugerido|precio sugerido).*?<\/h[3-5]>/gi,""),s=s.replace(/<(?:span|div)[^>]*>\s*\$[\d,.]+\s*<\/(?:span|div)>/gi,""),s.trim()}return a.value.short_description});const be=m(()=>{var o;if(!((o=a.value)!=null&&o.description))return!1;if(!a.value.short_description)return!0;const e=a.value.short_description.replace(/<[^>]*>/g,"").trim(),s=a.value.description.replace(/<[^>]*>/g,"").trim();return e!==s&&s.length>e.length}),ke=m(()=>a.value&&a.value.type==="simple"),b=m(()=>a.value&&a.value.type==="variable"),h=m(()=>u.wooCurrentVariation),re=m(()=>{var e;return(e=a.value)!=null&&e.attributes?a.value.attributes.map(s=>({id:s.slug||s.name,name:s.name,slug:s.slug,options:s.options||[],variation:!0})).reverse():[]}),W=m(()=>{var e;return((e=a.value)==null?void 0:e.available_variations)||[]}),$e=m(()=>{var e;if(b.value&&h.value){if(h.value.images&&h.value.images.length>0)return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes mÃºltiples de variaciÃ³n:",h.value.images.length),h.value.images;if(h.value.image){console.log("ðŸ–¼ï¸ [ProductDetail] Usando imagen Ãºnica de variaciÃ³n:",h.value.image);const s=typeof h.value.image=="string"?h.value.image:h.value.image.src;if(s)return[{src:s,thumbnail:s,alt:((e=a.value)==null?void 0:e.name)||"Product variation"}]}}return console.log("ðŸ–¼ï¸ [ProductDetail] Usando imÃ¡genes del producto base"),ye.value}),ae=m(()=>{if(!a.value)return"$0";let e=0,s=!1;return b.value&&h.value?(e=parseFloat(h.value.converted_price||h.value.price)||0,s=h.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] VariaciÃ³n - Precio: $${e}, En oferta: ${s}`)):(e=parseFloat(a.value.converted_price||a.value.price)||0,s=a.value.on_sale||!1,console.log(`ðŸ’° [ProductDetail] Producto - Precio: $${e}, En oferta: ${s}`)),`$${e.toLocaleString("es-CO")}`}),Ee=m(()=>{var e;return a.value?b.value&&((e=h.value)!=null&&e.price)?parseFloat(h.value.converted_price||h.value.price)||0:parseFloat(a.value.converted_price||a.value.price)||0:0}),oe=m(()=>{if(b.value){if(h.value)return h.value.stock_status==="instock"&&(h.value.stock_quantity===null||h.value.stock_quantity>0);if(W.value.length>0){const e=ve();if(e)return e.in_stock&&e.stock_quantity>0}return!1}return C.value&&!b.value?C.value.available&&C.value.status==="instock":a.value?a.value.stock_status==="instock"&&a.value.in_stock:!1}),ie=m(()=>{var e;return(e=a.value)!=null&&e.attributes?a.value.attributes.filter(s=>{const o=s.name.toLowerCase();return!o.includes("color")&&!o.includes("colour")&&!o.includes("cor")&&!o.includes("size")&&!o.includes("talla")&&!o.includes("tamaÃ±o")}):[]}),le=m(()=>ie.value.filter(e=>e.variation===!0)),Pe=m(()=>ie.value.filter(e=>e.variation===!1)),ne=async e=>{if(a.value){console.log(`ðŸ”„ Cargando detalle completo de variaciÃ³n ${e}`);try{const s=await u.fetchWooProductVariation(a.value.id,e);s.success&&s.data&&(console.log(`âœ… VariaciÃ³n ${e} cargada con detalle completo:`,{id:s.data.id,price:s.data.price,stock_quantity:s.data.stock_quantity,stock_status:s.data.stock_status,image:s.data.image,attributes:s.data.attributes}),L.value=0)}catch(s){console.error(`âŒ Error cargando variaciÃ³n ${e}:`,s)}}},ce=async()=>{if(!(!M.value||G.value)){if(b.value){console.log("ðŸ“¦ Producto variable detectado - stock se maneja por variaciÃ³n"),C.value={status:"variable",requires_variation_selection:!0,available:!0};return}G.value=!0;try{console.log(`ðŸ“¦ Consultando stock en tiempo real para producto ${M.value}...`);const e=await O(`products/woocommerce/products/${M.value}/stock/`);e.data.success&&(C.value=e.data.stock,console.log("âœ… Stock actualizado:",{status:C.value.status,quantity:C.value.quantity,available:C.value.available,source:e.data.source}),a.value&&!b.value&&(a.value.stock_status=C.value.status,a.value.stock_quantity=C.value.quantity,a.value.in_stock=C.value.in_stock))}catch(e){console.error("âŒ Error consultando stock en tiempo real:",e),a.value&&(C.value={status:a.value.stock_status,quantity:a.value.stock_quantity,manage_stock:a.value.manage_stock,in_stock:a.value.in_stock,available:a.value.stock_status==="instock"})}finally{G.value=!1}}},Ce=()=>{U.value&&clearInterval(U.value),U.value=setInterval(()=>{ce()},3e4),console.log("â° Polling de stock iniciado (cada 30 segundos)")},ue=()=>{U.value&&(clearInterval(U.value),U.value=null,console.log("â° Polling de stock detenido"))},Se=async()=>{if(!b.value||W.value.length===0)return;console.log("ðŸŽ¯ Preseleccionando primera variaciÃ³n...");const e=W.value[0];f.value={...e.attributes},console.log("ðŸ“‹ Atributos preseleccionados:",f.value),u.setWooCurrentVariation({id:e.id,price:e.price,stock_status:e.in_stock?"instock":"outofstock",stock_quantity:e.stock_quantity,attributes:e.attributes,image:e.image||null}),console.log(`âœ… Primera variaciÃ³n preseleccionada: ID ${e.id}, Precio: $${e.price}`),await ne(e.id)},Z=async()=>{var e;if(M.value){console.log(`ðŸ›ï¸ Cargando producto ID: ${M.value}`);try{const s=await u.fetchWooProduct(M.value);s.success?(console.log("âœ… Producto cargado:",s.data.name),s.data.type==="variable"&&(console.log(`ðŸ“¦ Producto variable con ${s.data.variations_count} variaciones`),console.log("âœ… available_variations ya incluidas:",((e=s.data.available_variations)==null?void 0:e.length)||0),Se()),await ce(),Ce()):console.error("âŒ Error cargando producto:",s.error)}catch(s){console.error("âŒ Error inesperado:",s)}}},De=e=>{L.value=e},Fe=()=>{A.value>0&&(A.value--,de())},Le=()=>{A.value<I.value.length-j.value&&(A.value++,de())},de=()=>{if(Q.value){const e=A.value*78;Q.value.scrollTop=e}},ve=()=>{if(!b.value||W.value.length===0)return console.warn("âš ï¸ No hay producto variable o no hay variaciones disponibles"),null;console.log("ðŸ” Buscando variaciÃ³n con atributos seleccionados:",f.value),console.log("ðŸ“¦ Variaciones disponibles:",W.value);const e=W.value.find(s=>{console.log(`ðŸ”Ž Comparando con variaciÃ³n ${s.id}:`,s.attributes);const o=Object.keys(f.value).every(v=>{const q=f.value[v],te=s.attributes[v];return console.log(`  - Atributo "${v}": seleccionado="${q}", variaciÃ³n="${te}", match=${te===q}`),te===q});return console.log(`  â†’ VariaciÃ³n ${s.id} ${o?"âœ… COINCIDE":"âŒ NO coincide"}`),o});return e?console.log("âœ… VariaciÃ³n encontrada:",e.id):console.error("âŒ No se encontrÃ³ variaciÃ³n que coincida con:",f.value),e},he=async(e,s)=>{if(f.value={...f.value,[e]:s},console.log(`ðŸŽ¯ Atributo seleccionado: ${e} = ${s}`),console.log("ðŸ“‹ Atributos seleccionados:",f.value),b.value){const o=ve();o?(console.log("âœ… VariaciÃ³n encontrada en available_variations:",o.id),console.log("ðŸ’° Precio de variaciÃ³n:",o.price),console.log("ðŸ–¼ï¸ Imagen de variaciÃ³n:",o.image),u.setWooCurrentVariation({id:o.id,price:o.price,stock_status:o.in_stock?"instock":"outofstock",stock_quantity:o.stock_quantity,attributes:o.attributes,image:o.image||null}),await ne(o.id)):(console.warn("âš ï¸ No se encontrÃ³ variaciÃ³n con esos atributos"),u.setWooCurrentVariation(null))}},ee=e=>{const o=`productDetail.attributes.${e.toLowerCase()}`,v=c(o);return v===o?e:v},Te=()=>{E.value<99&&E.value++},qe=()=>{E.value>1&&E.value--},ge=async()=>{var e,s,o;if(!(!a.value||P.value)){T.value=!1,B.value=null,P.value=!0;try{const v={name:a.value.name,price:Ee.value,image:((s=(e=a.value.images)==null?void 0:e[0])==null?void 0:s.src)||null,stock_status:a.value.stock_status};b.value&&h.value&&(v.variation_id=h.value.id,(o=h.value.image)!=null&&o.src&&(v.image=h.value.image.src),console.log(`ðŸ“¦ Producto variable - VariaciÃ³n ID: ${h.value.id}`)),Object.keys(f.value).length>0&&(v.attributes=f.value),console.log("ðŸ›’ Agregando al carrito:",{productId:a.value.id,variationId:v.variation_id||null,quantity:E.value,options:v});const q=await y.addToCart(a.value.id,E.value,v);q.success?(T.value=!0,console.log("âœ… Producto agregado al carrito exitosamente"),setTimeout(()=>{T.value=!1},3e3),E.value=1):(B.value=q.error||"Error al agregar al carrito",console.error("âŒ Error al agregar al carrito:",q.error))}catch(v){B.value="Error inesperado al agregar al carrito",console.error("âŒ Error inesperado:",v)}finally{P.value=!1}}},Me=async()=>{!a.value||P.value||(await ge(),T.value&&d.push({name:`Checkout-${_.locale}`}))},Ve=async()=>{if(!w.isLoggedIn){d.push({name:`Login-${_.locale}`});return}J.value=!0;try{z.value?(await F.removeProductFromFavorites(a.value.id)).success&&(z.value=!1):(await F.addProductToFavorites(a.value.id)).success&&(z.value=!0)}catch(e){console.error("Error toggling favorite:",e)}finally{J.value=!1}},Ae=e=>{console.log(`Product ${a.value.id} added to wishlist ${e}`)},Ie=()=>{K.value=!1,d.push({name:`ProfileWishlist-${_.locale}`})};return we(()=>{Z()}),He(()=>{ue()}),H(h,e=>{if(e&&e.attributes&&e.attributes.length>0){console.log("ðŸ”„ Inicializando atributos con variaciÃ³n:",e.id);const s={};e.attributes.forEach(o=>{s[o.name]=o.option,console.log(`âœ… Atributo "${o.name}" = "${o.option}"`)}),f.value=s}}),H(M,(e,s)=>{e&&e!==s&&(console.log(`ðŸ”„ Cambio de producto detectado: ${s} â†’ ${e}`),ue(),C.value=null,f.value={},u.setWooCurrentVariation(null),Z())}),H(a,(e,s)=>{if(e&&(s&&e.id!==s.id&&(console.log("ðŸ”„ Cambio de producto detectado, limpiando variaciones"),u.clearWooVariations(),f.value={}),A.value=0,L.value=0,!b.value)){const o={...f.value};le.value.forEach(v=>{v.options&&v.options.length>0&&!o[v.name]&&(o[v.name]=v.options[0])}),f.value=o}},{immediate:!0}),(e,s)=>(l(),i("div",Vt,[x(et),r("main",At,[r("div",It,[me.value?(l(),i("div",Nt,[s[2]||(s[2]=r("div",{class:"loading-spinner"},null,-1)),r("p",null,n(e.$t("productDetail.loading")),1)])):se.value?(l(),i("div",Ut,[r("h2",null,n(e.$t("productDetail.error.title")),1),r("p",null,n(se.value),1),r("button",{onClick:Z,class:"retry-btn"},n(e.$t("productDetail.error.retry")),1)])):a.value?(l(),i("div",Wt,[r("div",xt,[r("div",Ot,[r("div",Bt,[I.value.length>j.value?(l(),i("button",{key:0,onClick:Fe,disabled:A.value===0,class:"thumbnail-nav-btn thumbnail-nav-up"}," â–² ",8,zt)):$("",!0),r("div",{class:"thumbnail-list",ref_key:"thumbnailList",ref:Q},[(l(!0),i(S,null,V(I.value,(o,v)=>(l(),i("div",{key:v,class:N(["thumbnail",{active:L.value===v}]),onClick:q=>De(v)},[r("img",{src:o.src,alt:`${a.value.name} - imagen ${v+1}`},null,8,Ht)],10,jt))),128))],512),I.value.length>j.value?(l(),i("button",{key:1,onClick:Le,disabled:A.value>=I.value.length-j.value,class:"thumbnail-nav-btn thumbnail-nav-down"}," â–¼ ",8,Qt)):$("",!0)]),r("div",Kt,[r("img",{src:Re.value,alt:a.value.name,class:"main-image"},null,8,Jt)])]),r("div",Gt,[r("div",Xt,[r("h1",Yt,n(a.value.name),1),r("button",{onClick:Ve,disabled:J.value,class:"favorite-icon-btn-header",title:z.value?e.$t("productDetail.removeFromFavorites"):e.$t("productDetail.addToFavorites")},[r("img",{src:z.value?D(ot):D(it),alt:"Favorite icon",class:"w-6 h-6"},null,8,es)],8,Zt)]),r("div",ts,[r("div",ss,[(l(),i(S,null,V(5,o=>r("span",{key:o,class:N(["star",{filled:o<=Math.floor(X.value)}])},"â˜…",2)),64)),X.value>0?(l(),i("span",rs,n(X.value.toFixed(1))+"/5",1)):$("",!0),Y.value>0?(l(),i("span",as,"("+n(Y.value)+" "+n(Y.value===1?e.$t("productReviews.review"):e.$t("productReviews.reviews"))+")",1)):(l(),i("span",os,"("+n(e.$t("productReviews.reviewCount.none"))+")",1))])]),r("div",is,[b.value&&h.value?(l(),i(S,{key:0},[h.value.on_sale?(l(),i("span",ls,n(e.$t("productDetail.saleBadge")||"SALE"),1)):$("",!0),r("div",ns,[r("span",cs,n(ae.value),1),r("span",us,n(D(R).currentCurrency),1)]),h.value.on_sale&&h.value.regular_price?(l(),i("span",ds," $"+n(parseFloat(h.value.converted_regular_price||h.value.regular_price).toLocaleString("es-CO")),1)):$("",!0)],64)):(l(),i(S,{key:1},[a.value.on_sale?(l(),i("span",vs,n(e.$t("productDetail.saleBadge")||"SALE"),1)):$("",!0),r("div",hs,[r("span",gs,n(ae.value),1),r("span",ps,n(D(R).currentCurrency),1)]),a.value.on_sale&&a.value.regular_price?(l(),i("span",ws," $"+n(parseFloat(a.value.converted_regular_price||a.value.regular_price).toLocaleString("es-CO")),1)):$("",!0)],64))]),be.value?(l(),i("div",_s,[r("div",{innerHTML:a.value.description},null,8,fs)])):$("",!0),b.value&&re.value.length>0?(l(),i("div",ms,[(l(!0),i(S,null,V(re.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(ee(o.name)),1),r("div",ys,[(l(!0),i(S,null,V(o.options,v=>(l(),i("button",{key:v,class:N(["attribute-option",{active:f.value[o.name]===v}]),onClick:q=>he(o.name,v)},n(v),11,Rs))),128))])]))),128))])):$("",!0),b.value?$("",!0):(l(!0),i(S,{key:2},V(le.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(ee(o.name)),1),r("div",bs,[(l(!0),i(S,null,V(o.options,v=>(l(),i("button",{key:v,class:N(["attribute-option",{active:f.value[o.name]===v}]),onClick:q=>he(o.name,v)},n(v),11,ks))),128))])]))),128)),r("div",$s,[r("div",Es,[r("button",{onClick:qe,disabled:E.value<=1||P.value,class:"quantity-btn"},"-",8,Ps),Qe(r("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>E.value=o),type:"number",min:"1",max:"99",class:"quantity-input",disabled:P.value},null,8,Cs),[[Ke,E.value,void 0,{number:!0}]]),r("button",{onClick:Te,disabled:E.value>=99||P.value,class:"quantity-btn"},"+",8,Ss)]),r("div",Ds,[r("button",{onClick:Me,disabled:!oe.value||P.value,class:"buy-now-btn"},[P.value?(l(),i("span",Ls,"â³")):(l(),i("span",Ts,n(e.$t("productDetail.buyNow")),1))],8,Fs),r("button",{onClick:ge,disabled:!oe.value||P.value,class:N(["add-to-cart-btn",{success:T.value}])},[P.value?(l(),i("span",Ms,"â³")):T.value?(l(),i("span",Vs,"âœ“ "+n(e.$t("productDetail.addedToCart")),1)):(l(),i("span",As,n(e.$t("productDetail.addToCart")),1))],10,qs)])]),x(at,{show:K.value,"product-id":a.value.id,onClose:s[1]||(s[1]=o=>K.value=!1),onAdded:Ae,onCreateWishlist:Ie},null,8,["show","product-id"]),B.value?(l(),i("div",Is,n(B.value),1)):$("",!0),(l(!0),i(S,null,V(Pe.value,o=>(l(),i("div",{key:o.id,class:"product-options"},[r("h4",null,n(ee(o.name)),1),r("div",Ns,[r("span",Us,n(o.options.join(", ")),1)])]))),128))])])])):(l(),i("div",Ws,[r("h2",null,n(e.$t("productDetail.notFound.title")),1),r("p",null,n(e.$t("productDetail.notFound.message",{id:M.value})),1)]))]),x(Mt,{"product-id":M.value},null,8,["product-id"]),x(st),x(rt)]),x(tt)]))}},er=_e(xs,[["__scopeId","data-v-abe6eb69"]]);export{er as default};
