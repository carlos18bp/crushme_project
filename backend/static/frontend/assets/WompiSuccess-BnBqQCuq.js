import{N as C,u as N,r as a,o as W,c as n,b as l,d as e,e as d,t as c,m as x}from"../index.js";import{u as D}from"./cartStore-CDfjOPb9.js";import{u as M}from"./paymentStore-CO13-aiz.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"wompi-success-view"},T={class:"success-container"},V={key:0,class:"loading-state"},B={key:1,class:"success-state"},L={class:"order-details"},U={class:"order-number"},H={class:"order-total"},$={class:"order-email"},F={key:2,class:"error-state"},J={class:"error-message"},j={__name:"WompiSuccess",setup(q){const m=x(),w=D(),p=M(),I=C(),v=N(),i=a(!0),t=a(!1),f=a(""),g=a(0),_=a(""),u=a(""),b=r=>I.formatPrice(r);function k(){m.push({name:`Home-${v.locale}`})}function h(){m.push({name:`Checkout-${v.locale}`})}async function E(){i.value=!0,t.value=!1,u.value="",await y()}async function y(){try{const o=new URLSearchParams(window.location.search).get("id");if(!o)throw new Error("No se encontr√≥ el ID de transacci√≥n en la URL");console.log("‚úÖ [WOMPI] Transaction ID desde URL:",o);const P=localStorage.getItem("wompi_order_data");if(!P)throw new Error("No se encontraron los datos de la orden. Por favor vuelve al checkout.");const S=JSON.parse(P);console.log("üì¶ [WOMPI] Datos de orden recuperados:",S);const s=await p.confirmWompiPayment(o,S);if(s.success)console.log("‚úÖ [WOMPI] Pago confirmado exitosamente:",s.order),t.value=!0,f.value=s.order.order_number,g.value=parseFloat(s.order.total),_.value=s.order.email,localStorage.removeItem("wompi_transaction_id"),localStorage.removeItem("wompi_order_data"),sessionStorage.removeItem("checkout_order_data"),w.clearCart(),p.clearPaymentState();else throw new Error(s.error||"Error al confirmar el pago")}catch(r){console.error("‚ùå [WOMPI] Error al confirmar pago:",r),t.value=!1,u.value=r.message||"Error al verificar el pago. Por favor contacta a soporte."}finally{i.value=!1}}return W(async()=>{await y()}),(r,o)=>(l(),n("div",O,[e("div",T,[i.value?(l(),n("div",V,[...o[0]||(o[0]=[e("div",{class:"spinner"},null,-1),e("h2",null,"Verificando tu pago...",-1),e("p",null,"Por favor espera mientras confirmamos tu transacci√≥n",-1)])])):t.value?(l(),n("div",B,[o[4]||(o[4]=e("div",{class:"success-icon"},"‚úÖ",-1)),o[5]||(o[5]=e("h2",null,"¬°Pago Exitoso!",-1)),e("div",L,[e("p",U,[o[1]||(o[1]=d("N√∫mero de orden: ",-1)),e("strong",null,c(f.value),1)]),e("p",H,[o[2]||(o[2]=d("Total: ",-1)),e("strong",null,c(b(g.value)),1)]),e("p",$,[o[3]||(o[3]=d("Recibir√°s un email de confirmaci√≥n en: ",-1)),e("strong",null,c(_.value),1)])]),e("button",{onClick:k,class:"btn-primary"},"Ir al inicio")])):(l(),n("div",F,[o[6]||(o[6]=e("div",{class:"error-icon"},"‚ùå",-1)),o[7]||(o[7]=e("h2",null,"Error en el Pago",-1)),e("p",J,c(u.value),1),e("div",{class:"error-actions"},[e("button",{onClick:h,class:"btn-secondary"},"Volver al checkout"),e("button",{onClick:E,class:"btn-primary"},"Reintentar verificaci√≥n")])]))])]))}},Q=R(j,[["__scopeId","data-v-b5ad48b6"]]);export{Q as default};
