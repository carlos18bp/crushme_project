import{u as M,p as T,r as k,q as K,i as $,j as N,A as P,c as u,o as f,a as i,d as U,t as v,s as j,F as H,g as Z,b as z,B as G,k as J,v as O,x as Q}from"../index.js";import{u as W}from"./authStore-tY-7-Xic.js";import{L as X}from"./LanguageSelector-vuDdTwQ1.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./constants-DjCFsGER.js";const x={class:"verification-view"},ee={class:"verification-container"},te={class:"verification-card"},oe={class:"welcome-section"},se={class:"welcome-title"},ie={class:"welcome-subtitle"},re={class:"code-input-container"},ae=["onUpdate:modelValue","placeholder","onInput","onKeydown"],ne=["disabled"],ce={key:0},le={key:1,class:"loading-spinner"},de={class:"resend-section"},ue={class:"resend-text"},fe=["disabled"],ve={key:0},pe={key:1},me={key:2},he={__name:"VerificationView",setup(_e){const D=J(),_=G(),I=W(),b=M(),{t:a}=T(),l=k([]),r=K(["","","",""]),y=k(!1),g=k(!1),p=k(0);let w=null;const C=$(()=>r.every(e=>e.length===1)),V=$(()=>r.join("")),R=(e,t)=>{var o;const n=t.target.value;if(!/^\d*$/.test(n)){r[e]="";return}r[e]=n,n&&e<3&&((o=l.value[e+1])==null||o.focus())},B=(e,t)=>{var n,o,s;t.key==="Backspace"&&!r[e]&&e>0&&((n=l.value[e-1])==null||n.focus()),t.key==="ArrowLeft"&&e>0&&((o=l.value[e-1])==null||o.focus()),t.key==="ArrowRight"&&e<3&&((s=l.value[e+1])==null||s.focus())},E=e=>{var h;e.preventDefault(),e.clipboardData.getData("text").replace(/\D/g,"").slice(0,4).split("").forEach((d,c)=>{c<4&&(r[c]=d)});const o=r.findIndex(d=>!d),s=o!==-1?o:3;(h=l.value[s])==null||h.focus()},S=()=>C.value?V.value.length!==4?(alert(a("verification.validation.codeLength")),!1):!0:(alert(a("verification.validation.codeRequired")),!1),q=async()=>{var e,t,n,o,s,h;y.value=!0;try{if(!S())return;const d=_.query.email||_.params.email,c=await I.verifyEmail({email:d,verification_code:V.value});if(c.success)D.push({path:`/${b.locale}/confirmation`,query:{title:a("verification.success.title"),message:a("verification.success.message"),primaryActionText:a("verification.success.actionButton"),primaryActionRoute:`/${b.locale}/profile`,autoRedirect:"true",redirectDelay:"3",redirectTo:`/${b.locale}/profile`}});else{let m=a("verification.errors.verificationFailed");(e=c.error)!=null&&e.includes("invalid")||(t=c.error)!=null&&t.includes("Invalid")?m=a("verification.errors.invalidCode"):(n=c.error)!=null&&n.includes("expired")||(o=c.error)!=null&&o.includes("Expired")?m=a("verification.errors.codeExpired"):m+=c.error,alert(m),r.forEach((ye,L)=>{r[L]=""}),(s=l.value[0])==null||s.focus()}}catch(d){console.error("Verification error:",d),alert(a("verification.errors.verificationFailed")+(d.message||"Error desconocido")),r.forEach((c,m)=>{r[m]=""}),(h=l.value[0])==null||h.focus()}finally{y.value=!1}},A=async()=>{g.value=!0;try{const e=_.query.email||_.params.email,t=await I.resendVerificationCode(e);t.success?(alert(a("verification.resendSuccess")),F()):alert(a("verification.errors.resendFailed")+t.error)}catch(e){console.error("Resend error:",e),alert(a("verification.errors.resendFailed")+(e.message||"Error desconocido"))}finally{g.value=!1}},F=()=>{p.value=60,w=setInterval(()=>{p.value--,p.value<=0&&clearInterval(w)},1e3)};return N(()=>{var e;(e=l.value[0])==null||e.focus()}),P(()=>{w&&clearInterval(w)}),(e,t)=>(f(),u("div",x,[t[2]||(t[2]=i("div",{class:"background-container"},[i("div",{class:"background-overlay"})],-1)),U(X,{position:"absolute",theme:"light"}),i("div",ee,[i("div",te,[i("div",oe,[i("h2",se,v(e.$t("verification.title")),1),i("p",ie,v(e.$t("verification.subtitle")),1)]),i("form",{onSubmit:j(q,["prevent"]),class:"verification-form"},[i("div",re,[(f(!0),u(H,null,Z(r,(n,o)=>O((f(),u("input",{key:o,ref_for:!0,ref:s=>l.value[o]=s,"onUpdate:modelValue":s=>r[o]=s,type:"text",maxlength:"1",placeholder:e.$t("verification.codePlaceholder"),class:"code-input",onInput:s=>R(o,s),onKeydown:s=>B(o,s),onPaste:t[0]||(t[0]=s=>E(s)),required:""},null,40,ae)),[[Q,r[o]]])),128))]),i("button",{type:"submit",class:"submit-btn",disabled:y.value||!C.value},[y.value?(f(),u("span",le,[t[1]||(t[1]=i("svg",{class:"animate-spin",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[i("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4","stroke-opacity":"0.25"}),i("path",{d:"M4 12C4 16.4183 7.58172 20 12 20V12H4Z",fill:"currentColor"})],-1)),z(" "+v(e.$t("verification.verifyingButton")),1)])):(f(),u("span",ce,v(e.$t("verification.verifyButton")),1))],8,ne)],32),i("div",de,[i("span",ue,v(e.$t("verification.didntReceive")),1),i("button",{onClick:A,class:"resend-link",disabled:g.value||p.value>0},[p.value>0?(f(),u("span",ve,v(p.value)+"s",1)):g.value?(f(),u("span",me,v(e.$t("verification.resendingButton")),1)):(f(),u("span",pe,v(e.$t("verification.resend")),1))],8,fe)])])])]))}},Ce=Y(he,[["__scopeId","data-v-a917d48b"]]);export{Ce as default};
